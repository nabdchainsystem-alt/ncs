import{r as A,j as s,aa as E,al as H,h as X,aW as Q,U as Z,aO as U,a_ as W,ao as ee,J as se}from"./index-BaRn3IWj.js";import{C as le,K as ne}from"./KPICard-zgDP18HV.js";import{C as te}from"./ChartWidget-CauoU0Cq.js";import{M as $}from"./minus-BlqgYl96.js";import"./xlsx-CCaYWco_.js";import"./arrow-up-down-Dz7OrkaD.js";const de=({activePage:C,allPageWidgets:I,widgets:N=[],onDeleteWidget:b,onUpdateWidget:o})=>{var L,O,V,B,q;const[S,T]=A.useState(null),[R,z]=A.useState("select-table"),[k,P]=A.useState(null),[u,p]=A.useState({}),j=()=>{if(C.includes("/analytics")){const e=C.replace("/analytics","/data");return(I[e]||[]).filter(a=>a.type==="custom-table")}return[]},G=e=>{T(e),z("select-table"),P(null),p({})},Y=e=>{P(e),z("configure");const l=j().find(a=>a.id===e);if(l){const a=l.columns.find(t=>t.type==="text"),n=l.columns.find(t=>t.type==="number");p({xAxisColumn:(a==null?void 0:a.id)||"",yAxisColumn:(n==null?void 0:n.id)||"",aggregation:"count"})}},_=()=>{if(S&&k){const e=j().find(l=>l.id===k);o&&o(S,{sourceTableId:k,title:(e==null?void 0:e.title)||"Connected Widget",config:u,subtext:u.aggregation==="sum"?"Total Value":"Count of records",trend:{value:"+12.5%",direction:"up"}})}T(null)},F=()=>j().find(e=>e.id===k),K=()=>N.find(e=>e.id===S);return s.jsxs("div",{className:"flex-1 flex flex-col bg-gray-50/50 overflow-y-auto relative",children:[S&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden border border-gray-200 animate-in zoom-in-95 duration-200 flex flex-col max-h-[80vh]",children:[s.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between bg-gray-50/50",children:[s.jsx("h3",{className:"font-semibold text-gray-800",children:R==="select-table"?"Select Data Source":"Configure Data"}),s.jsx("button",{onClick:()=>T(null),className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx($,{size:18,className:"rotate-45"})})]}),s.jsx("div",{className:"p-0 overflow-y-auto flex-1",children:R==="select-table"?s.jsx("div",{className:"p-2",children:j().length===0?s.jsxs("div",{className:"p-8 text-center flex flex-col items-center text-gray-500",children:[s.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-3",children:s.jsx(E,{size:24,className:"text-gray-400"})}),s.jsx("p",{className:"font-medium",children:"No tables found"}),s.jsx("p",{className:"text-sm mt-1",children:"Create a table in the Data section first."})]}):s.jsx("div",{className:"space-y-1",children:j().map(e=>{var l;return s.jsxs("button",{className:"w-full text-left px-4 py-3 hover:bg-blue-50 rounded-lg group transition-colors flex items-center justify-between border border-transparent hover:border-blue-100",onClick:()=>Y(e.id),children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center mr-3 group-hover:bg-blue-200 transition-colors",children:s.jsx(H,{size:16})}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900 group-hover:text-blue-700",children:e.title||"Untitled Table"}),s.jsxs("div",{className:"text-xs text-gray-500",children:[((l=e.rows)==null?void 0:l.length)||0," records"]})]})]}),s.jsx("div",{className:"opacity-0 group-hover:opacity-100 text-blue-600 transition-opacity",children:s.jsx(X,{size:16})})]},e.id)})})}):s.jsxs("div",{className:"p-6 space-y-6",children:[((L=K())==null?void 0:L.type)==="chart"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"X Axis (Category)"}),s.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",value:u.xAxisColumn,onChange:e=>p({...u,xAxisColumn:e.target.value}),children:[s.jsx("option",{value:"",children:"Select Column..."}),(O=F())==null?void 0:O.columns.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Y Axis (Value)"}),s.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",value:u.yAxisColumn,onChange:e=>p({...u,yAxisColumn:e.target.value}),children:[s.jsx("option",{value:"",children:"Select Column..."}),(V=F())==null?void 0:V.columns.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),((B=K())==null?void 0:B.type)==="kpi-card"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Metric"}),s.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",value:u.aggregation,onChange:e=>p({...u,aggregation:e.target.value}),children:[s.jsx("option",{value:"count",children:"Count of Records"}),s.jsx("option",{value:"sum",children:"Sum of Column"}),s.jsx("option",{value:"avg",children:"Average of Column"})]})]}),u.aggregation!=="count"&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Column"}),s.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",value:u.yAxisColumn,onChange:e=>p({...u,yAxisColumn:e.target.value}),children:[s.jsx("option",{value:"",children:"Select Column..."}),(q=F())==null?void 0:q.columns.filter(e=>e.type==="number").map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]})]})}),s.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center",children:R==="select-table"?s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Select a table to link."}),s.jsx("button",{className:"text-gray-600 hover:text-gray-900 font-medium",onClick:()=>T(null),children:"Cancel"})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"text-gray-600 hover:text-gray-900 font-medium",onClick:()=>z("select-table"),children:"Back"}),s.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",onClick:_,children:"Finish"})]})})]})}),s.jsxs("div",{className:"p-8 w-full overflow-x-auto",children:[s.jsx("div",{className:"grid grid-cols-12 gap-4 min-w-[1000px] grid-auto-rows-[minmax(175px,auto)]",children:N.map(e=>{if(e.type==="custom-table")return s.jsx("div",{className:"col-span-12",children:s.jsx(le,{...e,onDelete:()=>b&&b(e.id),onRenameTable:l=>o&&o(e.id,{title:l}),onRenameColumn:(l,a)=>{const n=e.columns.map(t=>t.id===l?{...t,name:a}:t);o&&o(e.id,{columns:n})},onAddColumn:()=>{const l={id:Math.random().toString(36).substr(2,9),name:"New Column",type:"text",width:150};o&&o(e.id,{columns:[...e.columns,l]})},onUpdateColumnType:(l,a)=>{const n=e.columns.map(t=>t.id===l?{...t,type:a}:t);o&&o(e.id,{columns:n})},onDeleteColumn:l=>{const a=e.columns.filter(n=>n.id!==l);o&&o(e.id,{columns:a})},onUpdateColumnColor:(l,a)=>{const n=e.columns.map(t=>t.id===l?{...t,color:a}:t);o&&o(e.id,{columns:n})},onUpdateRow:(l,a)=>{const n=e.rows||[],t=n.some(r=>r.id===l);let m;t?m=n.map(r=>r.id===l?{...r,data:a}:r):m=[...n,{id:l,data:a}],o&&o(e.id,{rows:m})},onRowsChange:l=>{o&&o(e.id,{rows:l})}})},e.id);if(e.type==="kpi-card"){const a={DollarSign:U,Users:Z,ShoppingBag:Q,Activity:E}[e.icon]||E;let n=e.value;if(e.sourceTableId){const r=C.replace("/analytics","/data"),i=(I[r]||[]).find(d=>d.id===e.sourceTableId);if(i){const d=e.config||{aggregation:"count"};if(d.aggregation==="count")n=(i.rows||[]).length.toString();else if(d.aggregation==="sum"&&d.yAxisColumn)n=(i.rows||[]).reduce((h,f)=>{const g=parseFloat(f.data[d.yAxisColumn])||0;return h+g},0).toLocaleString();else if(d.aggregation==="avg"&&d.yAxisColumn){const c=i.rows||[];c.length>0?n=(c.reduce((f,g)=>{const y=parseFloat(g.data[d.yAxisColumn])||0;return f+y},0)/c.length).toFixed(1):n="0"}else n=(i.rows||[]).length.toString()}}const t=e.layoutGroup&&e.layoutPosition<=4;let m={};return t&&(m={1:{gridColumn:"1 / 4",gridRow:"1"},2:{gridColumn:"4 / 7",gridRow:"1"},3:{gridColumn:"1 / 4",gridRow:"2"},4:{gridColumn:"4 / 7",gridRow:"2"}}[e.layoutPosition]),s.jsxs("div",{className:`relative group w-full h-full ${t?"":"col-span-3"}`,style:t?m:{},children:[s.jsx("div",{className:"absolute -right-2 -top-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:s.jsx("button",{onClick:()=>b&&b(e.id),className:"bg-red-500 text-white p-1 rounded-full shadow-sm hover:bg-red-600",children:s.jsx($,{size:12})})}),s.jsx(ne,{title:e.title,value:n,icon:a,trend:e.trend,subtext:e.subtext,isEmpty:!e.value&&!e.sourceTableId,onConnect:()=>G(e.id),onTitleChange:r=>o&&o(e.id,{title:r})})]},e.id)}if(e.type==="chart"){let l=null;if(e.sourceTableId){const i=C.replace("/analytics","/data"),c=(I[i]||[]).find(h=>h.id===e.sourceTableId);if(c&&c.rows&&c.rows.length>0){const h=e.config||{},f=h.xAxisColumn,g=h.yAxisColumn,y=c.columns||[],D=f?y.find(x=>x.id===f):y.find(x=>x.type==="text"),J=g?y.find(x=>x.id===g):y.find(x=>x.type==="number");if(D){const x=c.rows.map(M=>M.data[D.id]||"Unknown");let w;J?w=c.rows.map(M=>parseFloat(M.data[J.id])||0):w=c.rows.map(()=>1),l={categories:x,values:w}}}}const a=N.filter(i=>i.type==="chart").map(i=>i.id),n=a.length,t=n>=3?4:6,m=e.id===a[0],r=e.layoutGroup&&e.layoutPosition===5;let v={};return r?v={gridColumn:"7 / 13",gridRow:"1 / 3"}:m&&n>=3?v={gridColumn:`1 / span ${t}`}:v={gridColumn:`span ${t} / span ${t}`},s.jsxs("div",{className:`row-span-2 min-h-[350px] relative group transition-all duration-300 ${m&&n>=3&&!r?"col-start-1":""}`,style:v,children:[s.jsx("div",{className:"absolute -right-2 -top-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:s.jsx("button",{onClick:()=>b&&b(e.id),className:"bg-red-500 text-white p-1 rounded-full shadow-sm hover:bg-red-600",children:s.jsx($,{size:12})})}),s.jsx(te,{title:e.title,type:e.chartType||"bar",data:l,isEmpty:!e.sourceTableId,onConnect:()=>G(e.id),onTitleChange:i=>o&&o(e.id,{title:i})})]},e.id)}return null})}),N.length===0&&s.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[s.jsx("div",{className:"bg-indigo-50 p-6 rounded-full mb-6",children:s.jsx(W,{className:"text-indigo-600",size:48})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Maintenance Operations"}),s.jsx("p",{className:"text-gray-500 max-w-md mb-8",children:'Manage equipment maintenance schedules, work orders, and repair logs here. Use the "Insert" menu to add custom tables and charts.'}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-4xl",children:[{label:"Active Work Orders",value:"12",icon:ee,color:"text-amber-600"},{label:"Completed Today",value:"8",icon:X,color:"text-green-600"},{label:"Avg Response Time",value:"45m",icon:se,color:"text-blue-600"}].map((e,l)=>s.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("span",{className:"text-gray-500 text-sm font-medium",children:e.label}),s.jsx(e.icon,{className:e.color,size:20})]}),s.jsx("div",{className:"text-3xl font-bold text-gray-900",children:e.value})]},l))})]})]})]})};export{de as default};
