import{c as W,a1 as H,j as e,L as $,O as J,a2 as F,r as i,T,Q as O,P as L,X as _,u as B}from"./index-D-msRKty.js";import{U as A}from"./constants-3htZeBAr.js";import{A as V}from"./archive--CB3TGSS.js";import{P as U}from"./paperclip-DzHp6mfJ.js";import{S as E}from"./send-DftB5tt3.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],Q=W("reply",G),z=H(),w={getMessages:async()=>(await fetch(`${z}/messages`)).json(),markMessageRead:async t=>{await fetch(`${z}/messages/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isRead:!0})})},sendMessage:async(t,l,m,h=[])=>{const g={id:`MSG-${Date.now()}`,senderId:"u1",recipientId:m,subject:t,preview:l.substring(0,50)+"...",content:l,timestamp:new Date().toISOString(),isRead:!1,tags:["inbox"],attachments:h,tasks:[],notes:[]};return(await fetch(`${z}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).json()},updateMessage:async(t,l)=>(await fetch(`${z}/messages/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json()},X=({isLoading:t,messages:l,selectedId:m,filter:h,currentUser:g,onLoadMessages:b,onSetFilter:d,onSelectMessage:x})=>{const k=l.filter(r=>h==="inbox"?r.recipientId===g.id&&!r.tags.includes("archived"):r.senderId===g.id),y=r=>A[r]||{name:"Unknown",color:"#999",avatar:"?"},u=r=>{const o=new Date(r),f=new Date;return o.toDateString()===f.toDateString()?o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):o.toLocaleDateString([],{month:"short",day:"numeric"})};return e.jsxs("div",{className:"w-80 border-r border-gray-200/60 flex flex-col bg-gray-50/80 backdrop-blur-xl h-full",children:[e.jsxs("div",{className:"p-5 pb-2 flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"font-bold text-2xl text-gray-900 tracking-tight flex items-center",children:["Inbox",l.filter(r=>!r.isRead&&r.recipientId===g.id).length>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-black text-white text-[10px] font-bold rounded-full",children:l.filter(r=>!r.isRead&&r.recipientId===g.id).length})]}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx("button",{className:"p-2 hover:bg-white hover:shadow-sm rounded-full text-gray-400 hover:text-gray-900 transition-all duration-200",onClick:b,children:e.jsx($,{size:16,className:t?"animate-spin":""})})})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-blue-500 transition-colors",size:16}),e.jsx("input",{type:"text",placeholder:"Search messages...",className:"w-full pl-10 pr-4 py-2.5 bg-white border-none shadow-sm rounded-xl text-sm placeholder-gray-400 focus:ring-2 focus:ring-blue-500/20 focus:bg-white transition-all"})]}),e.jsxs("div",{className:"flex p-1 bg-gray-200/50 rounded-lg",children:[e.jsx("button",{onClick:()=>d("inbox"),className:`flex-1 py-1.5 text-xs font-semibold rounded-md transition-all duration-200 ${h==="inbox"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Inbox"}),e.jsx("button",{onClick:()=>d("sent"),className:`flex-1 py-1.5 text-xs font-semibold rounded-md transition-all duration-200 ${h==="sent"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Sent"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-3 pb-3 space-y-1",children:t&&l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-gray-400 space-y-2",children:[e.jsx($,{className:"animate-spin",size:20}),e.jsx("span",{className:"text-xs font-medium",children:"Syncing..."})]}):k.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400 space-y-2",children:[e.jsx(F,{size:32,className:"opacity-20"}),e.jsx("span",{className:"text-sm font-medium",children:"All caught up"})]}):k.map(r=>{const o=y(r.senderId),f=m===r.id;return e.jsxs("div",{onClick:()=>x(r.id),className:`p-2.5 rounded-lg cursor-pointer transition-all duration-200 group relative border ${f?"bg-white border-gray-200 shadow-sm ring-1 ring-black/5":"bg-transparent border-transparent hover:bg-white/60 hover:border-gray-100"}`,children:[e.jsx("div",{className:"flex justify-between items-start mb-0.5",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold text-white shadow-sm ring-2 ring-white",style:{backgroundColor:o.color},children:o.avatar}),!r.isRead&&h==="inbox"&&e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-blue-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:`text-xs leading-none truncate ${r.isRead?"font-medium text-gray-700":"font-bold text-gray-900"}`,children:o.name}),e.jsx("span",{className:"text-[10px] text-gray-400 mt-0.5 font-medium",children:u(r.timestamp)})]})]})}),e.jsx("div",{className:`text-xs mb-0.5 truncate leading-tight ${r.isRead?"text-gray-600":"font-semibold text-gray-900"}`,children:r.subject}),e.jsx("div",{className:"text-[10px] text-gray-400 truncate leading-relaxed opacity-80 group-hover:opacity-100 transition-opacity",children:r.preview})]},r.id)})})]})},q=({selectedMessage:t,currentUser:l,replyText:m,onReplyChange:h,onSendReply:g,onOpenCompose:b,onUpdateMessage:d})=>{var P;const x=a=>A[a]||{name:"Unknown",color:"#999",avatar:"?"},[k,y]=i.useState(!1),[u,r]=i.useState(""),[o,f]=i.useState(""),j=i.useRef(null),S=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2),I=async()=>{if(!u.trim()&&!o.trim()||!t)return;const n=[{id:S(),title:u.trim()||"Untitled",description:o.trim()},...t.notes||[]];await w.updateMessage(t.id,{notes:n}),d(),r(""),f(""),y(!1)},C=async()=>{if(!t)return;const n=[{id:S(),title:t.subject||"Email task",description:t.preview||t.content.slice(0,140),status:"todo",sourceEmailId:t.id},...t.tasks||[]];await w.updateMessage(t.id,{tasks:n}),d()},s=async(a,n)=>{if(!t)return;const N=(t.tasks||[]).map(R=>R.id===a?{...R,status:n}:R);await w.updateMessage(t.id,{tasks:N}),d()},c=async a=>{if(!t)return;const n=(t.notes||[]).filter(N=>N.id!==a);await w.updateMessage(t.id,{notes:n}),d()},p=async a=>{if(!t)return;const n=(t.tasks||[]).filter(N=>N.id!==a);await w.updateMessage(t.id,{tasks:n}),d()},v=async a=>{if(t&&a.target.files&&a.target.files[0]){const n=a.target.files[0],N={id:S(),name:n.name,type:n.type,url:URL.createObjectURL(n)},R=[...t.attachments||[],N];await w.updateMessage(t.id,{attachments:R}),d()}},D=i.useMemo(()=>({todo:((t==null?void 0:t.tasks)||[]).filter(a=>a.status==="todo"),inProgress:((t==null?void 0:t.tasks)||[]).filter(a=>a.status==="inProgress"),done:((t==null?void 0:t.tasks)||[]).filter(a=>a.status==="done")}),[t]);return e.jsx("div",{className:"flex-1 flex flex-col bg-white h-full min-w-0 relative z-0",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-8 py-6 border-b border-gray-100 bg-white/80 backdrop-blur-sm sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-tight tracking-tight",children:t.subject}),e.jsxs("div",{className:"flex space-x-1 text-gray-400",children:[e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Archive",children:e.jsx(V,{size:18})}),e.jsx("button",{className:"p-2 hover:bg-red-50 hover:text-red-500 rounded-full transition-colors",title:"Delete",children:e.jsx(T,{size:18})})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold text-white shadow-md ring-4 ring-gray-50",style:{backgroundColor:x(t.senderId).color},children:x(t.senderId).avatar}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("span",{className:"font-bold text-gray-900 text-base",children:x(t.senderId).name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["<user@",t.senderId,".com>"]})]}),e.jsxs("div",{className:"text-xs font-medium text-gray-400 mt-0.5",children:["To: Me â€¢ ",new Date(t.timestamp).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"})]})]})]})]}),e.jsxs("div",{className:"flex-1 flex min-h-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 relative overflow-hidden",children:[e.jsxs("div",{className:"flex-1 px-8 py-8 overflow-y-auto custom-scrollbar",children:[e.jsx("div",{className:"prose prose-sm max-w-none text-gray-800 leading-relaxed whitespace-pre-wrap font-sans",children:t.content}),t.attachments&&t.attachments.length>0&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-100",children:[e.jsx("h3",{className:"text-xs font-bold uppercase tracking-wider text-gray-400 mb-3",children:"Attachments"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:t.attachments.map(a=>e.jsxs("div",{className:"flex items-center p-3 bg-gray-50 border border-gray-200 rounded-xl text-sm hover:bg-gray-100 transition-colors cursor-pointer group",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg shadow-sm mr-3 group-hover:scale-105 transition-transform",children:e.jsx(O,{size:18,className:"text-blue-500"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-700",children:a.name}),e.jsx("span",{className:"text-[10px] text-gray-400 uppercase",children:a.type.split("/")[1]||"FILE"})]})]},a.id))})]})]}),e.jsx("div",{className:"p-6 bg-white border-t border-gray-100 z-10",children:e.jsxs("div",{className:"relative bg-white border border-gray-200 rounded-2xl shadow-sm focus-within:ring-2 focus-within:ring-blue-500/20 focus-within:border-blue-500 transition-all overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 bg-gray-50/50 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-gray-400",children:[e.jsx(Q,{size:14}),e.jsxs("span",{className:"text-xs font-medium",children:["Replying to ",e.jsx("span",{className:"text-gray-700",children:x(t.senderId).name})]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx(U,{size:14,onClick:()=>{var a;return(a=j.current)==null?void 0:a.click()}})})]}),e.jsx("textarea",{className:"w-full p-4 min-h-[100px] focus:outline-none text-sm resize-none placeholder-gray-400",placeholder:"Write your reply...",value:m,onChange:a=>h(a.target.value)}),e.jsxs("div",{className:"px-4 py-3 bg-white flex justify-between items-center",children:[e.jsx("input",{type:"file",ref:j,className:"hidden",onChange:v}),e.jsx("div",{className:"text-xs text-gray-400",children:"Press Cmd+Enter to send"}),e.jsxs("button",{onClick:g,disabled:!m.trim(),className:"bg-black text-white px-6 py-2 rounded-xl text-sm font-semibold flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-800 hover:shadow-lg hover:-translate-y-0.5 transition-all",children:[e.jsx("span",{children:"Send Reply"}),e.jsx(E,{size:14})]})]})]})})]}),e.jsxs("div",{className:"w-80 border-l border-gray-100 bg-gray-50/30 flex flex-col overflow-y-auto custom-scrollbar p-5 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),e.jsx("h3",{className:"text-sm font-bold text-gray-800",children:"Action Items"})]}),e.jsx("button",{onClick:C,className:"p-1.5 hover:bg-gray-100 rounded-lg text-gray-500 hover:text-gray-900 transition-colors",title:"Create Task",children:e.jsx(L,{size:14})})]}),e.jsxs("div",{className:"space-y-3",children:[["todo","inProgress","done"].map(a=>e.jsxs("div",{className:"space-y-1.5",children:[D[a].length>0&&e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-400 pl-1",children:a==="inProgress"?"In Progress":a}),e.jsx("div",{className:"space-y-2",children:D[a].map(n=>e.jsxs("div",{className:"bg-white p-2.5 rounded-lg shadow-sm border border-gray-200 group hover:shadow-md transition-all relative pr-7",children:[e.jsx("div",{className:"text-xs font-medium text-gray-800 mb-1 leading-tight",children:n.title}),e.jsxs("select",{value:n.status,onChange:N=>s(n.id,N.target.value),className:"w-full text-[10px] bg-gray-50 border-none rounded px-2 py-0.5 text-gray-500 focus:ring-0 cursor-pointer hover:bg-gray-100 transition-colors mt-0.5",children:[e.jsx("option",{value:"todo",children:"To Do"}),e.jsx("option",{value:"inProgress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"})]}),e.jsx("button",{onClick:()=>p(n.id),className:"absolute top-2 right-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-0.5 rounded hover:bg-red-50",children:e.jsx(T,{size:12})})]},n.id))})]},a)),Object.values(D).flat().length===0&&e.jsxs("div",{className:"p-4 border-2 border-dashed border-gray-200 rounded-xl flex flex-col items-center justify-center text-center",children:[e.jsx("span",{className:"text-xs text-gray-400 mb-1",children:"No tasks yet"}),e.jsx("button",{onClick:C,className:"text-[10px] font-medium text-blue-600 hover:underline",children:"Create from email"})]})]})]}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-yellow-400"}),e.jsx("h3",{className:"text-sm font-bold text-gray-800",children:"Notes"})]}),e.jsx("button",{onClick:()=>y(a=>!a),className:"p-1.5 hover:bg-yellow-100 rounded-lg text-yellow-600 transition-colors",children:e.jsx(L,{size:14})})]}),k&&e.jsxs("div",{className:"bg-white rounded-xl p-2.5 shadow-sm border border-yellow-100 mb-3 space-y-2 animate-in slide-in-from-top-2 duration-200",children:[e.jsx("input",{className:"w-full text-xs font-medium placeholder-gray-400 focus:outline-none",placeholder:"Title",value:u,onChange:a=>r(a.target.value),autoFocus:!0}),e.jsx("textarea",{className:"w-full text-[10px] text-gray-600 placeholder-gray-300 focus:outline-none resize-none",placeholder:"Details...",rows:2,value:o,onChange:a=>f(a.target.value)}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-1",children:[e.jsx("button",{onClick:()=>y(!1),className:"text-[10px] text-gray-400 hover:text-gray-600",children:"Cancel"}),e.jsx("button",{onClick:I,className:"text-[10px] bg-yellow-400 text-yellow-900 px-2 py-0.5 rounded font-medium hover:bg-yellow-500 transition-colors",children:"Save"})]})]}),e.jsx("div",{className:"space-y-2",children:(P=t==null?void 0:t.notes)!=null&&P.length?t.notes.map(a=>e.jsxs("div",{className:"bg-white p-2.5 rounded-lg shadow-sm border border-yellow-100/50 group relative pr-7",children:[e.jsx("div",{className:"font-semibold text-xs text-gray-800",children:a.title}),a.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:a.description}),e.jsx("button",{onClick:()=>c(a.id),className:"absolute top-2 right-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-0.5 rounded hover:bg-red-50",children:e.jsx(T,{size:12})})]},a.id)):e.jsx("div",{className:"p-3 bg-yellow-50/50 rounded-xl border border-yellow-100/50 text-center",children:e.jsx("p",{className:"text-xs text-gray-400 italic",children:"No notes attached."})})})]})]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-gray-50/30",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6 shadow-inner",children:e.jsx(F,{size:40,className:"text-gray-300"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Welcome to Inbox"}),e.jsx("p",{className:"text-gray-500 max-w-md text-center mb-8",children:"Select a message from the sidebar to view it, or start a new conversation."}),e.jsxs("button",{onClick:b,className:"px-8 py-3 bg-black text-white rounded-full font-semibold shadow-lg shadow-black/20 hover:shadow-xl hover:-translate-y-1 transition-all flex items-center space-x-2",children:[e.jsx(L,{size:18}),e.jsx("span",{children:"Compose Message"})]})]})})},K=({currentUser:t,onClose:l,onSend:m})=>{const[h,g]=i.useState("u2"),[b,d]=i.useState(""),[x,k]=i.useState(""),[y,u]=i.useState(!1),[r,o]=i.useState([]),f=i.useRef(null),j=s=>{if(s.target.files&&s.target.files[0]){const c=s.target.files[0],p={id:Math.random().toString(36).slice(2),name:c.name,type:c.type,url:URL.createObjectURL(c)};o(v=>[...v,p])}},S=s=>{o(c=>c.filter(p=>p.id!==s))},I=async()=>{if(!(!b.trim()||!x.trim())){u(!0);try{await w.sendMessage(b,x,h,r),m(),l()}catch(s){console.error("Failed to send message",s)}finally{u(!1)}}},C=Object.values(A).filter(s=>s.id!=="me"&&s.id!==t.id);return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[85vh] animate-in zoom-in-95 duration-300 border border-gray-100",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between bg-white sticky top-0 z-10",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900 tracking-tight",children:"New Message"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-900 p-2 rounded-full hover:bg-gray-100 transition-all duration-200",children:e.jsx(_,{size:20})})]}),e.jsxs("div",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wider text-gray-500 ml-1",children:"To"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:"w-full appearance-none bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-medium text-gray-900 focus:outline-none focus:ring-2 focus:ring-black/5 focus:border-black transition-all cursor-pointer hover:bg-gray-100",value:h,onChange:s=>g(s.target.value),children:C.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.email,")"]},s.id))}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500",children:e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M1 1L5 5L9 1",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wider text-gray-500 ml-1",children:"Subject"}),e.jsx("input",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-medium text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-black/5 focus:border-black transition-all hover:bg-gray-100",placeholder:"What's this about?",value:b,onChange:s=>d(s.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wider text-gray-500 ml-1",children:"Message"}),e.jsx("textarea",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-black/5 focus:border-black min-h-[200px] resize-none transition-all hover:bg-gray-100",placeholder:"Write your message...",value:x,onChange:s=>k(s.target.value)})]}),r.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:r.map(s=>e.jsxs("div",{className:"flex items-center p-2 pl-3 bg-white border border-gray-200 rounded-lg text-xs group shadow-sm",children:[e.jsx(O,{size:14,className:"text-blue-500 mr-2"}),e.jsx("span",{className:"text-gray-700 font-medium max-w-[150px] truncate",children:s.name}),e.jsx("button",{onClick:()=>S(s.id),className:"ml-2 text-gray-400 hover:text-red-500 p-1 rounded hover:bg-red-50 transition-colors",children:e.jsx(T,{size:14})})]},s.id))})]}),e.jsxs("div",{className:"px-8 py-5 border-t border-gray-100 bg-white flex items-center justify-between sticky bottom-0 z-10",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"file",ref:f,className:"hidden",onChange:j}),e.jsxs("button",{className:"text-gray-500 hover:text-gray-900 p-2.5 rounded-lg hover:bg-gray-100 transition-all flex items-center space-x-2 group",title:"Attach file",onClick:()=>{var s;return(s=f.current)==null?void 0:s.click()},children:[e.jsx(U,{size:20,className:"group-hover:-rotate-45 transition-transform duration-300"}),e.jsx("span",{className:"text-sm font-medium",children:"Attach"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-2.5 text-sm font-semibold text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-xl transition-all",children:"Cancel"}),e.jsx("button",{onClick:I,disabled:!b.trim()||!x.trim()||y,className:"px-8 py-2.5 text-sm font-bold bg-black text-white rounded-xl hover:bg-gray-800 hover:shadow-lg hover:-translate-y-0.5 transition-all flex items-center disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0 disabled:hover:shadow-none",children:y?"Sending...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Send Message"}),e.jsx(E,{size:16,className:"ml-2"})]})})]})]})]})})},se=()=>{const[t,l]=i.useState([]),[m,h]=i.useState(null),[g,b]=i.useState(!0),[d,x]=i.useState(""),[k,y]=i.useState("inbox"),{showToast:u}=B(),r=A.u1,[o,f]=i.useState(!1);i.useEffect(()=>{j()},[]);const j=async()=>{b(!0);try{const s=await w.getMessages();l(s.sort((c,p)=>new Date(p.timestamp).getTime()-new Date(c.timestamp).getTime()))}catch(s){console.error(s)}finally{b(!1)}},S=async s=>{h(s);const c=t.find(p=>p.id===s);c&&!c.isRead&&c.recipientId===r.id&&(l(p=>p.map(v=>v.id===s?{...v,isRead:!0}:v)),await w.markMessageRead(s))},I=async()=>{if(!d.trim())return;const s=t.find(v=>v.id===m);if(!s)return;const c=`Re: ${s.subject}`,p=s.senderId===r.id?s.recipientId:s.senderId;u("Sending...","info");try{await w.sendMessage(c,d,p),x(""),u("Reply sent!","success"),j()}catch{u("Failed to send","error")}},C=t.find(s=>s.id===m);return e.jsxs("div",{className:"flex h-full bg-white overflow-hidden animate-in fade-in duration-300 relative",children:[e.jsx(X,{isLoading:g,messages:t,selectedId:m,filter:k,currentUser:r,onLoadMessages:j,onSetFilter:y,onSelectMessage:S}),e.jsx(q,{selectedMessage:C,currentUser:r,replyText:d,onReplyChange:x,onSendReply:I,onOpenCompose:()=>f(!0),onUpdateMessage:j}),o&&e.jsx(K,{currentUser:r,onClose:()=>f(!1),onSend:()=>{u("Message sent!","success"),j()}})]})};export{se as default};
