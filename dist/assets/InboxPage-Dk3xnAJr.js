import{c as A,a1 as O,j as e,a2 as D,L as F,O as E,r as n,T as U,Q as L,P as z,X as _,u as H}from"./index-BlVqsW8p.js";import{U as T}from"./constants-3htZeBAr.js";import{A as J}from"./archive-B5hi2J3E.js";import{P}from"./paperclip-BqUoBvFO.js";import{S as $}from"./send-D_Q73fy5.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],W=A("ellipsis-vertical",V);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],G=A("reply",B),R=O(),N={getMessages:async()=>(await fetch(`${R}/messages`)).json(),markMessageRead:async t=>{await fetch(`${R}/messages/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isRead:!0})})},sendMessage:async(t,l,h,g=[])=>{const y={id:`MSG-${Date.now()}`,senderId:"u1",recipientId:h,subject:t,preview:l.substring(0,50)+"...",content:l,timestamp:new Date().toISOString(),isRead:!1,tags:["inbox"],attachments:g,tasks:[],notes:[]};return(await fetch(`${R}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).json()},updateMessage:async(t,l)=>(await fetch(`${R}/messages/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json()},Q=({isLoading:t,messages:l,selectedId:h,filter:g,currentUser:y,onLoadMessages:b,onSetFilter:u,onSelectMessage:x})=>{const v=l.filter(a=>g==="inbox"?a.recipientId===y.id&&!a.tags.includes("archived"):a.senderId===y.id),f=a=>T[a]||{name:"Unknown",color:"#999",avatar:"?"},m=a=>{const i=new Date(a),p=new Date;return i.toDateString()===p.toDateString()?i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):i.toLocaleDateString([],{month:"short",day:"numeric"})};return e.jsxs("div",{className:"w-96 border-r border-gray-200 flex flex-col bg-gray-50/50",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 flex items-center justify-between bg-white",children:[e.jsxs("h2",{className:"font-bold text-lg flex items-center text-gray-700",children:[e.jsx(D,{className:"mr-2 text-black",size:20}),"Inbox"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded text-gray-500",onClick:b,children:e.jsx(F,{size:16,className:t?"animate-spin":""})}),e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded text-gray-500",children:e.jsx(W,{size:16})})]})]}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:14}),e.jsx("input",{type:"text",placeholder:"Search messages...",className:"w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-200 focus:border-black"})]})}),e.jsxs("div",{className:"flex px-3 border-b border-gray-200 bg-white",children:[e.jsx("button",{onClick:()=>u("inbox"),className:`flex-1 pb-2 text-sm font-medium border-b-2 transition-colors ${g==="inbox"?"border-black text-black":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Primary"}),e.jsx("button",{onClick:()=>u("sent"),className:`flex-1 pb-2 text-sm font-medium border-b-2 transition-colors ${g==="sent"?"border-black text-black":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Sent"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:t&&l.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"Loading..."}):v.length===0?e.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:"No messages here."}):v.map(a=>{const i=f(a.senderId);return e.jsxs("div",{onClick:()=>x(a.id),className:`p-4 border-b border-gray-100 cursor-pointer transition-colors group relative ${h===a.id?"bg-gray-100 border-gray-200":"bg-white hover:bg-gray-50"} ${a.isRead?"":"bg-gray-50"}`,children:[!a.isRead&&e.jsx("div",{className:"absolute left-1 top-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-black rounded-full"}),e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold text-white",style:{backgroundColor:i.color},children:i.avatar}),e.jsx("span",{className:`text-sm truncate max-w-[120px] ${a.isRead?"text-gray-600":"font-bold text-gray-900"}`,children:i.name})]}),e.jsx("span",{className:"text-[10px] text-gray-400",children:m(a.timestamp)})]}),e.jsx("div",{className:`text-sm mb-1 truncate ${a.isRead?"text-gray-700":"font-semibold text-gray-800"}`,children:a.subject}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:a.preview})]},a.id)})})]})},X=({selectedMessage:t,currentUser:l,replyText:h,onReplyChange:g,onSendReply:y,onOpenCompose:b,onUpdateMessage:u})=>{const x=s=>T[s]||{name:"Unknown",color:"#999",avatar:"?"},[v,f]=n.useState(!1),[m,a]=n.useState(""),[i,p]=n.useState(""),j=n.useRef(null),w=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2),k=async()=>{if(!m.trim()&&!i.trim()||!t)return;const o=[{id:w(),title:m.trim()||"Untitled",description:i.trim()},...t.notes||[]];await N.updateMessage(t.id,{notes:o}),u(),a(""),p(""),f(!1)},S=async()=>{if(!t)return;const o=[{id:w(),title:t.subject||"Email task",description:t.preview||t.content.slice(0,140),status:"todo",sourceEmailId:t.id},...t.tasks||[]];await N.updateMessage(t.id,{tasks:o}),u()},r=async(s,o)=>{if(!t)return;const C=(t.tasks||[]).map(I=>I.id===s?{...I,status:o}:I);await N.updateMessage(t.id,{tasks:C}),u()},d=async s=>{if(t&&s.target.files&&s.target.files[0]){const o=s.target.files[0],C={id:w(),name:o.name,type:o.type,url:URL.createObjectURL(o)},I=[...t.attachments||[],C];await N.updateMessage(t.id,{attachments:I}),u()}},c=n.useMemo(()=>({todo:((t==null?void 0:t.tasks)||[]).filter(s=>s.status==="todo"),inProgress:((t==null?void 0:t.tasks)||[]).filter(s=>s.status==="inProgress"),done:((t==null?void 0:t.tasks)||[]).filter(s=>s.status==="done")}),[t]);return e.jsxs("div",{className:"flex-1 flex flex-col bg-white h-full min-w-0",children:[e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800 leading-tight",children:t.subject}),e.jsxs("div",{className:"flex space-x-2 text-gray-400",children:[e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",title:"Archive",children:e.jsx(J,{size:18})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full hover:text-red-500",title:"Delete",children:e.jsx(U,{size:18})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold text-white shadow-sm",style:{backgroundColor:x(t.senderId).color},children:x(t.senderId).avatar}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("span",{className:"font-bold text-gray-900",children:x(t.senderId).name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["<user@",t.senderId,".com>"]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["To: Me â€¢ ",new Date(t.timestamp).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex-1 p-8 overflow-y-auto text-gray-800 leading-relaxed whitespace-pre-wrap font-sans text-sm",children:[t.content,t.attachments&&t.attachments.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Attachments"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.attachments.map(s=>e.jsxs("div",{className:"flex items-center p-2 bg-gray-50 border border-gray-200 rounded-lg text-sm",children:[e.jsx(L,{size:16,className:"text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-700",children:s.name})]},s.id))})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm focus-within:ring-2 focus-within:ring-gray-200 focus-within:border-black transition-all",children:[e.jsxs("div",{className:"p-2 border-b border-gray-100 bg-gray-50/50 flex items-center space-x-2 text-gray-400",children:[e.jsx(G,{size:14}),e.jsxs("span",{className:"text-xs font-medium",children:["Replying to ",x(t.senderId).name,"..."]})]}),e.jsx("textarea",{className:"w-full p-3 min-h-[80px] focus:outline-none text-sm resize-none",placeholder:"Write your reply...",value:h,onChange:s=>g(s.target.value)}),e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"file",ref:j,className:"hidden",onChange:d}),e.jsx("button",{className:"p-1 text-gray-400 hover:text-gray-600 rounded hover:bg-gray-100",title:"Attach file",onClick:()=>{var s;return(s=j.current)==null?void 0:s.click()},children:e.jsx(P,{size:16})})]}),e.jsxs("button",{onClick:y,disabled:!h.trim(),className:"bg-[#1e2126] text-white px-4 py-1.5 rounded text-sm font-medium flex items-center space-x-2 disabled:opacity-50 hover:bg-[#2c3036] transition-all",children:[e.jsx("span",{children:"Send"}),e.jsx($,{size:14})]})]})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-300 bg-gray-50/30",children:[e.jsx("div",{className:"bg-gray-100 p-6 rounded-full mb-4",children:e.jsx(D,{size:48,className:"text-gray-300"})}),e.jsx("p",{className:"text-lg font-medium text-gray-400",children:"Select a message to read"}),e.jsx("p",{className:"text-sm max-w-xs text-center mt-2",children:"Stay on top of your communications directly within your workspace."}),e.jsxs("button",{onClick:b,className:"mt-6 px-6 py-2 bg-[#1e2126] text-white rounded-md font-medium shadow-lg shadow-gray-200 hover:shadow-xl hover:bg-[#2c3036] hover:scale-105 transition-all flex items-center",children:[e.jsx(z,{size:16,className:"mr-2"}),"New Message"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 border-t border-gray-100 p-4 bg-transparent",children:[e.jsxs("div",{className:"col-span-1 md:col-span-2 border border-gray-200 rounded-lg p-4 bg-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Reminders & Notes"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Lightweight scratchpad under your inbox."})]}),e.jsx("button",{onClick:()=>f(s=>!s),className:"flex items-center justify-center w-8 h-8 rounded-full border border-gray-200 text-gray-600 hover:bg-gray-100 transition",title:"Add reminder or note",children:e.jsx(z,{size:14})})]}),v&&e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsx("input",{className:"w-full border border-gray-200 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-200 focus:border-black",placeholder:"Headline",value:m,onChange:s=>a(s.target.value)}),e.jsx("textarea",{className:"w-full border border-gray-200 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-200 focus:border-black resize-none",placeholder:"Description",rows:3,value:i,onChange:s=>p(s.target.value)}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"text-xs text-gray-500 px-3 py-1 rounded hover:bg-gray-100",onClick:()=>{f(!1),a(""),p("")},children:"Cancel"}),e.jsx("button",{className:"text-xs bg-[#1e2126] text-white px-3 py-1 rounded hover:bg-[#2c3036] disabled:opacity-50",onClick:k,disabled:!m.trim()&&!i.trim(),children:"Add"})]})]}),!(t!=null&&t.notes)||t.notes.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"No reminders yet. Use the + to add one."}):e.jsx("ul",{className:"list-disc pl-4 space-y-2 text-sm text-gray-700",children:t.notes.map(s=>e.jsxs("li",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-gray-600",children:s.description})]},s.id))})]}),e.jsxs("div",{className:"col-span-1 md:col-span-3 border border-gray-200 rounded-lg p-4 bg-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Mini tasks from email"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Turn messages into actionable tasks."})]}),e.jsxs("button",{onClick:S,disabled:!t,className:"flex items-center gap-2 text-xs px-3 py-1.5 rounded-md border border-gray-200 text-gray-700 hover:bg-gray-100 disabled:opacity-50",children:[e.jsx(z,{size:12}),"Add from email"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{key:"todo",label:"To Do"},{key:"inProgress",label:"In Progress"},{key:"done",label:"Done"}].map(s=>e.jsxs("div",{className:"border border-dashed border-gray-200 rounded-md p-3 bg-white/70 flex flex-col min-h-[140px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:s.label}),e.jsx("span",{className:"text-[10px] text-gray-500",children:c[s.key].length})]}),e.jsx("div",{className:"space-y-2 overflow-y-auto max-h-52 pr-1",children:c[s.key].length===0?e.jsx("p",{className:"text-[11px] text-gray-400",children:"No tasks"}):c[s.key].map(o=>e.jsxs("div",{className:"border border-gray-200 rounded p-2 bg-white shadow-sm",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800",children:o.title}),o.description&&e.jsx("p",{className:"text-[11px] text-gray-500 mt-1 overflow-hidden text-ellipsis",children:o.description}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{value:o.status,onChange:C=>r(o.id,C.target.value),className:"w-full text-[11px] border border-gray-200 rounded px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-gray-200 focus:border-black",children:[e.jsx("option",{value:"todo",children:"To Do"}),e.jsx("option",{value:"inProgress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"})]})})]},o.id))})]},s.key))})]})]})]})},q=({currentUser:t,onClose:l,onSend:h})=>{const[g,y]=n.useState("u2"),[b,u]=n.useState(""),[x,v]=n.useState(""),[f,m]=n.useState(!1),[a,i]=n.useState([]),p=n.useRef(null),j=r=>{if(r.target.files&&r.target.files[0]){const d=r.target.files[0],c={id:Math.random().toString(36).slice(2),name:d.name,type:d.type,url:URL.createObjectURL(d)};i(s=>[...s,c])}},w=r=>{i(d=>d.filter(c=>c.id!==r))},k=async()=>{if(!(!b.trim()||!x.trim())){m(!0);try{await N.sendMessage(b,x,g,a),h(),l()}catch(r){console.error("Failed to send message",r)}finally{m(!1)}}},S=Object.values(T).filter(r=>r.id!=="me"&&r.id!==t.id);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between bg-gray-50",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"New Message"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-200 transition",children:e.jsx(_,{size:18})})]}),e.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"To"}),e.jsx("select",{className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-200 focus:border-black",value:g,onChange:r=>y(r.target.value),children:S.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.email,")"]},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Subject"}),e.jsx("input",{className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-200 focus:border-black",placeholder:"What's this about?",value:b,onChange:r=>u(r.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Message"}),e.jsx("textarea",{className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-200 focus:border-black min-h-[150px] resize-none",placeholder:"Write your message...",value:x,onChange:r=>v(r.target.value)})]}),a.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(r=>e.jsxs("div",{className:"flex items-center p-2 bg-gray-50 border border-gray-200 rounded-lg text-xs group",children:[e.jsx(L,{size:14,className:"text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-700 max-w-[150px] truncate",children:r.name}),e.jsx("button",{onClick:()=>w(r.id),className:"ml-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition",children:e.jsx(U,{size:12})})]},r.id))})]}),e.jsxs("div",{className:"p-4 border-t border-gray-100 bg-gray-50 flex items-center justify-between",children:[e.jsx("input",{type:"file",ref:p,className:"hidden",onChange:j}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 p-2 rounded hover:bg-gray-200 transition",title:"Attach file",onClick:()=>{var r;return(r=p.current)==null?void 0:r.click()},children:e.jsx(P,{size:18})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-200 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:k,disabled:!b.trim()||!x.trim()||f,className:"px-4 py-2 text-sm font-medium bg-[#1e2126] text-white rounded-lg hover:bg-[#2c3036] transition flex items-center disabled:opacity-50 disabled:cursor-not-allowed shadow-sm shadow-gray-200",children:f?"Sending...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Send"}),e.jsx($,{size:14,className:"ml-2"})]})})]})]})]})})},te=()=>{const[t,l]=n.useState([]),[h,g]=n.useState(null),[y,b]=n.useState(!0),[u,x]=n.useState(""),[v,f]=n.useState("inbox"),{showToast:m}=H(),a=T.u1,[i,p]=n.useState(!1);n.useEffect(()=>{j()},[]);const j=async()=>{b(!0);try{const r=await N.getMessages();l(r.sort((d,c)=>new Date(c.timestamp).getTime()-new Date(d.timestamp).getTime()))}catch(r){console.error(r)}finally{b(!1)}},w=async r=>{g(r);const d=t.find(c=>c.id===r);d&&!d.isRead&&d.recipientId===a.id&&(l(c=>c.map(s=>s.id===r?{...s,isRead:!0}:s)),await N.markMessageRead(r))},k=async()=>{if(!u.trim())return;const r=t.find(s=>s.id===h);if(!r)return;const d=`Re: ${r.subject}`,c=r.senderId===a.id?r.recipientId:r.senderId;m("Sending...","info");try{await N.sendMessage(d,u,c),x(""),m("Reply sent!","success"),j()}catch{m("Failed to send","error")}},S=t.find(r=>r.id===h);return e.jsxs("div",{className:"flex h-full bg-white overflow-hidden animate-in fade-in duration-300 relative",children:[e.jsx(Q,{isLoading:y,messages:t,selectedId:h,filter:v,currentUser:a,onLoadMessages:j,onSetFilter:f,onSelectMessage:w}),e.jsx(X,{selectedMessage:S,currentUser:a,replyText:u,onReplyChange:x,onSendReply:k,onOpenCompose:()=>p(!0),onUpdateMessage:j}),i&&e.jsx(q,{currentUser:a,onClose:()=>p(!1),onSend:()=>{m("Message sent!","success"),j()}})]})};export{te as default};
