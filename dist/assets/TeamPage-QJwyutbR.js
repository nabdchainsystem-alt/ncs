import{a9 as U,a7 as M,a8 as D,r as l,u as O,j as e,X as G,a1 as P,ag as _,ac as R,d as H,as as $,a5 as K,P as V,U as q,ah as W,aF as X,a6 as Y,aK as Z,E,l as I,T as J,Q as ee,aY as se}from"./index-sqQsKImc.js";import{L as Q}from"./layout-grid-DGXTzLGG.js";import{S as te}from"./star-hYvHy8aM.js";const F={getTeams:async()=>{const a=D.getCurrentUser(),i=(a==null?void 0:a.email)==="master@nabdchain.com"||(a==null?void 0:a.email)==="max@nabdchain.com",d=M()==="view-wf54321";let n=U.from("teams").select("*");!i&&!d&&(n=n.eq("company_id",M()));const{data:y,error:x}=await n;return x?(console.error("Error fetching teams:",x),[]):(y||[]).map(b=>({...b,members:b.members||[]}))},createTeam:async a=>{const i={...a,id:`team-${Date.now()}`,company_id:M()},{data:d,error:n}=await U.from("teams").insert(i).select().single();if(n)throw n;return d},deleteTeam:async a=>{const{error:i}=await U.from("teams").delete().eq("id",a);if(i)throw console.error("Error deleting team:",i),i}},ae=({isOpen:a,onClose:i,onTeamCreated:d})=>{const[n,y]=l.useState(""),[x,b]=l.useState("#3b82f6"),[u,m]=l.useState(""),[h,v]=l.useState([]),[N,p]=l.useState([]),[f,w]=l.useState(!1),{showToast:j}=O();l.useEffect(()=>{a&&C()},[a]);const C=async()=>{try{const s=await D.getUsers();p(s)}catch(s){console.error("Failed to load users",s)}},S=async s=>{if(s.preventDefault(),!!n.trim()){w(!0);try{await F.createTeam({name:n,members:h,color:x,company_id:""}),j("Team created successfully!","success"),d(),i(),y(""),v([]),b("#3b82f6")}catch(o){console.error("Failed to create team",o),j("Failed to create team","error")}finally{w(!1)}}},z=s=>{v(o=>o.includes(s)?o.filter(g=>g!==s):[...o,s])},t=N.filter(s=>s.name.toLowerCase().includes(u.toLowerCase())||s.email.toLowerCase().includes(u.toLowerCase())),r=["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899","#6366f1","#14b8a6"];return a?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Create New Team"}),e.jsx("button",{onClick:i,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(G,{size:20})})]}),e.jsxs("form",{onSubmit:S,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Team Name"}),e.jsx("input",{type:"text",value:n,onChange:s=>y(s.target.value),placeholder:"e.g. Alpha Squad",className:"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-black/5 focus:border-black outline-none transition-all",autoFocus:!0,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Team Color"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(s=>e.jsx("button",{type:"button",onClick:()=>b(s),className:`w-8 h-8 rounded-full border-2 flex items-center justify-center transition-transform hover:scale-110 ${x===s?"border-gray-900 scale-110":"border-transparent"}`,style:{backgroundColor:s},children:x===s&&e.jsx(P,{size:14,className:"text-white"})},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Add Members (",h.length,")"]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 flex items-center gap-2",children:[e.jsx(_,{size:16,className:"text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search people...",value:u,onChange:s=>m(s.target.value),className:"bg-transparent border-none outline-none text-sm w-full placeholder-gray-500"})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:[t.map(s=>e.jsxs("button",{type:"button",onClick:()=>z(s.id),className:`w-full flex items-center p-2 rounded-lg text-sm transition-colors ${h.includes(s.id)?"bg-black text-white":"hover:bg-gray-200 text-gray-700"}`,children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold mr-3 ${h.includes(s.id)?"bg-white/20 text-white":"bg-gray-200 text-gray-500"}`,children:s.avatarUrl?e.jsx("img",{src:s.avatarUrl,className:"w-full h-full rounded-full object-cover"}):s.name.charAt(0)}),e.jsx("span",{children:s.name}),h.includes(s.id)&&e.jsx(P,{size:14,className:"ml-auto"})]},s.id)),t.length===0&&e.jsx("div",{className:"p-4 text-center text-xs text-gray-400",children:"No users found"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!n.trim()||f,className:"px-6 py-2 bg-black text-white text-sm font-medium rounded-lg hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:f?"Creating...":"Create Team"})]})]})]})}):null},ne=()=>{const[a,i]=l.useState([]),[d,n]=l.useState([]),[y,x]=l.useState([]),[b,u]=l.useState(!0),[m,h]=l.useState("all"),[v,N]=l.useState(!1),{showToast:p}=O();l.useEffect(()=>{f()},[]);const f=async()=>{try{u(!0),u(!0);const[t,r,s]=await Promise.all([F.getTeams(),R.getTasks(),D.getUsers()]);i(t),n(r),x(s)}catch(t){console.error("Failed to fetch team data:",t),p("Failed to load teams","error")}finally{u(!1)}},w=async(t,r)=>{if(r.stopPropagation(),window.confirm("Are you sure you want to delete this team?"))try{await F.deleteTeam(t),p("Team deleted","success"),f()}catch{p("Failed to delete team","error")}},j=t=>d.filter(r=>r.assignees.some(s=>s.id===t)),C=t=>y.find(r=>r.id===t);new Set(a.flatMap(t=>t.members)).size;const S=d.filter(t=>t.status!=="Complete").length,z=a.length>0?a.reduce((t,r)=>{const s=j(r.id),o=s.filter(g=>g.status==="Complete").length;return t+(s.length>0?o/s.length*100:0)},0)/a.length:0;return b?e.jsx("div",{className:"flex items-center justify-center h-full bg-white",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-black"})}):e.jsxs("div",{className:"flex h-full bg-white text-gray-900 overflow-hidden font-sans",children:[e.jsxs("div",{className:"w-[260px] bg-gray-50 border-r border-gray-200 flex flex-col flex-shrink-0",children:[e.jsx("div",{className:"p-4 pb-2",children:e.jsxs("div",{className:"relative group",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-black transition-colors",size:16}),e.jsx("input",{type:"text",placeholder:"Search",className:"w-full pl-9 pr-4 py-2 bg-white border border-gray-200 focus:border-black focus:ring-0 rounded-xl text-sm transition-all placeholder-gray-500"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 space-y-6 custom-scrollbar mt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>h("all"),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-[15px] font-medium transition-colors ${m==="all"?"bg-black text-white":"text-gray-600 hover:bg-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{size:18,className:m==="all"?"text-white":"text-gray-400"}),e.jsx("span",{children:"All Teams"})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${m==="all"?"bg-white/20 text-white":"bg-gray-200 text-gray-500"}`,children:a.length})]}),e.jsxs("button",{onClick:()=>h("my"),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-[15px] font-medium transition-colors ${m==="my"?"bg-black text-white":"text-gray-600 hover:bg-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{size:18,className:m==="my"?"text-white":"text-gray-400"}),e.jsx("span",{children:"My Teams"})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${m==="my"?"bg-white/20 text-white":"bg-gray-200 text-gray-500"}`,children:"2"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"px-3 text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:"Departments"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"px-3 py-1 text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[e.jsx(H,{size:14}),"Supply Chain"]}),e.jsx("div",{className:"space-y-0.5",children:["Procurement","Warehouse","Shipping","Planning"].map(t=>e.jsx("button",{className:"w-full flex items-center px-3 py-1.5 rounded-lg text-[14px] font-medium text-gray-600 hover:bg-gray-200 hover:text-gray-900 transition-colors",children:t},t))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"px-3 py-1 text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[e.jsx($,{size:14}),"Operations"]}),e.jsx("div",{className:"space-y-0.5",children:["Maintenance","Production","Quality"].map(t=>e.jsx("button",{className:"w-full flex items-center px-3 py-1.5 rounded-lg text-[14px] font-medium text-gray-600 hover:bg-gray-200 hover:text-gray-900 transition-colors",children:t},t))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"px-3 py-1 text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[e.jsx(K,{size:14}),"Business"]}),e.jsx("div",{className:"space-y-0.5",children:["Sales","Finance","Marketing"].map(t=>e.jsx("button",{className:"w-full flex items-center px-3 py-1.5 rounded-lg text-[14px] font-medium text-gray-600 hover:bg-gray-200 hover:text-gray-900 transition-colors",children:t},t))})]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>N(!0),className:"w-full bg-black hover:bg-gray-800 text-white px-3 py-2.5 rounded-xl text-sm font-medium transition-all shadow-sm flex items-center justify-center gap-2",children:[e.jsx(V,{size:18}),e.jsx("span",{children:"Create Team"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-white relative z-10 shadow-2xl rounded-l-3xl overflow-hidden ml-[-1px] border-l border-gray-200",children:[e.jsxs("div",{className:"h-16 border-b border-gray-100 flex items-center justify-between px-8 flex-shrink-0 bg-white sticky top-0 z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Teams"}),e.jsx("div",{className:"h-6 w-px bg-gray-200"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium text-gray-900",children:a.length}),e.jsx("span",{children:"active squads"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{className:"p-1.5 text-black bg-white shadow-sm rounded-md transition-all",children:e.jsx(Q,{size:18})}),e.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 rounded-md transition-all",children:e.jsx(q,{size:18})})]}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(W,{size:20})}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx($,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-10",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-xl",children:e.jsx(X,{className:"text-black",size:24})}),e.jsx("span",{className:"flex items-center text-black text-xs font-bold bg-gray-100 px-2 py-1 rounded-full",children:"+12% vs last month"})]}),e.jsxs("h3",{className:"text-3xl font-bold text-gray-900 mb-1",children:[Math.round(z),"%"]}),e.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Average Task Completion"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-xl",children:e.jsx(Y,{className:"text-black",size:24})}),e.jsx("span",{className:"flex items-center text-black text-xs font-bold bg-gray-100 px-2 py-1 rounded-full",children:"High Velocity"})]}),e.jsx("h3",{className:"text-3xl font-bold text-gray-900 mb-1",children:S}),e.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Active Tasks Across Teams"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-xl",children:e.jsx(Z,{className:"text-black",size:24})}),e.jsx("span",{className:"flex items-center text-black text-xs font-bold bg-gray-100 px-2 py-1 rounded-full",children:"All Systems Operational"})]}),e.jsx("h3",{className:"text-3xl font-bold text-gray-900 mb-1",children:a.length}),e.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Active Squads Deployed"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-8 py-6 border-b border-gray-200 flex items-center justify-between bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Featured Squads"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Performance and status overview"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(E,{size:20})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"text-left py-5 px-8 text-xs font-bold text-gray-400 uppercase tracking-wider w-[30%]",children:"Lead"}),e.jsx("th",{className:"text-left py-5 px-8 text-xs font-bold text-gray-400 uppercase tracking-wider w-[40%]",children:"Campaign"}),e.jsx("th",{className:"text-right py-5 px-8 text-xs font-bold text-gray-400 uppercase tracking-wider w-[30%]",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:a.map(t=>{var L;const r=j(t.id),s=r.filter(A=>A.status==="Complete").length,o=r.length>0?s/r.length*100:0;let g="Pending",k="bg-gray-100 text-gray-600 border-gray-200",T=e.jsx(ee,{size:12,className:"mr-1.5"});o>=80?(g="Success",k="bg-black text-white border-black",T=e.jsx(I,{size:12,className:"mr-1.5"})):o===0&&r.length===0?(g="Inactive",k="bg-white text-gray-400 border-gray-200 border",T=e.jsx(E,{size:12,className:"mr-1.5"})):o<30&&(g="At Risk",k="bg-white text-black border-black border",T=e.jsx(se,{size:12,className:"mr-1.5"}));const B=t.members[0],c=C(B);return e.jsxs("tr",{className:"group hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsx("td",{className:"py-5 px-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-100 border-2 border-white shadow-sm group-hover:border-gray-300 transition-colors",children:c!=null&&c.avatarUrl?e.jsx("img",{src:c.avatarUrl,alt:c.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm font-bold text-gray-400 bg-gray-100",children:((L=c==null?void 0:c.name)==null?void 0:L.charAt(0))||"?"})}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-black border-2 border-white rounded-full"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 text-sm mb-0.5",children:(c==null?void 0:c.name)||"Unknown Lead"}),e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Team Lead"})]})]})}),e.jsx("td",{className:"py-5 px-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center text-white shadow-md shrink-0 transition-transform group-hover:scale-105 bg-black",children:e.jsx("span",{className:"font-bold text-lg",children:t.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 text-sm mb-0.5",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500 font-medium flex items-center",children:[e.jsx(q,{size:12,className:"mr-1"}),t.members.length," Members",e.jsx("span",{className:"mx-1.5 text-gray-300",children:"â€¢"}),e.jsx(I,{size:12,className:"mr-1"}),r.length," Tasks"]})]})]})}),e.jsx("td",{className:"py-5 px-8 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-bold border ${k}`,children:[T,g]}),e.jsx("button",{onClick:A=>w(t.id,A),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"Delete Team",children:e.jsx(J,{size:16})})]})})]},t.id)})})]})})]})]})]}),e.jsx(ae,{isOpen:v,onClose:()=>N(!1),onTeamCreated:f})]})};export{ne as TeamPage};
