import{c as U,a0 as X,R as q,j as e,a1 as E,a2 as K,_ as F,T as D,a3 as Q,r as m,u as O,J as Y,a4 as Z,E as M,a5 as W,P as L,X as ee}from"./index-B2SFjcJL.js";import{U as P}from"./constants-DIz9rW5w.js";import{S as te}from"./star-tf2Ijocp.js";import{P as _}from"./paperclip-C8HP2wh7.js";import{S as H}from"./send-D_PIlEmP.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],ae=U("printer",se);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],ne=U("reply",re),T=X(),f={getMessages:async()=>(await fetch(`${T}/messages`)).json(),markMessageRead:async t=>{await fetch(`${T}/messages/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isRead:!0})})},sendMessage:async(t,l,p,h=[])=>{const y={id:`MSG-${Date.now()}`,senderId:"u1",recipientId:p,subject:t,preview:l.substring(0,50)+"...",content:l,timestamp:new Date().toISOString(),isRead:!1,tags:["inbox"],attachments:h,tasks:[],notes:[]};return(await fetch(`${T}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).json()},updateMessage:async(t,l)=>(await fetch(`${T}/messages/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json(),deleteMessage:async t=>{await fetch(`${T}/messages/${t}`,{method:"DELETE"})}},ie=({isLoading:t,messages:l,selectedId:p,filter:h,currentUser:y,onLoadMessages:j,onSetFilter:d,onSelectMessage:c,onDeleteMessage:I})=>{const k=l.filter(r=>h==="inbox"?r.recipientId===y.id&&!r.tags.includes("archived"):r.senderId===y.id),u=r=>P[r]||{name:"Unknown",color:"#999",avatar:"?"},g=r=>{const o=new Date(r),a=new Date;return o.toDateString()===a.toDateString()?o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):o.toLocaleDateString([],{month:"short",day:"numeric"})},[v,w]=q.useState(null),N=(r,o)=>{r.stopPropagation(),w(o)},z=()=>{v&&(I==null||I(v),w(null))};return e.jsxs("div",{className:"w-80 border-r border-gray-200/60 flex flex-col bg-gray-50/80 backdrop-blur-xl h-full",children:[e.jsxs("div",{className:"p-4 pb-2 flex flex-col space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"font-bold text-xl text-gray-900 tracking-tight flex items-center",children:["Inbox",l.filter(r=>!r.isRead&&r.recipientId===y.id).length>0&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 bg-black text-white text-[10px] font-bold rounded-full",children:l.filter(r=>!r.isRead&&r.recipientId===y.id).length})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"p-1.5 hover:bg-white hover:shadow-sm rounded-md text-gray-400 hover:text-gray-900 transition-all duration-200",onClick:j,title:"Refresh",children:e.jsx(E,{size:14,className:t?"animate-spin":""})}),e.jsxs("button",{className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-medium text-white shadow-sm hover:shadow transition-all duration-200",style:{backgroundColor:"#1e2126"},onClick:()=>{},children:[e.jsx("span",{className:"text-lg leading-none mb-0.5",children:"+"}),e.jsx("span",{children:"Compose"})]})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-blue-500 transition-colors",size:14}),e.jsx("input",{type:"text",placeholder:"Search messages...",className:"w-full pl-9 pr-4 py-2 bg-white border-none shadow-sm rounded-lg text-xs placeholder-gray-400 focus:ring-2 focus:ring-blue-500/20 focus:bg-white transition-all"})]}),e.jsxs("div",{className:"flex p-1 bg-gray-200/50 rounded-lg",children:[e.jsx("button",{onClick:()=>d("inbox"),className:`flex-1 py-1 text-xs font-semibold rounded-md transition-all duration-200 ${h==="inbox"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Inbox"}),e.jsx("button",{onClick:()=>d("sent"),className:`flex-1 py-1 text-xs font-semibold rounded-md transition-all duration-200 ${h==="sent"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Sent"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-2 pb-2 space-y-0.5",children:t&&l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-gray-400 space-y-2",children:[e.jsx(E,{className:"animate-spin",size:20}),e.jsx("span",{className:"text-xs font-medium",children:"Syncing..."})]}):k.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400 space-y-2",children:[e.jsx(F,{size:32,className:"opacity-20"}),e.jsx("span",{className:"text-sm font-medium",children:"All caught up"})]}):k.map(r=>{const o=u(r.senderId),a=p===r.id,n=h==="sent"?"#1e2126":o.color;return e.jsxs("div",{onClick:()=>c(r.id),className:`group relative py-2 px-3 rounded-lg cursor-pointer transition-all duration-200 border ${a?"bg-white border-gray-200 shadow-sm ring-1 ring-black/5":"bg-transparent border-transparent hover:bg-white/60 hover:border-gray-100"}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0 mt-0.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-[10px] font-bold text-white shadow-sm ring-2 ring-white overflow-hidden",style:{backgroundColor:o.avatar.startsWith("/")?"transparent":n},children:o.avatar.startsWith("/")?e.jsx("img",{src:o.avatar,alt:o.name,className:"w-full h-full object-cover"}):o.avatar}),!r.isRead&&h==="inbox"&&e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-blue-500 border-2 border-white rounded-full ring-1 ring-blue-500/20"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-0.5",children:[e.jsx("span",{className:`text-xs truncate pr-2 ${r.isRead?"font-semibold text-gray-700":"font-bold text-gray-900"}`,children:r.subject}),e.jsx("span",{className:`text-[10px] flex-shrink-0 ${r.isRead?"text-gray-400":"text-blue-600 font-medium"}`,children:g(r.timestamp)})]}),e.jsx("div",{className:"text-[10px] text-gray-400 truncate leading-relaxed",children:r.preview})]})]}),e.jsx("button",{className:"absolute right-2 bottom-2 opacity-0 group-hover:opacity-100 p-1 transition-all z-10 hover:scale-110",onClick:x=>N(x,r.id),title:"Delete",children:e.jsx(D,{size:11,color:"#1e2126"})})]},r.id)})}),e.jsx(Q,{isOpen:!!v,onClose:()=>w(null),onConfirm:z,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete",variant:"danger"})]})},le=({selectedMessage:t,currentUser:l,replyText:p,onReplyChange:h,onSendReply:y,onOpenCompose:j,onUpdateMessage:d})=>{var $;const c=s=>P[s]||{name:"Unknown",color:"#999",avatar:"?"},[I,k]=m.useState(!1),[u,g]=m.useState(""),[v,w]=m.useState(""),N=m.useRef(null),z=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2),r=async()=>{if(!u.trim()&&!v.trim()||!t)return;const i=[{id:z(),title:u.trim()||"Untitled",description:v.trim()},...t.notes||[]];await f.updateMessage(t.id,{notes:i}),d(),g(""),w(""),k(!1)},o=async()=>{if(!t)return;const i=[{id:z(),title:t.subject||"Email task",description:t.preview||t.content.slice(0,140),status:"todo",sourceEmailId:t.id},...t.tasks||[]];await f.updateMessage(t.id,{tasks:i}),d()},a=async(s,i)=>{if(!t)return;const S=(t.tasks||[]).map(R=>R.id===s?{...R,status:i}:R);await f.updateMessage(t.id,{tasks:S}),d()},n=async s=>{if(!t)return;const i=(t.notes||[]).filter(S=>S.id!==s);await f.updateMessage(t.id,{notes:i}),d()},x=async s=>{if(!t)return;const i=(t.tasks||[]).filter(S=>S.id!==s);await f.updateMessage(t.id,{tasks:i}),d()},b=async s=>{if(t&&s.target.files&&s.target.files[0]){const i=s.target.files[0],S={id:z(),name:i.name,type:i.type,url:URL.createObjectURL(i)},R=[...t.attachments||[],S];await f.updateMessage(t.id,{attachments:R}),d()}},C=m.useMemo(()=>({todo:((t==null?void 0:t.tasks)||[]).filter(s=>s.status==="todo"),inProgress:((t==null?void 0:t.tasks)||[]).filter(s=>s.status==="inProgress"),done:((t==null?void 0:t.tasks)||[]).filter(s=>s.status==="done")}),[t]),{showToast:A}=O(),J=async()=>{if(!t)return;const s=t.tags.includes("starred"),i=s?t.tags.filter(S=>S!=="starred"):[...t.tags,"starred"];await f.updateMessage(t.id,{tags:i}),d(),A(s?"Message unstarred":"Message starred","success")},V=async()=>{if(!t)return;const s=new Date;s.setDate(s.getDate()+1),await f.updateMessage(t.id,{snoozedUntil:s.toISOString()}),d(),A("Message snoozed until tomorrow","success")},B=async()=>{t&&(await f.updateMessage(t.id,{isRead:!1}),d(),A("Marked as unread","success"))},G=()=>{window.print()};return e.jsx("div",{className:"flex-1 flex flex-col bg-white h-full min-w-0 relative z-0",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-8 py-6 border-b border-gray-100 bg-white/80 backdrop-blur-sm sticky top-0 z-10",children:[e.jsx("div",{className:"flex items-start justify-between mb-6",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-tight tracking-tight",children:t.subject})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold text-white shadow-md ring-4 ring-gray-50 overflow-hidden",style:{backgroundColor:c(t.senderId).avatar.startsWith("/")?"transparent":t.senderId===l.id?"#1e2126":c(t.senderId).color},children:c(t.senderId).avatar.startsWith("/")?e.jsx("img",{src:c(t.senderId).avatar,alt:c(t.senderId).name,className:"w-full h-full object-cover"}):c(t.senderId).avatar}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("span",{className:"font-bold text-gray-900 text-base",children:c(t.senderId).name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["<user@",t.senderId,".com>"]})]}),e.jsxs("div",{className:"text-xs font-medium text-gray-400 mt-0.5",children:["To: Me â€¢ ",new Date(t.timestamp).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:J,className:`p-2 rounded-full transition-all ${t.tags.includes("starred")?"text-yellow-400 bg-yellow-50":"text-gray-400 hover:text-yellow-400 hover:bg-yellow-50"}`,title:t.tags.includes("starred")?"Unstar":"Star",children:e.jsx(te,{size:18,fill:t.tags.includes("starred")?"currentColor":"none"})}),e.jsx("button",{onClick:V,className:`p-2 rounded-full transition-all ${t.snoozedUntil?"text-blue-500 bg-blue-50":"text-gray-400 hover:text-blue-500 hover:bg-blue-50"}`,title:t.snoozedUntil?"Snoozed":"Snooze until tomorrow",children:e.jsx(Y,{size:18})}),e.jsx("button",{onClick:B,className:"p-2 text-gray-400 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-all",title:"Mark as Unread",children:e.jsx(Z,{size:18})}),e.jsx("button",{onClick:G,className:"p-2 text-gray-400 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-all",title:"Print",children:e.jsx(ae,{size:18})}),e.jsx("div",{className:"w-px h-4 bg-gray-200 mx-1"}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-all",title:"More options",children:e.jsx(M,{size:18})})]})]})]}),e.jsxs("div",{className:"flex-1 flex min-h-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 relative overflow-hidden",children:[e.jsxs("div",{className:"flex-1 px-8 py-8 overflow-y-auto custom-scrollbar",children:[e.jsx("div",{className:"prose prose-sm max-w-none text-gray-800 leading-relaxed whitespace-pre-wrap font-sans",children:t.content}),t.attachments&&t.attachments.length>0&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-100",children:[e.jsx("h3",{className:"text-xs font-bold uppercase tracking-wider text-gray-400 mb-3",children:"Attachments"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:t.attachments.map(s=>e.jsxs("div",{className:"flex items-center p-3 bg-gray-50 border border-gray-200 rounded-xl text-sm hover:bg-gray-100 transition-colors cursor-pointer group",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg shadow-sm mr-3 group-hover:scale-105 transition-transform",children:e.jsx(W,{size:18,className:"text-blue-500"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-700",children:s.name}),e.jsx("span",{className:"text-[10px] text-gray-400 uppercase",children:s.type.split("/")[1]||"FILE"})]})]},s.id))})]})]}),e.jsx("div",{className:"p-6 bg-white border-t border-gray-100 z-10",children:e.jsxs("div",{className:"relative bg-white border border-gray-200 rounded-2xl shadow-sm focus-within:ring-2 focus-within:ring-blue-500/20 focus-within:border-blue-500 transition-all overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 bg-gray-50/50 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-gray-400",children:[e.jsx(ne,{size:14}),e.jsxs("span",{className:"text-xs font-medium",children:["Replying to ",e.jsx("span",{className:"text-gray-700",children:c(t.senderId).name})]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx(_,{size:14,onClick:()=>{var s;return(s=N.current)==null?void 0:s.click()}})})]}),e.jsx("textarea",{className:"w-full p-4 min-h-[100px] focus:outline-none text-sm resize-none placeholder-gray-400",placeholder:"Write your reply...",value:p,onChange:s=>h(s.target.value)}),e.jsxs("div",{className:"px-4 py-3 bg-white flex justify-between items-center",children:[e.jsx("input",{type:"file",ref:N,className:"hidden",onChange:b}),e.jsx("div",{className:"text-xs text-gray-400",children:"Press Cmd+Enter to send"}),e.jsxs("button",{onClick:y,disabled:!p.trim(),className:"bg-black text-white px-6 py-2 rounded-xl text-sm font-semibold flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-800 hover:shadow-lg hover:-translate-y-0.5 transition-all",children:[e.jsx("span",{children:"Send Reply"}),e.jsx(H,{size:14})]})]})]})})]}),e.jsxs("div",{className:"w-80 border-l border-gray-100 bg-gray-50/30 flex flex-col overflow-y-auto custom-scrollbar p-5 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),e.jsx("h3",{className:"text-sm font-bold text-gray-800",children:"Action Items"})]}),e.jsx("button",{onClick:o,className:"p-1.5 hover:bg-gray-100 rounded-lg text-gray-500 hover:text-gray-900 transition-colors",title:"Create Task",children:e.jsx(L,{size:14})})]}),e.jsxs("div",{className:"space-y-3",children:[["todo","inProgress","done"].map(s=>e.jsxs("div",{className:"space-y-1.5",children:[C[s].length>0&&e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-400 pl-1",children:s==="inProgress"?"In Progress":s}),e.jsx("div",{className:"space-y-2",children:C[s].map(i=>e.jsxs("div",{className:"bg-white p-2.5 rounded-lg shadow-sm border border-gray-200 group hover:shadow-md transition-all relative pr-7",children:[e.jsx("div",{className:"text-xs font-medium text-gray-800 mb-1 leading-tight",children:i.title}),e.jsxs("select",{value:i.status,onChange:S=>a(i.id,S.target.value),className:"w-full text-[10px] bg-gray-50 border-none rounded px-2 py-0.5 text-gray-500 focus:ring-0 cursor-pointer hover:bg-gray-100 transition-colors mt-0.5",children:[e.jsx("option",{value:"todo",children:"To Do"}),e.jsx("option",{value:"inProgress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"})]}),e.jsx("button",{onClick:()=>x(i.id),className:"absolute top-2 right-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-0.5 rounded hover:bg-red-50",children:e.jsx(D,{size:12})})]},i.id))})]},s)),Object.values(C).flat().length===0&&e.jsxs("div",{className:"p-4 border-2 border-dashed border-gray-200 rounded-xl flex flex-col items-center justify-center text-center",children:[e.jsx("span",{className:"text-xs text-gray-400 mb-1",children:"No tasks yet"}),e.jsx("button",{onClick:o,className:"text-[10px] font-medium text-blue-600 hover:underline",children:"Create from email"})]})]})]}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-yellow-400"}),e.jsx("h3",{className:"text-sm font-bold text-gray-800",children:"Notes"})]}),e.jsx("button",{onClick:()=>k(s=>!s),className:"p-1.5 hover:bg-yellow-100 rounded-lg text-yellow-600 transition-colors",children:e.jsx(L,{size:14})})]}),I&&e.jsxs("div",{className:"bg-white rounded-xl p-2.5 shadow-sm border border-yellow-100 mb-3 space-y-2 animate-in slide-in-from-top-2 duration-200",children:[e.jsx("input",{className:"w-full text-xs font-medium placeholder-gray-400 focus:outline-none",placeholder:"Title",value:u,onChange:s=>g(s.target.value),autoFocus:!0}),e.jsx("textarea",{className:"w-full text-[10px] text-gray-600 placeholder-gray-300 focus:outline-none resize-none",placeholder:"Details...",rows:2,value:v,onChange:s=>w(s.target.value)}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-1",children:[e.jsx("button",{onClick:()=>k(!1),className:"text-[10px] text-gray-400 hover:text-gray-600",children:"Cancel"}),e.jsx("button",{onClick:r,className:"text-[10px] bg-yellow-400 text-yellow-900 px-2 py-0.5 rounded font-medium hover:bg-yellow-500 transition-colors",children:"Save"})]})]}),e.jsx("div",{className:"space-y-2",children:($=t==null?void 0:t.notes)!=null&&$.length?t.notes.map(s=>e.jsxs("div",{className:"bg-white p-2.5 rounded-lg shadow-sm border border-yellow-100/50 group relative pr-7",children:[e.jsx("div",{className:"font-semibold text-xs text-gray-800",children:s.title}),s.description&&e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:s.description}),e.jsx("button",{onClick:()=>n(s.id),className:"absolute top-2 right-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-0.5 rounded hover:bg-red-50",children:e.jsx(D,{size:12})})]},s.id)):e.jsx("div",{className:"p-3 bg-yellow-50/50 rounded-xl border border-yellow-100/50 text-center",children:e.jsx("p",{className:"text-xs text-gray-400 italic",children:"No notes attached."})})})]})]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-gray-50/30",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6 shadow-inner",children:e.jsx(F,{size:40,className:"text-gray-300"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Welcome to Inbox"}),e.jsx("p",{className:"text-gray-500 max-w-md text-center mb-8",children:"Select a message from the sidebar to view it, or start a new conversation."}),e.jsxs("button",{onClick:j,className:"px-8 py-3 bg-black text-white rounded-full font-semibold shadow-lg shadow-black/20 hover:shadow-xl hover:-translate-y-1 transition-all flex items-center space-x-2",children:[e.jsx(L,{size:18}),e.jsx("span",{children:"Compose Message"})]})]})})},oe=({currentUser:t,onClose:l,onSend:p})=>{const[h,y]=m.useState("u2"),[j,d]=m.useState(""),[c,I]=m.useState(""),[k,u]=m.useState(!1),[g,v]=m.useState([]),w=m.useRef(null),N=a=>{if(a.target.files&&a.target.files[0]){const n=a.target.files[0],x={id:Math.random().toString(36).slice(2),name:n.name,type:n.type,url:URL.createObjectURL(n)};v(b=>[...b,x])}},z=a=>{v(n=>n.filter(x=>x.id!==a))},r=async()=>{if(!(!j.trim()||!c.trim())){u(!0);try{await f.sendMessage(j,c,h,g),p(),l()}catch(a){console.error("Failed to send message",a)}finally{u(!1)}}},o=Object.values(P).filter(a=>a.id!=="me"&&a.id!==t.id);return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[85vh] animate-in zoom-in-95 duration-300 border border-gray-100",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between bg-white sticky top-0 z-10",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900 tracking-tight",children:"New Message"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-900 p-2 rounded-full hover:bg-gray-100 transition-all duration-200",children:e.jsx(ee,{size:20})})]}),e.jsxs("div",{className:"p-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wider text-gray-500 ml-1",children:"To"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:"w-full appearance-none bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-medium text-gray-900 focus:outline-none focus:ring-2 focus:ring-black/5 focus:border-black transition-all cursor-pointer hover:bg-gray-100",value:h,onChange:a=>y(a.target.value),children:o.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.email,")"]},a.id))}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500",children:e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M1 1L5 5L9 1",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wider text-gray-500 ml-1",children:"Subject"}),e.jsx("input",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-medium text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-black/5 focus:border-black transition-all hover:bg-gray-100",placeholder:"What's this about?",value:j,onChange:a=>d(a.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wider text-gray-500 ml-1",children:"Message"}),e.jsx("textarea",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-black/5 focus:border-black min-h-[200px] resize-none transition-all hover:bg-gray-100",placeholder:"Write your message...",value:c,onChange:a=>I(a.target.value)})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:g.map(a=>e.jsxs("div",{className:"flex items-center p-2 pl-3 bg-white border border-gray-200 rounded-lg text-xs group shadow-sm",children:[e.jsx(W,{size:14,className:"text-blue-500 mr-2"}),e.jsx("span",{className:"text-gray-700 font-medium max-w-[150px] truncate",children:a.name}),e.jsx("button",{onClick:()=>z(a.id),className:"ml-2 text-gray-400 hover:text-red-500 p-1 rounded hover:bg-red-50 transition-colors",children:e.jsx(D,{size:14})})]},a.id))})]}),e.jsxs("div",{className:"px-8 py-5 border-t border-gray-100 bg-white flex items-center justify-between sticky bottom-0 z-10",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"file",ref:w,className:"hidden",onChange:N}),e.jsxs("button",{className:"text-gray-500 hover:text-gray-900 p-2.5 rounded-lg hover:bg-gray-100 transition-all flex items-center space-x-2 group",title:"Attach file",onClick:()=>{var a;return(a=w.current)==null?void 0:a.click()},children:[e.jsx(_,{size:20,className:"group-hover:-rotate-45 transition-transform duration-300"}),e.jsx("span",{className:"text-sm font-medium",children:"Attach"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-2.5 text-sm font-semibold text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-xl transition-all",children:"Cancel"}),e.jsx("button",{onClick:r,disabled:!j.trim()||!c.trim()||k,className:"px-8 py-2.5 text-sm font-bold bg-black text-white rounded-xl hover:bg-gray-800 hover:shadow-lg hover:-translate-y-0.5 transition-all flex items-center disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0 disabled:hover:shadow-none",children:k?"Sending...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Send Message"}),e.jsx(H,{size:16,className:"ml-2"})]})})]})]})]})})},ue=()=>{const[t,l]=m.useState([]),[p,h]=m.useState(null),[y,j]=m.useState(!0),[d,c]=m.useState(""),[I,k]=m.useState("inbox"),{showToast:u}=O(),g=P.u1,[v,w]=m.useState(!1);m.useEffect(()=>{N()},[]);const N=async()=>{j(!0);try{const n=await f.getMessages();l(n.sort((x,b)=>new Date(b.timestamp).getTime()-new Date(x.timestamp).getTime()))}catch(n){console.error(n)}finally{j(!1)}},z=async n=>{h(n);const x=t.find(b=>b.id===n);x&&!x.isRead&&x.recipientId===g.id&&(l(b=>b.map(C=>C.id===n?{...C,isRead:!0}:C)),await f.markMessageRead(n))},r=async()=>{if(!d.trim())return;const n=t.find(C=>C.id===p);if(!n)return;const x=`Re: ${n.subject}`,b=n.senderId===g.id?n.recipientId:n.senderId;u("Sending...","info");try{await f.sendMessage(x,d,b),c(""),u("Reply sent!","success"),N()}catch{u("Failed to send","error")}},o=t.find(n=>n.id===p),a=async n=>{try{await f.deleteMessage(n),l(x=>x.filter(b=>b.id!==n)),p===n&&h(null),u("Message deleted","success")}catch{u("Failed to delete message","error")}};return e.jsxs("div",{className:"flex h-full bg-white overflow-hidden animate-in fade-in duration-300 relative",children:[e.jsx(ie,{isLoading:y,messages:t,selectedId:p,filter:I,currentUser:g,onLoadMessages:N,onSetFilter:k,onSelectMessage:z,onDeleteMessage:a}),e.jsx(le,{selectedMessage:o,currentUser:g,replyText:d,onReplyChange:c,onSendReply:r,onOpenCompose:()=>w(!0),onUpdateMessage:N}),v&&e.jsx(oe,{currentUser:g,onClose:()=>w(!1),onSend:()=>{u("Message sent!","success"),N()}})]})};export{ue as default};
