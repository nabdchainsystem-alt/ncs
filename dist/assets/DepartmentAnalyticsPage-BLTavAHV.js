import{c as Ke,b0 as Je,b1 as Se,b2 as Te,b3 as Xe,b4 as Re,b5 as He,r as j,b6 as Ae,b7 as Qe,b8 as We,b9 as oe,L as qe,ad as B,a3 as ae,aW as De,R as O,j as e,aF as Ie,V as Ze,W as Le,ba as Ue,bb as et,aB as H,ao as tt,al as st,T as nt,l as ot,aT as rt,U as at,aX as lt,bc as it,an as Ce,aY as ct,Q as dt}from"./index-sqQsKImc.js";import{C as ut}from"./CustomTable-B9-wr1nT.js";import{T as mt,K as pt}from"./KPICard-DhHyeAa_.js";import{C as xt}from"./ChartWidget-DW4yHRFh.js";import{M as re}from"./minus-CDGUDZnw.js";import"./xlsx-bcnoXpwv.js";import"./DropdownCell-CSE_WS_c.js";import"./smile-CQ81lmMB.js";import"./phone-7-BcSGjI.js";import"./type-L4PgBd7E.js";import"./tag-Dqtpp501.js";import"./paperclip-BPOrNbhc.js";import"./star-hYvHy8aM.js";import"./arrow-up-down-Cf4uiBIA.js";import"./index-CG6KNRPH.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],ht=Ke("columns-2",ft);function bt(...n){const r=!Array.isArray(n[0]),a=r?0:-1,l=n[0+a],o=n[1+a],m=n[2+a],p=n[3+a],k=Je(o,m,p);return r?k(l):k}function gt(n,r,a){const l=n.get();let o=null,m=l,p;const k=typeof l=="string"?l.replace(/[\d.-]/g,""):void 0,M=()=>{o&&(o.stop(),o=null)},T=()=>{M(),o=new Xe({keyframes:[ke(n.get()),ke(m)],velocity:n.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...a,onUpdate:p})};if(n.attach((C,_)=>{m=C,p=P=>_(Ne(P,k)),Se.postRender(T)},M),Te(r)){const C=r.on("change",P=>n.set(Ne(P,k))),_=n.on("destroy",C);return()=>{C(),_()}}return M}function Ne(n,r){return r?n+r:n}function ke(n){return typeof n=="number"?n:parseFloat(n)}function ie(n){const r=Re(()=>He(n)),{isStatic:a}=j.useContext(Ae);if(a){const[,l]=j.useState(n);j.useEffect(()=>r.on("change",l),[])}return r}function ze(n,r){const a=ie(r()),l=()=>a.set(r());return l(),Qe(()=>{const o=()=>Se.preRender(l,!1,!0),m=n.map(p=>p.on("change",o));return()=>{m.forEach(p=>p()),We(l)}}),a}function yt(n){oe.current=[],n();const r=ze(oe.current,n);return oe.current=void 0,r}function le(n,r,a,l){if(typeof n=="function")return yt(n);const o=typeof r=="function"?r:bt(r,a,l);return Array.isArray(n)?we(n,o):we([n],([m])=>o(m))}function we(n,r){const a=Re(()=>[]);return ze(n,()=>{a.length=0;const l=n.length;for(let o=0;o<l;o++)a[o]=n[o].get();return r(a)})}function vt(n,r={}){const{isStatic:a}=j.useContext(Ae),l=()=>Te(n)?n.get():n;if(a)return le(l);const o=ie(l());return j.useInsertionEffect(()=>gt(o,n,r),[o,JSON.stringify(r)]),o}const jt=({title:n,value:r,trend:a,trendDirection:l,icon:o,color:m})=>e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-start justify-between hover:shadow-md transition-shadow",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-xs font-semibold uppercase tracking-wider mb-1",children:n}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:r}),e.jsxs("div",{className:`flex items-center gap-1 text-xs font-medium ${l==="up"?"text-green-600":"text-red-600"}`,children:[l==="up"?e.jsx(Ie,{size:12}):e.jsx(mt,{size:12}),a]})]}),e.jsx("div",{className:"p-2 rounded-lg bg-opacity-10",style:{backgroundColor:`${m}20`,color:m},children:e.jsx(o,{size:20})})]}),Ct=({title:n="Executive Overview",subtitle:r="Performance Hub",description:a="Welcome to your central command center. This dashboard aggregates real-time data, providing actionable insights into your department's performance and operational efficiency.",stats:l=[],chartData:o,showWiki:m=!1})=>{const p=l.length>0?l:[{title:"Total Records",value:"0",trend:"0%",trendDirection:"up",icon:qe,color:"#3b82f6"},{title:"Active Widgets",value:"0",trend:"0%",trendDirection:"up",icon:B,color:"#8b5cf6"},{title:"Data Sources",value:"0",trend:"0%",trendDirection:"up",icon:ae,color:"#f59e0b"},{title:"Reports",value:"0",trend:"0%",trendDirection:"up",icon:De,color:"#10b981"}],[k,M]=O.useState(!0);return O.useEffect(()=>{const T=setTimeout(()=>M(!1),1500);return()=>clearTimeout(T)},[]),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-5 mb-5",children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-5 flex flex-col justify-center",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"inline-block px-2.5 py-0.5 bg-blue-50 text-blue-600 rounded-full text-[10px] font-bold tracking-wide uppercase mb-2",children:n}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:r}),e.jsxs("div",{className:"text-sm text-gray-500 max-w-3xl leading-relaxed space-y-2 text-justify",children:[e.jsx("p",{children:a}),e.jsx("p",{children:"Monitor key performance indicators and track operational efficiency in real-time. This dashboard provides a comprehensive view of your department's health, enabling data-driven decision-making and strategic planning."})]})]}),e.jsx("div",{className:"flex items-center gap-3 mt-4",children:m&&e.jsxs("a",{href:"/procurement_system_wiki.pdf",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-white bg-black border border-black rounded-md hover:bg-gray-800 transition-colors shadow-sm",children:[e.jsx(ae,{size:14,className:"mr-1.5 text-gray-300"}),"Procurement Wiki"]})}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-2 ml-1 flex items-center gap-1",children:[e.jsx(B,{size:10}),"Updated: Nov 28, 2025"]})]}),e.jsx("div",{className:"lg:col-span-7",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 h-full",children:p.map((T,C)=>e.jsx(jt,{...T},C))})})]})})})},Nt=({reports:n,onSelect:r,isVisible:a})=>{const l=ie(1/0);return e.jsx(Ze,{children:a&&e.jsx(Le.div,{initial:{x:120,opacity:0},animate:{x:0,opacity:1},exit:{x:120,opacity:0},transition:{type:"spring",stiffness:200,damping:25},className:"fixed right-6 top-1/2 -translate-y-1/2 z-40 flex flex-col gap-3 items-center py-6 px-3 rounded-full bg-white/10 backdrop-blur-2xl border border-white/20 shadow-2xl h-[80vh] justify-center",onMouseMove:o=>l.set(o.pageY),onMouseLeave:()=>l.set(1/0),children:n.map((o,m)=>e.jsx(kt,{mouseY:l,report:o,onClick:()=>r(o)},m))})})},kt=({mouseY:n,report:r,onClick:a})=>{const l=j.useRef(null),o=le(n,M=>{var C;const T=((C=l.current)==null?void 0:C.getBoundingClientRect())??{y:0,height:0};return M-T.y-T.height/2}),m=le(o,[-150,0,150],[50,90,50]),p=vt(m,{mass:.1,stiffness:150,damping:12}),k=wt(r);return e.jsxs(Le.div,{ref:l,style:{width:p,height:p},onClick:a,className:"aspect-square rounded-full bg-white/20 border border-white/30 flex items-center justify-center cursor-pointer hover:bg-white/40 transition-colors relative group shadow-lg backdrop-blur-sm",children:[e.jsx(k,{className:"w-1/2 h-1/2 text-white"}),e.jsx("div",{className:"absolute right-full mr-4 px-3 py-1.5 bg-black/70 backdrop-blur-md text-white text-sm font-medium rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none shadow-xl border border-white/10",children:r["Report Title"]})]})},wt=n=>{const r=n["Chart Type (ECharts)"]||"";return r.includes("Bar")?Ue:r.includes("Pie")?et:r.includes("Line")?Ie:r.includes("Table")?H:r.includes("Heatmap")?B:r.includes("Treemap")?tt:r.includes("Map")?st:ae},St=n=>{const r=n.split("/").filter(p=>p&&p!=="analytics"),a=r.length>1?r[r.length-1]:r[0]||"Department",l=p=>p.split(/[-_]/).map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(" ").replace(" And "," & "),o=l(a);l(r[0]||"Department");const m=n.includes("/procurement");return{title:"Executive Overview",subtitle:o,description:`Real-time insights and performance metrics for ${o}. Monitor key indicators and track operational efficiency.`,showWiki:m}},Yt=({activePage:n,allPageWidgets:r,widgets:a=[],onDeleteWidget:l,onUpdateWidget:o,onInsert:m,placeholderIcon:p,placeholderTitle:k="Department Analytics",placeholderDescription:M='Manage your department data and analytics here. Use the "Insert" menu to add custom tables and charts.',defaultStats:T=[]})=>{var xe,fe,he,be,ge,ye;const[C,_]=j.useState(null),[P,Z]=j.useState("select-table"),[Q,ce]=j.useState(null),[R,Y]=j.useState({}),[Tt,Ee]=j.useState(!1),[V,U]=j.useState(null),[Me,Ve]=j.useState([]),[Rt,de]=j.useState(!1),[W,ee]=j.useState(null);O.useEffect(()=>{const t=()=>ee(null);return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[]),O.useEffect(()=>{(async()=>{de(!0);try{let i="supply-chain",b="procurement";if(n){const h=n.split("/").filter(y=>y&&y!=="analytics");h.length>=2&&(i=h[0],b=h[1])}const f=await it.getReports(i,b);Ve(f)}catch(i){console.error("Failed to load reports:",i)}finally{de(!1)}})()},[n]);const A=n.includes("/data"),D=()=>{if(A)return a.filter(i=>i.type==="custom-table");if(n.includes("/analytics")){const t=n.replace("/analytics","/data");return(r[t]||[]).filter(b=>b.type==="custom-table")}return[]},ue=O.useRef(0);O.useEffect(()=>{if(A){const t=D();if(!V&&t.length>0&&U(t[0].id),t.length>ue.current){const i=t[t.length-1];i&&U(i.id)}ue.current=t.length}},[A,a,V]);const Fe=()=>{var y,K;if(A){const s=D().find(c=>c.id===V);if(!s)return[];const I=((y=s.rows)==null?void 0:y.length)||0,v=((K=s.columns)==null?void 0:K.length)||0,x=(s.rows||[]).reduce((c,d)=>c+Object.values(d.data).filter(u=>u===""||u===null||u===void 0).length,0);return[{title:"Total Records",value:I.toLocaleString(),trend:"Live",trendDirection:"up",icon:Ce,color:"#3b82f6"},{title:"Columns",value:v.toString(),trend:"Structure",trendDirection:"up",icon:ht,color:"#8b5cf6"},{title:"Empty Cells",value:x.toString(),trend:"Quality",trendDirection:"down",icon:ct,color:"#f59e0b"},{title:"Last Modified",value:"Just now",trend:"Active",trendDirection:"up",icon:dt,color:"#10b981"}]}const t=a.filter(s=>s.type==="custom-table"),i=a.filter(s=>s.type==="chart"),b=a.filter(s=>s.type==="kpi-card"),f=t.reduce((s,I)=>{var v;return s+(((v=I.rows)==null?void 0:v.length)||0)},0),h=a.length>0;return[{title:"Total Records",value:f.toLocaleString(),trend:h?"+12%":"-",trendDirection:"up",icon:Ce,color:"#3b82f6"},{title:"Active Tables",value:t.length.toString(),trend:h?"Stable":"-",trendDirection:"up",icon:H,color:"#8b5cf6"},{title:"Visualizations",value:(i.length+b.length).toString(),trend:h?"+2":"-",trendDirection:"up",icon:De,color:"#f59e0b"},{title:"Data Points",value:h?(f*5).toLocaleString():"0",trend:h?"+5%":"-",trendDirection:"up",icon:B,color:"#10b981"}]},$e=()=>{if(A){const f=D().find(y=>y.id===V);if(!f||!f.rows||f.rows.length===0)return{categories:["No Data"],values:[0]};const h=f.columns.find(y=>y.type==="text");if(h){const y={};f.rows.forEach(I=>{const v=I.data[h.id]||"Unknown";y[v]=(y[v]||0)+1});const K=Object.keys(y).slice(0,10),s=Object.values(y).slice(0,10);return{categories:K,values:s}}return{categories:["Row 1","Row 2","Row 3","Row 4","Row 5"],values:[10,20,15,25,18]}}const t=a.filter(f=>f.type==="custom-table");if(t.length===0)return{categories:["No Data"],values:[0]};const i=t.map(f=>f.title||"Untitled").slice(0,6),b=t.map(f=>{var h;return((h=f.rows)==null?void 0:h.length)||0}).slice(0,6);return{categories:i,values:b}},q=St(n),Oe=Fe(),_e=$e(),Ge=t=>{m==null||m("report-template",t)};O.useEffect(()=>{a.length>0&&Ee(!0)},[a.length]);const me=t=>{_(t),Z("select-table"),ce(null),Y({})},Pe=t=>{ce(t),Z("configure");const i=D().find(b=>b.id===t);if(i){const b=i.columns.find(h=>h.type==="text"),f=i.columns.find(h=>h.type==="number");Y({xAxisColumn:(b==null?void 0:b.id)||"",yAxisColumn:(f==null?void 0:f.id)||"",aggregation:"count"})}},Be=()=>{if(C&&Q){const t=D().find(i=>i.id===Q);o&&o(C,{sourceTableId:Q,title:(t==null?void 0:t.title)||"Connected Widget",config:R,subtext:R.aggregation==="sum"?"Total Value":"Count of records",trend:{value:"+12.5%",direction:"up"}})}_(null)},te=()=>D().find(t=>t.id===Q),pe=()=>a.find(t=>t.id===C);return a.filter(t=>t.type==="chart").length,e.jsxs("div",{className:"w-full h-full overflow-y-auto bg-gray-50/50",children:[e.jsx(Nt,{reports:Me,onSelect:Ge,isVisible:!1}),A&&a.length>0&&e.jsx("div",{className:"h-12 bg-white/80 backdrop-blur-md border-b border-gray-200/60 flex items-center px-8 gap-2 sticky top-0 z-20 flex-shrink-0 overflow-x-auto no-scrollbar",children:D().length===0?e.jsxs("div",{className:"flex items-center text-sm text-gray-400 italic",children:[e.jsx(H,{size:14,className:"mr-2"}),"Insert a table from the menu to get started..."]}):D().map(t=>e.jsxs("button",{onClick:()=>U(t.id),onContextMenu:i=>{i.preventDefault(),ee({x:i.clientX,y:i.clientY,tableId:t.id})},className:`
                                    px-3 py-1.5 rounded-lg text-sm font-medium transition-all whitespace-nowrap flex items-center gap-2 border relative
                                    ${V===t.id?"bg-black text-white border-black shadow-sm":"bg-white text-gray-600 hover:bg-gray-50 border-gray-200"}
                                `,children:[e.jsx(H,{size:14}),t.title||"Untitled Table"]},t.id))}),W&&e.jsx("div",{className:"fixed z-50 bg-white rounded-lg shadow-xl border border-gray-200 py-1 min-w-[160px] animate-in fade-in zoom-in-95 duration-100",style:{top:W.y,left:W.x},children:e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",onClick:()=>{l&&l(W.tableId),ee(null)},children:[e.jsx(nt,{size:14}),"Delete Table"]})}),(n.includes("/analytics")||A&&V)&&e.jsx("div",{className:"px-8 pt-6",children:e.jsx(Ct,{title:A?((xe=D().find(t=>t.id===V))==null?void 0:xe.title)||"Table Overview":q.title,subtitle:A?"Data Insights":q.subtitle,description:A?"Overview of records, data quality, and distribution.":q.description,stats:Oe,chartData:_e,showWiki:q.showWiki})}),C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden border border-gray-200 animate-in zoom-in-95 duration-200 flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between bg-gray-50/50",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:P==="select-table"?"Select Data Source":"Configure Data"}),e.jsx("button",{onClick:()=>_(null),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(re,{size:18,className:"rotate-45"})})]}),e.jsx("div",{className:"p-0 overflow-y-auto flex-1",children:P==="select-table"?e.jsx("div",{className:"p-2",children:D().length===0?e.jsxs("div",{className:"p-8 text-center flex flex-col items-center text-gray-500",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-3",children:e.jsx(B,{size:24,className:"text-gray-400"})}),e.jsx("p",{className:"font-medium",children:"No tables found"}),e.jsx("p",{className:"text-sm mt-1",children:"Create a table in the Data section first."})]}):e.jsx("div",{className:"space-y-1",children:D().map(t=>{var i;return e.jsxs("button",{className:"w-full text-left px-4 py-3 hover:bg-blue-50 rounded-lg group transition-colors flex items-center justify-between border border-transparent hover:border-blue-100",onClick:()=>Pe(t.id),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center mr-3 group-hover:bg-blue-200 transition-colors",children:e.jsx(H,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 group-hover:text-blue-700",children:t.title||"Untitled Table"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[((i=t.rows)==null?void 0:i.length)||0," records"]})]})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 text-blue-600 transition-opacity",children:e.jsx(ot,{size:16})})]},t.id)})})}):e.jsxs("div",{className:"p-6 space-y-6",children:[((fe=pe())==null?void 0:fe.type)==="chart"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"X Axis (Category)"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",value:R.xAxisColumn,onChange:t=>Y({...R,xAxisColumn:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Column..."}),(he=te())==null?void 0:he.columns.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Y Axis (Value)"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",value:R.yAxisColumn,onChange:t=>Y({...R,yAxisColumn:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Column..."}),(be=te())==null?void 0:be.columns.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),((ge=pe())==null?void 0:ge.type)==="kpi-card"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Metric"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",value:R.aggregation,onChange:t=>Y({...R,aggregation:t.target.value}),children:[e.jsx("option",{value:"count",children:"Count of Records"}),e.jsx("option",{value:"sum",children:"Sum of Column"}),e.jsx("option",{value:"avg",children:"Average of Column"})]})]}),R.aggregation!=="count"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Column"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",value:R.yAxisColumn,onChange:t=>Y({...R,yAxisColumn:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Column..."}),(ye=te())==null?void 0:ye.columns.filter(t=>t.type==="number").map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]})]})}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center",children:P==="select-table"?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Select a table to link."}),e.jsx("button",{className:"text-gray-600 hover:text-gray-900 font-medium",onClick:()=>_(null),children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"text-gray-600 hover:text-gray-900 font-medium",onClick:()=>Z("select-table"),children:"Back"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",onClick:Be,children:"Finish"})]})})]})}),e.jsxs("div",{className:"p-8 w-full overflow-x-auto",children:[e.jsx("div",{className:"grid grid-cols-12 gap-4 min-w-[1000px] grid-auto-rows-[minmax(175px,auto)]",children:(()=>{let t=a.filter(s=>s.layoutGroup),i=a.filter(s=>!s.layoutGroup);A&&V&&(i=i.filter(s=>s.id===V),t=[]);const b=[...i].sort((s,I)=>{const v={"kpi-card":1,chart:2,"custom-table":3};return(v[s.type]||99)-(v[I.type]||99)}),f=(s,I,v)=>I<=v?Math.floor(12/I):Math.floor(12/v),h=b.filter(s=>s.type==="kpi-card").length,y=b.filter(s=>s.type==="chart").length;return[...t,...b].map((s,I)=>{var v;if(s.type==="kpi-card"){const c={DollarSign:lt,Users:at,ShoppingBag:rt,Activity:B}[s.icon]||B;let d=s.value;if(s.sourceTableId){const w=n.replace("/analytics","/data"),G=(r[w]||[]).find(S=>S.id===s.sourceTableId);if(G){const S=s.config||{aggregation:"count"};if(S.aggregation==="count")d=(G.rows||[]).length.toString();else if(S.aggregation==="sum"&&S.yAxisColumn)d=(G.rows||[]).reduce(($,E)=>{const g=parseFloat(E.data[S.yAxisColumn])||0;return $+g},0).toLocaleString();else if(S.aggregation==="avg"&&S.yAxisColumn){const z=G.rows||[];z.length>0?d=(z.reduce((E,g)=>{const L=parseFloat(g.data[S.yAxisColumn])||0;return E+L},0)/z.length).toFixed(1):d="0"}else d=(G.rows||[]).length.toString()}}const u=s.layoutGroup&&s.layoutPosition<=4;let N={},F="col-span-3";return u?N={1:{gridColumn:"1 / 4",gridRow:"1"},2:{gridColumn:"4 / 7",gridRow:"1"},3:{gridColumn:"1 / 4",gridRow:"2"},4:{gridColumn:"4 / 7",gridRow:"2"}}[s.layoutPosition]||{}:F=`col-span-${f(0,h,4)}`,e.jsxs("div",{className:`relative group w-full h-full ${u?"":F}`,style:u?N:{},children:[e.jsx("div",{className:"absolute -right-2 -top-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx("button",{onClick:()=>l&&l(s.id),className:"bg-red-500 text-white p-1 rounded-full shadow-sm hover:bg-red-600",children:e.jsx(re,{size:12})})}),e.jsx(pt,{title:s.title,value:d,icon:c,trend:s.trend,subtext:s.subtext,isEmpty:!s.value&&!s.sourceTableId,onConnect:()=>me(s.id),onTitleChange:w=>o&&o(s.id,{title:w})})]},s.id)}if(s.type==="chart"){let x=s.data||null;if(s.sourceTableId){const N=n.replace("/analytics","/data"),w=(r[N]||[]).find(J=>J.id===s.sourceTableId);if(w&&w.rows&&w.rows.length>0){const J=s.config||{},G=J.xAxisColumn,S=J.yAxisColumn,z=w.columns||[];let $=G?z.find(g=>g.id===G):null,E=S?z.find(g=>g.id===S):null;if(!$||!E){const g=(v=s.config)==null?void 0:v.smartLogic;g&&g.requirements&&g.requirements.forEach(L=>{var je;const X=L.keywords||[],ve=((je=L.types)==null?void 0:je[0])||"text",se=z.find(ne=>(ne.type===ve||ve==="text"&&ne.type!=="number")&&X.some(Ye=>ne.name.toLowerCase().includes(Ye.toLowerCase())));se&&((L.key==="group_col"||L.key==="date_col")&&($=se),L.key==="amount_col"&&(E=se))})}if($||($=z.find(g=>g.type==="text"||g.type==="date")),E||(E=z.find(g=>g.type==="number")),$){const g=w.rows.map(X=>X.data[$.id]||"Unknown");let L;E?L=w.rows.map(X=>parseFloat(X.data[E.id])||0):L=w.rows.map(()=>1),x={categories:g,values:L}}}}const c=s.layoutGroup&&s.layoutPosition===5;let d={},u="col-span-6";if(c)d={gridColumn:"7 / 13",gridRow:"1 / 3"};else{const N=y===1?12:y===2?6:4;u=`col-span-${N}`,d={gridColumn:`span ${N} / span ${N}`}}return e.jsxs("div",{className:`row-span-2 min-h-[350px] relative group transition-all duration-300 ${c?"":u}`,style:d,children:[e.jsx("div",{className:"absolute -right-2 -top-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx("button",{onClick:()=>l&&l(s.id),className:"bg-red-500 text-white p-1 rounded-full shadow-sm hover:bg-red-600",children:e.jsx(re,{size:12})})}),e.jsx(xt,{title:s.title,type:s.chartType||"bar",data:x,isEmpty:!s.sourceTableId&&!s.data,onConnect:()=>me(s.id),onTitleChange:N=>o&&o(s.id,{title:N})})]},s.id)}return s.type==="custom-table"?e.jsx("div",{className:"col-span-12",children:e.jsx(ut,{...s,onDelete:()=>l&&l(s.id),onRenameTable:x=>o&&o(s.id,{title:x}),onRenameColumn:(x,c)=>{const d=s.columns.map(u=>u.id===x?{...u,name:c}:u);o&&o(s.id,{columns:d})},onAddColumn:(x,c)=>{const d={id:Date.now().toString(),name:(c==null?void 0:c.name)||"New Column",type:x,width:150,options:c==null?void 0:c.options,currency:c==null?void 0:c.currency},u=[...s.columns,d];o&&o(s.id,{columns:u})},onUpdateColumnType:(x,c)=>{const d=s.columns.map(u=>u.id===x?{...u,type:c}:u);o&&o(s.id,{columns:d})},onDeleteColumn:x=>{const c=s.columns.filter(d=>d.id!==x);o&&o(s.id,{columns:c})},onUpdateColumnColor:(x,c)=>{const d=s.columns.map(u=>u.id===x?{...u,color:c}:u);o&&o(s.id,{columns:d})},onUpdateRow:(x,c)=>{const d=s.rows||[],u=d.some(F=>F.id===x);let N;u?N=d.map(F=>F.id===x?{...F,data:c}:F):N=[...d,{id:x,data:c}],o&&o(s.id,{rows:N})},onRowsChange:x=>{o&&o(s.id,{rows:x})}})},s.id):null})})()}),a.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[p&&e.jsx("div",{className:"bg-indigo-50 p-6 rounded-full mb-6",children:O.isValidElement(p)?O.cloneElement(p,{className:"text-indigo-600",size:48}):p}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:k}),e.jsx("p",{className:"text-gray-500 max-w-md mb-8",children:M}),T.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-4xl",children:T.map((t,i)=>e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-gray-500 text-sm font-medium",children:t.label}),e.jsx(t.icon,{className:t.color,size:20})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:t.value})]},i))})]})]})]})};export{Yt as default};
