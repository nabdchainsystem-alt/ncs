import{r,p as m,aa as N,g as a,j as e,Q as X,af as he,P as pe,C as _,ak as ee,h as be,k as ye,l as te,T as se}from"./index-DYCMOhyY.js";import{u as fe,a as Z,K as je,P as ve,D as Ne,g as we,b as ke,e as De,f as Ce,C as Se}from"./core.esm-Dtb28RSd.js";import{r as w}from"./remindersService-D0e1lVE8.js";import{D as Te}from"./DatePicker-BjEDCiA7.js";import{C as O}from"./circle-BzEKEX28.js";import{G as Re}from"./grip-vertical-Cd79Tdtl.js";const Oe={u1:{id:"u1",name:"Max Nabd",avatar:"/founder.png",color:"#7B61FF",email:"max@nabdchain.com"},u2:{id:"u2",name:"Hasan Nabd",avatar:"HN",color:"#00E1D4",email:"hasan@nabdchain.com"},me:{id:"me",name:"You",avatar:"YOU",color:"#7b68ee",email:"me@workspace.local"}},E=({task:s,onToggleStatus:i,onDelete:l})=>{const{attributes:h,listeners:c,setNodeRef:p,transform:x,isDragging:g}=Ce({id:s.id,data:{type:"task",task:s}}),d={transform:Se.Translate.toString(x),opacity:g?.5:1,touchAction:"none"};return e.jsxs("div",{ref:p,style:d,className:"bg-white p-3 rounded-lg shadow-sm border border-gray-100 hover:shadow-md transition-shadow group relative mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{...h,...c,className:"mt-1 text-gray-300 hover:text-gray-500 cursor-grab active:cursor-grabbing",children:e.jsx(Re,{size:14})}),e.jsx("button",{onClick:()=>i(s),className:`mt-0.5 transition-colors ${s.status===a.Complete?"text-green-500 hover:text-green-600":"text-gray-400 hover:text-gray-600"}`,children:s.status===a.Complete?e.jsx(te,{size:16}):e.jsx(O,{size:16})}),e.jsxs("div",{className:"flex-1 min-w-0 pr-6",children:[e.jsx("h4",{className:`text-sm font-medium text-gray-900 truncate ${s.status===a.Complete?"line-through text-gray-400":""}`,children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[s.dueDate&&e.jsxs("span",{className:"flex items-center gap-1 text-orange-600 bg-orange-50 px-1.5 py-0.5 rounded",children:[e.jsx(_,{size:10}),new Date(s.dueDate).toLocaleDateString()]}),s.priority===m.High&&e.jsxs("span",{className:"flex items-center gap-1 text-red-600 bg-red-50 px-1.5 py-0.5 rounded",children:[e.jsx(ee,{size:10}),"High"]})]})]})]}),e.jsx("button",{onClick:f=>l(s,f),className:"absolute top-2 right-2 p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded bg-white opacity-0 group-hover:opacity-100 transition-all",title:"Delete",children:e.jsx(se,{size:14})})]})},k=({id:s,title:i,count:l,children:h,defaultOpen:c=!0})=>{const{setNodeRef:p,isOver:x}=De({id:s}),[g,d]=r.useState(c);return e.jsxs("div",{ref:p,className:`mb-4 rounded-lg transition-colors ${x?"bg-blue-50/50 ring-2 ring-blue-500/20":""}`,children:[e.jsxs("button",{onClick:()=>d(!g),className:"flex items-center w-full text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 hover:bg-gray-100 p-1.5 rounded transition-colors",type:"button",children:[g?e.jsx(be,{size:14,className:"mr-1"}):e.jsx(ye,{size:14,className:"mr-1"}),i," ",e.jsx("span",{className:"ml-2 text-gray-400 bg-gray-100 px-1.5 rounded-full text-[10px]",children:l})]}),g&&e.jsx("div",{className:"space-y-1 px-1 pb-2 min-h-[50px]",children:h})]})},Fe=({className:s="",contextId:i})=>{const[l,h]=r.useState("tasks"),[c,p]=r.useState([]),[x,g]=r.useState([]),[d,f]=r.useState(""),[ae,F]=r.useState(!1),[o,D]=r.useState(null),[re,L]=r.useState(null),[oe,C]=r.useState(!1),[b,T]=r.useState(m.Normal),[y,R]=r.useState(void 0),[H,U]=r.useState(!1),ne=fe(Z(ve,{activationConstraint:{distance:8}}),Z(je));r.useEffect(()=>{ie();const t=w.subscribe(K);return()=>t()},[i]);const ie=async()=>{F(!0),await Promise.all([j(),K()]),F(!1)},j=async()=>{try{const t=await N.getTasks(void 0,i);p(t)}catch(t){console.error("Failed to load tasks",t)}},K=async()=>{const t=await w.getReminders(i);g(t)},G=async t=>{if(d.trim()){if(l==="tasks")try{await N.createTask({title:d,status:a.Todo,priority:b,dueDate:y,assignees:[],tags:[],spaceId:i||"default"}),f(""),T(m.Normal),R(void 0),j()}catch(n){console.error("Failed to create task",n)}else w.addReminder({title:d,priority:b===m.Normal?"medium":b.toLowerCase(),dueDate:y,listId:i||"inbox",tags:[],completed:!1,subtasks:[]}),f(""),T(m.Normal),R(void 0);C(!1)}},le=()=>oe?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-3 animate-in slide-in-from-top-2 duration-200",children:[e.jsx("input",{type:"text",value:d,onChange:t=>f(t.target.value),placeholder:"What needs to be done?",className:"w-full text-sm font-medium border-none p-0 focus:ring-0 placeholder:text-gray-400 mb-3",autoFocus:!0,onKeyDown:t=>{t.key==="Enter"&&G(),t.key==="Escape"&&C(!1)}}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>U(!H),className:`flex items-center space-x-1 px-2 py-1 rounded text-xs font-medium transition-colors ${y?"bg-orange-50 text-orange-600":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,children:[e.jsx(_,{size:12}),e.jsx("span",{children:y?new Date(y).toLocaleDateString(void 0,{month:"short",day:"numeric"}):"Date"})]}),H&&e.jsx("div",{className:"absolute top-full left-0 mt-2 z-50",children:e.jsx(Te,{date:y,onSelect:R,onClose:()=>U(!1),className:"w-[280px] shadow-xl",compact:!0})})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:`flex items-center space-x-1 px-2 py-1 rounded text-xs font-medium transition-colors ${b===m.High||b===m.Urgent?"bg-red-50 text-red-600":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,children:[e.jsx(ee,{size:12}),e.jsx("span",{children:b})]}),e.jsx("div",{className:"absolute top-full left-0 mt-1 w-32 bg-white rounded-lg shadow-xl border border-gray-100 hidden group-hover:block z-50 overflow-hidden",children:Object.values(m).map(t=>e.jsx("button",{onClick:()=>T(t),className:"w-full text-left px-3 py-2 text-xs hover:bg-gray-50 transition-colors",children:t},t))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>C(!1),className:"px-2 py-1 text-xs font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>G(),disabled:!d.trim(),className:"px-3 py-1 bg-blue-600 text-white text-xs font-medium rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Add"})]})]})]}):e.jsxs("button",{onClick:()=>C(!0),className:"w-full flex items-center p-2 text-sm text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors border border-dashed border-gray-300 hover:border-gray-400",children:[e.jsx(pe,{size:16,className:"mr-2"}),"Add new ",l==="tasks"?"Task":"Reminder"]}),de=async()=>{o&&(o.type==="task"?(await N.deleteTask(o.id),j()):w.deleteReminder(o.id),D(null))},z=(t,n)=>{n.stopPropagation(),D({id:t.id,type:"task",title:t.title})},ce=(t,n)=>{n.stopPropagation(),D({id:t.id,type:"reminder",title:t.title})},I=async t=>{const n=t.status===a.Complete?a.Todo:a.Complete;await N.updateTask(t.id,{status:n}),j()},me=t=>{w.updateReminder(t.id,{completed:!t.completed})},xe=t=>{L(t.active.id)},ge=async t=>{const{active:n,over:J}=t;if(L(null),!J)return;const S=c.find(v=>v.id===n.id);if(!S)return;const A=J.id;let u=null;if(A==="todo-section"?u=a.Todo:A==="processing-section"?u=a.InProgress:A==="done-section"&&(u=a.Complete),u&&u!==S.status){p(v=>v.map($=>$.id===S.id?{...$,status:u}:$));try{await N.updateTask(S.id,{status:u})}catch(v){console.error("Failed to move task",v),j()}}},P=Array.isArray(c)?c:[],M=P.filter(t=>t.status===a.Todo),Y=P.filter(t=>t.status===a.InProgress||t.status===a.Review),B=P.filter(t=>t.status===a.Complete),Q=Array.isArray(x)?x:[],V=Q.filter(t=>!t.completed),W=Q.filter(t=>t.completed),q=t=>e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm border border-gray-100 hover:shadow-md transition-shadow group relative mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:()=>me(t),className:`mt-0.5 transition-colors ${t.completed?"text-green-500 hover:text-green-600":"text-gray-400 hover:text-gray-600"}`,children:t.completed?e.jsx(te,{size:16}):e.jsx(O,{size:16})}),e.jsxs("div",{className:"flex-1 min-w-0 pr-6",children:[e.jsx("h4",{className:`text-sm font-medium text-gray-900 truncate ${t.completed?"line-through text-gray-400":""}`,children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[t.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{size:10}),t.time]}),t.listId&&e.jsx("span",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-gray-600 capitalize",children:t.listId})]})]})]}),e.jsx("button",{onClick:n=>ce(t,n),className:"absolute top-2 right-2 p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded bg-white opacity-0 group-hover:opacity-100 transition-all",title:"Delete",children:e.jsx(se,{size:14})})]},t.id),ue=()=>e.jsxs(Ne,{sensors:ne,collisionDetection:we,onDragStart:xe,onDragEnd:ge,children:[e.jsx(k,{id:"todo-section",title:"To Do",count:M.length,children:M.map(t=>e.jsx(E,{task:t,onToggleStatus:I,onDelete:z},t.id))}),e.jsx(k,{id:"processing-section",title:"Processing",count:Y.length,children:Y.map(t=>e.jsx(E,{task:t,onToggleStatus:I,onDelete:z},t.id))}),e.jsx(k,{id:"done-section",title:"Done",count:B.length,defaultOpen:!1,children:B.map(t=>e.jsx(E,{task:t,onToggleStatus:I,onDelete:z},t.id))}),e.jsx(ke,{children:re?e.jsx("div",{className:"bg-white p-3 rounded-lg shadow-lg border border-gray-200",children:e.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded animate-pulse"})}):null})]});return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`w-80 bg-gray-50 border-l border-gray-200 flex flex-col h-full ${s}`,children:[e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{onClick:()=>h("tasks"),className:`flex-1 py-3 text-sm font-medium border-b-2 transition-colors ${l==="tasks"?"border-black text-black":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Project Tasks"}),e.jsx("button",{onClick:()=>h("reminders"),className:`flex-1 py-3 text-sm font-medium border-b-2 transition-colors ${l==="reminders"?"border-black text-black":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Reminders"})]}),e.jsx("div",{className:"p-4 bg-white border-b border-gray-200 flex-shrink-0",children:le()}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:ae?e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"Loading..."}):l==="tasks"?c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-gray-400 text-sm opacity-60",children:[e.jsx(O,{size:32,className:"mb-2"}),e.jsx("p",{children:"No tasks yet"})]}):ue():x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-gray-400 text-sm opacity-60",children:[e.jsx(X,{size:32,className:"mb-2"}),e.jsx("p",{children:"No reminders yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{id:"reminders-todo",title:"To Do",count:V.length,children:V.map(q)}),e.jsx(k,{id:"reminders-done",title:"Done",count:W.length,defaultOpen:!1,children:W.map(q)})]})}),e.jsx(he,{isOpen:!!o,onClose:()=>D(null),onConfirm:de,title:`Delete ${(o==null?void 0:o.type)==="task"?"Task":"Reminder"}`,message:`Are you sure you want to delete "${o==null?void 0:o.title}"? This action cannot be undone.`,confirmText:"Delete",variant:"danger"})]})})};export{Fe as R,Oe as U};
