import{r as i,j as e,ah as Z,a1 as pe,T as L,bd as fe,P as be,z as ye,k as je}from"./index-sqQsKImc.js";import{F as Ne,r as ve,u as we,S as Ce}from"./xlsx-bcnoXpwv.js";import{P as ke,D as Se,C as ze}from"./DropdownCell-CSE_WS_c.js";import{A as Pe}from"./arrow-up-down-Cf4uiBIA.js";import{S as Ee}from"./star-hYvHy8aM.js";const Me=[{name:"Default",value:"transparent"},{name:"Red",value:"#fee2e2"},{name:"Green",value:"#dcfce7"},{name:"Blue",value:"#dbeafe"},{name:"Yellow",value:"#fef9c3"},{name:"Purple",value:"#f3e8ff"},{name:"Orange",value:"#ffedd5"}],Ie=10,He=({id:Te,title:ee,columns:w,showBorder:$e,headerColor:De,onDelete:V,onRenameTable:B,onRenameColumn:O,onAddColumn:U,onUpdateColumnType:Fe,onDeleteColumn:G,onUpdateColumnColor:Re,onUpdateRow:H,onRowsChange:c,rows:z})=>{const[y,j]=i.useState(z||[{id:"1",data:{}},{id:"2",data:{}},{id:"2",data:{}},{id:"3",data:{}}]),[l,N]=i.useState(1),[g,te]=i.useState(Ie),[P,_e]=i.useState([]),[D,W]=i.useState(!1),[Ae,Le]=i.useState(!1),[F,se]=i.useState([]),E=i.useRef(null),[o,re]=i.useState(null),[C,M]=i.useState(null),ae=t=>{se(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},ne=t=>{let s="asc";o&&o.key===t&&o.direction==="asc"&&(s="desc"),re({key:t,direction:s})},ie=async t=>{var a;const s=(a=t.target.files)==null?void 0:a[0];if(!s)return;const r=new FileReader;r.onload=x=>{var S;try{const I=(S=x.target)==null?void 0:S.result,Y=ve(I,{type:"binary"}),ue=Y.SheetNames[0],xe=Y.Sheets[ue],A=we.sheet_to_json(xe,{header:1});if(A.length===0){alert("Excel file is empty!");return}const me=A[0],J=A.slice(1).filter(v=>v&&v.some(f=>f!=null&&f!==""));if(J.length===0){alert("No data rows found in Excel file!");return}const K={};me.forEach((v,f)=>{const T=w.find(h=>h.name.toLowerCase()===v.toString().toLowerCase());T&&(K[f]=T.id)});const Q=J.map((v,f)=>{const T=`imported-${Date.now()}-${f}`,h={};return v.forEach((n,he)=>{const b=K[he];if(!b)return;const $=w.find(d=>d.id===b);if($)if($.type==="checkbox")h[b]=n===!0||n==="true"||n==="TRUE"||n===1||n==="1";else if($.type==="number"){const d=Number(n);h[b]=isNaN(d)?n:d}else if($.type==="date")if(typeof n=="number"){const d=Ce.parse_date_code(n),ge=new Date(d.y,d.m-1,d.d);h[b]=ge.toISOString().split("T")[0]}else{const d=new Date(n);h[b]=isNaN(d.getTime())?(n==null?void 0:n.toString())||"":d.toISOString().split("T")[0]}else h[b]=n!=null?n.toString():""}),{id:T,data:h}}),X=[...y,...Q];j(X),c&&c(X),alert(`✅ Imported ${Q.length} rows!`)}catch(I){alert(`Failed to import Excel file: ${I instanceof Error?I.message:"Unknown error"}`)}},r.readAsBinaryString(s),E.current&&(E.current.value="")},R=w.filter(t=>!F.includes(t.id)),k=y.filter(t=>P.length===0?!0:P.every(s=>{const r=String(t.data[s.columnId]||"").toLowerCase(),a=s.value.toLowerCase();switch(s.operator){case"contains":return r.includes(a);case"equals":return r===a;case"starts_with":return r.startsWith(a);case"ends_with":return r.endsWith(a);default:return!0}})).sort((t,s)=>{if(!o)return 0;const r=t.data[o.key],a=s.data[o.key];if(r===a)return 0;const x=o.direction==="asc"?1:-1;return!isNaN(Number(r))&&!isNaN(Number(a))?(Number(r)-Number(a))*x:String(r).localeCompare(String(a))*x}),m=Math.ceil(k.length/g),q=k.slice((l-1)*g,l*g);i.useEffect(()=>{l>m&&m>0?N(m):l===0&&m>0&&N(1)},[k.length,m,l]),i.useEffect(()=>{z&&j(z)},[z]);const le=t=>{te(Number(t.target.value)),N(1)},oe=()=>{const t={};w.forEach(a=>{a.type==="date"&&(t[a.id]=new Date().toISOString().split("T")[0])});const s={id:Math.random().toString(36).substr(2,9),data:t},r=[...y,s];if(j(r),c&&c(r),P.length===0){const a=Math.ceil(r.length/g);N(a)}},p=(t,s,r)=>{const a=y.map(x=>{if(x.id===t){const S={...x.data,[s]:r};return H&&H(t,S),{...x,data:S}}return x});j(a),c&&c(a)},de=t=>{const s=y.filter(r=>r.id!==t);j(s),c&&c(s)},ce=(t,s)=>{const r=y.map(a=>a.id===t?{...a,color:s}:a);j(r),c&&c(r)},[u,_]=i.useState(null);return e.jsxs("div",{className:"mb-8 bg-white rounded-xl animate-in fade-in duration-500 flex flex-col",children:[e.jsxs("div",{className:"px-0 py-6 flex justify-between items-center bg-white shrink-0",children:[e.jsx("input",{type:"text",value:ee,onChange:t=>B&&B(t.target.value),className:"text-xl font-semibold text-gray-900 bg-transparent border-none focus:ring-0 p-0 w-full mr-4 placeholder-gray-300",placeholder:"Table Name"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:E,type:"file",accept:".xlsx, .xls",onChange:ie,className:"hidden"}),e.jsxs("button",{onClick:()=>{var t;return(t=E.current)==null?void 0:t.click()},className:"flex items-center space-x-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg text-sm font-medium transition-colors",title:"Import from Excel",children:[e.jsx("span",{children:"Import"}),e.jsx(Ne,{size:14})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>W(!D),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${D?"bg-gray-200 text-gray-900":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:[e.jsx("span",{children:"Filter"}),e.jsx(Z,{size:14,className:"text-gray-500"})]}),D&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>W(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-64 bg-white rounded-xl shadow-xl border border-gray-100 z-50 p-2 animate-in fade-in zoom-in-95 duration-100 ring-1 ring-black/5",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 px-3 mt-2",children:"Show/Hide Columns"}),e.jsx("div",{className:"space-y-0.5 max-h-60 overflow-y-auto custom-scrollbar",children:w.map(t=>e.jsxs("button",{onClick:()=>ae(t.id),className:"flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors group",children:[e.jsx("div",{className:`w-4 h-4 mr-3 rounded border flex items-center justify-center transition-colors ${F.includes(t.id)?"border-gray-300 group-hover:border-gray-400":"bg-blue-600 border-blue-600"}`,children:!F.includes(t.id)&&e.jsx(pe,{size:10,className:"text-white"})}),e.jsx("span",{className:"truncate font-medium",children:t.name||"Untitled"})]},t.id))})]})]})]}),V&&e.jsx("button",{onClick:V,className:"p-2 bg-red-50 hover:bg-red-100 text-red-500 hover:text-red-600 rounded-lg transition-colors",title:"Delete Table",children:e.jsx(L,{size:20})})]})]}),e.jsx("div",{className:"overflow-x-auto flex-1 scrollbar-hide border-t border-gray-100",children:e.jsxs("table",{className:"w-full border-collapse",style:{tableLayout:"fixed"},children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50/50 border-b border-gray-100",children:[R.map(t=>e.jsx("th",{className:"px-3 py-3 text-left relative group/header first:pl-4 cursor-pointer hover:bg-gray-100 transition-colors border-r border-b border-gray-200 hover:border-gray-300",onClick:()=>ne(t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"relative w-full flex items-center space-x-2",children:[e.jsx("span",{className:"invisible whitespace-pre text-xs font-medium text-gray-500 block min-w-[80px]",children:t.name||"Column"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>O&&O(t.id,s.target.value),onClick:s=>s.stopPropagation(),className:"absolute inset-0 w-full h-full bg-transparent border-none focus:ring-0 p-0 text-xs font-medium text-gray-500 hover:text-gray-700 transition-colors cursor-text"}),(o==null?void 0:o.key)===t.id&&e.jsx(Pe,{size:12,className:`text-gray-400 ${o.direction==="asc"?"rotate-0":"rotate-180"} transition-transform`})]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),G&&G(t.id)},className:"text-gray-300 hover:text-red-500 transition-colors p-1 opacity-0 group-hover/header:opacity-100 ml-2 shrink-0",title:"Delete Column",children:e.jsx(L,{size:12})})]})},t.id)),e.jsx("th",{className:"px-2 py-2 w-10",children:e.jsx("div",{className:"flex items-center justify-center relative group bg-gray-50/80",children:e.jsx("div",{className:"cursor-pointer w-6 h-6 rounded flex items-center justify-center transition-all duration-200 "+(C?"bg-gray-200 text-gray-900":"text-gray-400 hover:text-gray-700 hover:bg-gray-200/50"),onClick:t=>{t.stopPropagation();const s=t.currentTarget.getBoundingClientRect();M(C?null:{id:"table-add",rect:s})},title:"Add Column",children:e.jsx(ke,{className:"w-4 h-4"})})})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-50",children:q.length>0?q.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors group",style:{backgroundColor:t.color||"transparent"},children:[R.map(s=>e.jsx("td",{className:"p-0 align-middle first:pl-4 border-r border-b border-gray-200",style:{backgroundColor:s.color||"transparent"},children:s.type==="checkbox"?e.jsx("div",{className:"w-full h-full flex items-center justify-center py-4",children:e.jsx("input",{type:"checkbox",checked:t.data[s.id]||!1,onChange:r=>p(t.id,s.id,r.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"})}):s.type==="status"||s.type==="dropdown"?e.jsx("div",{className:"w-full h-full",children:e.jsx(Se,{options:s.options||[],value:t.data[s.id],onChange:r=>p(t.id,s.id,r)})}):s.type==="long_text"?e.jsx("div",{className:"relative w-full h-full",children:e.jsx("textarea",{value:t.data[s.id]||"",onChange:r=>p(t.id,s.id,r.target.value),className:"absolute inset-0 w-full h-full px-3 py-2 bg-transparent border-none focus:ring-2 focus:ring-inset focus:ring-blue-500/20 text-sm text-gray-600 placeholder-gray-300 resize-none leading-relaxed",placeholder:"..."})}):s.type==="money"?e.jsxs("div",{className:"relative w-full h-full flex items-center px-3",children:[e.jsx("span",{className:"text-gray-400 text-sm mr-1",children:s.currency==="EUR"?"€":s.currency==="GBP"?"£":"$"}),e.jsx("input",{type:"number",value:t.data[s.id]||"",onChange:r=>p(t.id,s.id,r.target.value),className:"w-full h-full bg-transparent border-none focus:ring-0 p-0 text-sm text-gray-600 placeholder-gray-300",placeholder:"0.00"})]}):s.type==="rating"?e.jsx("div",{className:"w-full h-full flex items-center px-3 space-x-1",children:[1,2,3,4,5].map(r=>e.jsx("button",{onClick:()=>p(t.id,s.id,r),className:"focus:outline-none transition-transform hover:scale-110",children:e.jsx(Ee,{size:16,className:`${(t.data[s.id]||0)>=r?"text-amber-400 fill-amber-400":"text-gray-300"}`})},r))}):s.type==="progress_manual"?e.jsxs("div",{className:"w-full h-full flex items-center px-3 space-x-2 group/progress",children:[e.jsxs("div",{className:"flex-1 h-2 bg-gray-100 rounded-full overflow-hidden relative cursor-pointer",children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 transition-all",style:{width:`${Math.min(100,Math.max(0,Number(t.data[s.id]||0)))}%`}}),e.jsx("input",{type:"range",min:"0",max:"100",value:t.data[s.id]||0,onChange:r=>p(t.id,s.id,r.target.value),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]}),e.jsxs("span",{className:"text-xs text-gray-500 w-8 text-right",children:[t.data[s.id]||0,"%"]})]}):e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("span",{className:"invisible whitespace-pre px-3 py-2 block min-w-[80px] text-sm text-gray-600",children:t.data[s.id]||"..."}),e.jsx("input",{type:s.type==="number"?"number":s.type==="date"?"date":s.type==="email"?"email":s.type==="phone"?"tel":"text",value:t.data[s.id]||"",onChange:r=>p(t.id,s.id,r.target.value),className:`absolute inset-0 w-full h-full px-3 py-2 bg-transparent border-none focus:ring-2 focus:ring-inset focus:ring-blue-500/20 text-sm text-gray-600 placeholder-gray-300 ${s.type==="website"?"text-blue-600 underline":""}`,placeholder:"..."})]})},s.id)),e.jsx("td",{className:"w-16 p-0 align-middle",children:e.jsxs("div",{className:"flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity space-x-1 px-2",children:[e.jsx("div",{className:"relative",children:e.jsx("button",{onClick:s=>{s.stopPropagation();const r=s.currentTarget.getBoundingClientRect();_((u==null?void 0:u.rowId)===t.id?null:{rowId:t.id,rect:r})},className:`text-gray-300 hover:text-blue-600 p-1.5 rounded-lg hover:bg-blue-50 transition-colors ${(u==null?void 0:u.rowId)===t.id?"text-blue-600 bg-blue-50":""}`,children:e.jsx(fe,{size:14})})}),e.jsx("button",{onClick:()=>de(t.id),className:"text-gray-300 hover:text-red-500 p-1.5 rounded-lg hover:bg-red-50 transition-colors",title:"Delete Row",children:e.jsx(L,{size:14})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:R.length+1,className:"px-6 py-12 text-center text-gray-400 text-sm",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center",children:e.jsx(Z,{size:20,className:"text-gray-300"})}),e.jsx("span",{children:P.length>0?"No results match your filters":"No data available"})]})})})})]})}),e.jsxs("div",{className:"px-0 py-4 border-t border-gray-100 bg-white flex items-center justify-between shrink-0",children:[e.jsxs("button",{onClick:oe,className:"flex items-center space-x-2 px-3 py-1.5 text-sm font-medium text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 group",title:"Add Row",children:[e.jsx("div",{className:"w-5 h-5 rounded-md border border-gray-300 flex items-center justify-center group-hover:border-blue-300 transition-colors",children:e.jsx(be,{size:12})}),e.jsx("span",{children:"Add Row"})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Rows per page:"}),e.jsxs("select",{value:g,onChange:le,className:"text-xs border-none bg-gray-50 rounded px-2 py-1 focus:ring-0 cursor-pointer text-gray-700 font-medium",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(l-1)*g+1,"-",Math.min(l*g,k.length)," of ",k.length]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>N(t=>Math.max(1,t-1)),disabled:l===1,className:`p-1.5 rounded-lg transition-colors ${l===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:text-blue-600 hover:bg-blue-50"}`,children:e.jsx(ye,{size:16})}),e.jsx("button",{onClick:()=>N(t=>Math.min(m,t+1)),disabled:l===m,className:`p-1.5 rounded-lg transition-colors ${l===m?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:text-blue-600 hover:bg-blue-50"}`,children:e.jsx(je,{size:16})})]})]})]}),C&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>M(null)}),e.jsx("div",{className:"fixed z-50 animate-in fade-in zoom-in-95 duration-200",style:{top:C.rect.top-45,left:Math.min(window.innerWidth-350,C.rect.left-300),height:"auto",maxHeight:"600px"},children:e.jsx(ze,{onClose:()=>M(null),onSelect:(t,s,r,a)=>{U&&U(t,{name:s,options:r,currency:a}),M(null)}})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>_(null)}),e.jsx("div",{className:"fixed z-50 bg-white rounded-xl shadow-xl border border-gray-100 p-3 grid grid-cols-4 gap-2 w-40 ring-1 ring-black/5 animate-in fade-in zoom-in-95 duration-200",style:{top:u.rect.top-100,left:u.rect.left-140},children:Me.map(t=>e.jsx("button",{onClick:()=>{ce(u.rowId,t.value),_(null)},className:"w-6 h-6 rounded-full border border-gray-200 hover:scale-110 transition-transform",style:{backgroundColor:t.value},title:t.name},t.value))})]})]})};export{He as C};
