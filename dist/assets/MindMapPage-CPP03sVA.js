import{c as w,r as a,j as n,P as L,T as te}from"./index-BFP11Qd5.js";import{M as re}from"./minus-Hbm8BIDe.js";import{S as ne}from"./square-qcbVpdf_.js";import{T as oe}from"./type-B7tG-NZK.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ae=w("circle",se);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]],le=w("diamond",ie);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],de=w("redo",ce);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],ge=w("sticky-note",ue);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],fe=w("undo",xe),pe=[{name:"White",bg:"bg-white",border:"border-gray-200"},{name:"Blue",bg:"bg-blue-50",border:"border-blue-200"},{name:"Green",bg:"bg-green-50",border:"border-green-200"},{name:"Yellow",bg:"bg-yellow-50",border:"border-yellow-200"},{name:"Purple",bg:"bg-purple-50",border:"border-purple-200"},{name:"Red",bg:"bg-red-50",border:"border-red-200"}],B=[{name:"Yellow",bg:"bg-yellow-100",border:"border-yellow-200"},{name:"Blue",bg:"bg-blue-100",border:"border-blue-200"},{name:"Green",bg:"bg-green-100",border:"border-green-200"},{name:"Pink",bg:"bg-pink-100",border:"border-pink-200"}],W=[{id:"1",x:0,y:0,text:"Central Idea",color:"bg-white border-gray-200",width:180,height:60,type:"default"}],we=({mapId:be})=>{const[p,b]=a.useState(W),[y,N]=a.useState([]),[c,S]=a.useState(1),[l,j]=a.useState({x:0,y:0}),[$,X]=a.useState([{nodes:W,edges:[]}]),[u,M]=a.useState(0),T=a.useRef(p),O=a.useRef(y);a.useEffect(()=>{T.current=p},[p]),a.useEffect(()=>{O.current=y},[y]);const g=a.useRef({isDraggingCanvas:!1,dragStart:{x:0,y:0},draggingNodeId:null,nodeDragOffset:{x:0,y:0},connectingNodeId:null}),[x,R]=a.useState(null),[E,D]=a.useState(null),[P,H]=a.useState({x:0,y:0}),d=a.useRef(null),k=a.useRef(null),Y=a.useRef(!1);a.useEffect(()=>{if(!Y.current&&d.current){const e=d.current.getBoundingClientRect();j({x:e.width/2-90,y:e.height/2-30}),Y.current=!0}},[]);const I=a.useCallback(()=>{const e=T.current,t=O.current,r={nodes:JSON.parse(JSON.stringify(e)),edges:JSON.parse(JSON.stringify(t))};X(o=>{const s=o.slice(0,u+1);return s.push(r),s}),M(o=>o+1)},[u]),h=a.useRef(I);a.useEffect(()=>{h.current=I},[I]);const A=()=>{if(u>0){const e=$[u-1];b(e.nodes),N(e.edges),M(u-1)}},K=()=>{if(u<$.length-1){const e=$[u+1];b(e.nodes),N(e.edges),M(u+1)}},_=a.useRef({offset:l,scale:c});a.useEffect(()=>{_.current={offset:l,scale:c}},[l,c]);const z=a.useCallback((e,t)=>{var i;const r=k.current||((i=d.current)==null?void 0:i.getBoundingClientRect());if(!r)return{x:0,y:0};const{offset:o,scale:s}=_.current;return{x:(e-r.left-o.x)/s,y:(t-r.top-o.y)/s}},[]);a.useEffect(()=>{const e=r=>{const o=g.current;if(!o.isDraggingCanvas&&!o.draggingNodeId&&!o.connectingNodeId)return;r.preventDefault();const s=z(r.clientX,r.clientY);o.connectingNodeId&&H(s),o.isDraggingCanvas?j({x:r.clientX-o.dragStart.x,y:r.clientY-o.dragStart.y}):o.draggingNodeId&&b(i=>i.map(f=>f.id===o.draggingNodeId?{...f,x:s.x-o.nodeDragOffset.x,y:s.y-o.nodeDragOffset.y}:f))},t=()=>{const r=g.current;r.draggingNodeId&&setTimeout(()=>{h.current()},0),r.isDraggingCanvas=!1,r.draggingNodeId=null,r.connectingNodeId=null,D(null),k.current=null};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[z]);const q=e=>{if(d.current&&(k.current=d.current.getBoundingClientRect()),e.button===1||e.button===0&&e.altKey||e.button===0&&e.shiftKey){g.current.isDraggingCanvas=!0,g.current.dragStart={x:e.clientX-l.x,y:e.clientY-l.y};return}R(null)},J=e=>{if(e.ctrlKey||e.metaKey){e.preventDefault();const t=Math.exp(-e.deltaY*.001),r=Math.min(Math.max(.1,c*t),5),o=d.current.getBoundingClientRect(),s=(e.clientX-o.left-l.x)/c,i=(e.clientY-o.top-l.y)/c,f=e.clientX-o.left-s*r,v=e.clientY-o.top-i*r;S(r),j({x:f,y:v})}else j(t=>({x:t.x-e.deltaX,y:t.y-e.deltaY}))},m=(e="default")=>{const t=Date.now().toString();if(!d.current)return;const r=d.current.getBoundingClientRect(),o={x:(r.left+r.width/2-r.left-l.x)/c,y:(r.top+r.height/2-r.top-l.y)/c};let s=180,i=60,f="bg-white border-gray-200",v="New Node";if(e==="circle"&&(s=120,i=120),e==="diamond"&&(s=140,i=140),e==="sticky"){s=200,i=200;const C=B[Math.floor(Math.random()*B.length)];f=`${C.bg} ${C.border}`,v=""}e==="text"&&(s=200,i=40,f="bg-transparent border-transparent",v="Type something...");const ee={id:t,x:o.x-s/2,y:o.y-i/2,text:v,color:f,width:s,height:i,type:e};b(C=>[...C,ee]),setTimeout(()=>h.current(),0)},U=()=>{x&&(b(e=>e.filter(t=>t.id!==x)),N(e=>e.filter(t=>t.from!==x&&t.to!==x)),R(null),setTimeout(()=>h.current(),0))},G=e=>{x&&(b(t=>t.map(r=>r.id===x?{...r,color:e}:r)),setTimeout(()=>h.current(),0))},V=(e,t)=>{e.stopPropagation(),e.preventDefault(),d.current&&(k.current=d.current.getBoundingClientRect()),R(t.id),g.current.draggingNodeId=t.id;const r=z(e.clientX,e.clientY);g.current.nodeDragOffset={x:r.x-t.x,y:r.y-t.y}},Z=(e,t)=>{e.stopPropagation(),g.current.connectingNodeId=t,D(t)},F=(e,t)=>{e.stopPropagation();const r=g.current.connectingNodeId;r&&r!==t&&(y.some(s=>s.from===r&&s.to===t||s.from===t&&s.to===r)||(N(s=>[...s,{id:`${r}-${t}`,from:r,to:t}]),setTimeout(()=>h.current(),0))),g.current.connectingNodeId=null,D(null)},Q=e=>{const t=`absolute flex items-center justify-center group cursor-grab active:cursor-grabbing ${e.color} `,r=x===e.id?"ring-2 ring-brand-primary ring-offset-2 shadow-xl z-30":"shadow-sm hover:shadow-md z-10",o=e.type==="text"?"":"border";return e.type==="circle"?`${t} ${o} rounded-full aspect-square ${r}`:e.type==="diamond"?`${t} ${o} rotate-45 rounded-xl aspect-square ${r}`:e.type==="sticky"?`${t} ${o} shadow-md rounded-sm ${r} items-start p-4`:e.type==="text"?`${t} ${r} justify-start px-2`:`${t} ${o} rounded-xl ${r}`};return n.jsxs("div",{className:"flex-1 h-full bg-[#f8fafc] relative overflow-hidden flex flex-col font-sans",children:[n.jsxs("div",{ref:d,className:"flex-1 relative overflow-hidden bg-[#f8fafc]",onMouseDown:q,onWheel:J,style:{cursor:g.current.isDraggingCanvas?"grabbing":"default"},children:[n.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-40",style:{backgroundImage:"radial-gradient(#cbd5e1 1.5px, transparent 1.5px)",backgroundSize:`${24*c}px ${24*c}px`,backgroundPosition:`${l.x}px ${l.y}px`}}),n.jsxs("div",{style:{transform:`translate(${l.x}px, ${l.y}px) scale(${c})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"absolute",top:0,left:0},children:[n.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full overflow-visible pointer-events-none z-0",children:[Array.isArray(y)&&y.map(e=>{const t=p.find(i=>i.id===e.from),r=p.find(i=>i.id===e.to);if(!t||!r)return null;const o={x:t.x+t.width/2,y:t.y+t.height/2},s={x:r.x+r.width/2,y:r.y+r.height/2};return n.jsx("path",{d:`M ${o.x} ${o.y} C ${o.x} ${o.y+50}, ${s.x} ${s.y-50}, ${s.x} ${s.y}`,stroke:"#94a3b8",strokeWidth:"2",fill:"none"},e.id)}),E&&(()=>{const e=p.find(t=>t.id===E);return e?n.jsx("path",{d:`M ${e.x+e.width/2} ${e.y+e.height/2} L ${P.x} ${P.y}`,stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"5,5",fill:"none"}):null})()]}),Array.isArray(p)&&p.map(e=>n.jsxs("div",{className:Q(e),style:{left:e.x,top:e.y,width:e.width,height:e.height},onMouseDown:t=>V(t,e),onMouseUp:t=>F(t,e.id),children:[n.jsx("div",{className:e.type==="diamond"?"-rotate-45 flex items-center justify-center w-full h-full":"w-full h-full",children:n.jsx("textarea",{value:e.text,onChange:t=>b(r=>r.map(o=>o.id===e.id?{...o,text:t.target.value}:o)),onBlur:()=>h.current(),className:`bg-transparent w-full h-full outline-none resize-none cursor-text text-gray-800 font-medium placeholder-gray-400 ${e.type==="sticky"?"text-left text-lg p-2 leading-relaxed":e.type==="text"?"text-left text-xl":"text-center flex items-center justify-center"}`,style:{border:"none",padding:e.type==="default"?"0 10px":void 0},onClick:t=>t.stopPropagation(),placeholder:e.type==="sticky"?"Type your note...":e.type==="text"?"Type text...":"Label"})}),e.type!=="text"&&n.jsx("div",{className:`absolute -right-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-white border border-gray-200 rounded-full shadow-md flex items-center justify-center opacity-0 group-hover:opacity-100 cursor-crosshair hover:bg-brand-primary hover:text-white hover:border-brand-primary transition-all z-30 transform hover:scale-110 ${e.type==="diamond"?"translate-x-4":""}`,onMouseDown:t=>Z(t,e.id),children:n.jsx(L,{size:12})})]},e.id))]})]}),n.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 flex items-center space-x-4 z-50 pointer-events-none",children:[n.jsxs("div",{className:"bg-white/90 backdrop-blur rounded-xl shadow-sm border border-gray-200 p-1 flex items-center space-x-1 pointer-events-auto",children:[n.jsx("button",{onClick:A,disabled:u<=0,className:"p-2 hover:bg-gray-50 rounded-lg text-gray-600 disabled:opacity-30 transition-colors",children:n.jsx(fe,{size:18})}),n.jsx("button",{onClick:K,disabled:u>=$.length-1,className:"p-2 hover:bg-gray-50 rounded-lg text-gray-600 disabled:opacity-30 transition-colors",children:n.jsx(de,{size:18})})]}),x&&n.jsx("div",{className:"bg-white/90 backdrop-blur rounded-xl shadow-sm border border-gray-200 p-1 flex items-center space-x-1 pointer-events-auto animate-in fade-in zoom-in duration-200",children:pe.map(e=>n.jsx("button",{onClick:()=>G(`${e.bg} ${e.border}`),className:`w-6 h-6 rounded-full border border-gray-200 ${e.bg.replace("bg-","bg-")} hover:scale-110 transition-transform`,title:e.name},e.name))})]}),n.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 bg-white rounded-2xl shadow-2xl border border-gray-100 p-2 flex items-center space-x-2 z-50 animate-in slide-in-from-bottom-4 duration-300",children:[n.jsxs("div",{className:"flex items-center space-x-1 px-2",children:[n.jsx("button",{onClick:()=>S(e=>Math.max(.1,e-.1)),className:"p-2 hover:bg-gray-50 rounded-lg text-gray-500 transition-colors",children:n.jsx(re,{size:18})}),n.jsxs("span",{className:"text-xs font-bold w-12 text-center text-gray-700",children:[Math.round(c*100),"%"]}),n.jsx("button",{onClick:()=>S(e=>e+.1),className:"p-2 hover:bg-gray-50 rounded-lg text-gray-500 transition-colors",children:n.jsx(L,{size:18})})]}),n.jsx("div",{className:"w-[1px] h-8 bg-gray-100"}),n.jsxs("div",{className:"flex items-center space-x-1 px-2",children:[n.jsx("button",{onClick:()=>m("default"),className:"p-2.5 hover:bg-blue-50 hover:text-blue-600 rounded-xl text-gray-600 transition-all tooltip group relative",title:"Rectangle",children:n.jsx(ne,{size:20})}),n.jsx("button",{onClick:()=>m("circle"),className:"p-2.5 hover:bg-blue-50 hover:text-blue-600 rounded-xl text-gray-600 transition-all tooltip group relative",title:"Circle",children:n.jsx(ae,{size:20})}),n.jsx("button",{onClick:()=>m("diamond"),className:"p-2.5 hover:bg-blue-50 hover:text-blue-600 rounded-xl text-gray-600 transition-all tooltip group relative",title:"Diamond",children:n.jsx(le,{size:20})}),n.jsx("button",{onClick:()=>m("sticky"),className:"p-2.5 hover:bg-blue-50 hover:text-blue-600 rounded-xl text-gray-600 transition-all tooltip group relative",title:"Sticky Note",children:n.jsx(ge,{size:20})}),n.jsx("button",{onClick:()=>m("text"),className:"p-2.5 hover:bg-blue-50 hover:text-blue-600 rounded-xl text-gray-600 transition-all tooltip group relative",title:"Text",children:n.jsx(oe,{size:20})})]}),n.jsx("div",{className:"w-[1px] h-8 bg-gray-100"}),n.jsx("div",{className:"flex items-center space-x-1 px-2",children:n.jsx("button",{onClick:U,disabled:!x,className:`p-2.5 rounded-xl transition-all group relative ${x?"hover:bg-red-50 text-gray-600 hover:text-red-500":"text-gray-300 cursor-not-allowed"}`,children:n.jsx(te,{size:20})})})]}),n.jsx("div",{className:"absolute top-4 right-4 bg-white/80 backdrop-blur px-3 py-1.5 rounded-full text-[10px] font-medium text-gray-400 border border-gray-100 shadow-sm pointer-events-none select-none",children:"Hold Shift + Drag to pan"})]})};export{we as default};
