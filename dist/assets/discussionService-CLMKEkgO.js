const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DYCMOhyY.js","assets/index-CJkewufB.css"])))=>i.map(i=>d[i]);
import{r as p,ac as N,j as e,W as _,Y as y,X as C,H as S,aj as v,a7 as o,a5 as b}from"./index-DYCMOhyY.js";const k=({isOpen:r,onClose:t,onCreate:l})=>{const[a,n]=p.useState(""),[d,u]=p.useState([]),x=s=>{s.preventDefault(),a.trim()&&(l(a,d),n(""),u([]),t())},c=s=>{u(m=>m.includes(s)?m.filter(f=>f!==s):[...m,s])},[h,j]=p.useState([]);return N.useEffect(()=>{(async()=>{var g;const m=await v(()=>import("./index-DYCMOhyY.js").then(i=>i.bs),__vite__mapDeps([0,1])).then(i=>i.authService.getUsers()),w=(g=await v(()=>import("./index-DYCMOhyY.js").then(i=>i.bs),__vite__mapDeps([0,1])).then(i=>i.authService.getCurrentUser()))==null?void 0:g.id;j(m.filter(i=>i.id!==w))})()},[]),e.jsx(_,{children:r&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t}),e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Start New Discussion"}),e.jsx("button",{onClick:t,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(C,{size:20,className:"text-gray-500"})})]}),e.jsxs("form",{onSubmit:x,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discussion Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:a,onChange:s=>n(s.target.value),placeholder:"e.g. Project Alpha",className:"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add Participants"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-gray-100 rounded-lg p-2",children:h.map(s=>e.jsxs("div",{onClick:()=>c(s.id),className:`flex items-center p-2 rounded-md cursor-pointer transition-colors ${d.includes(s.id)?"bg-blue-50 border-blue-100":"hover:bg-gray-50"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold mr-3 overflow-hidden",style:{backgroundColor:s.color||"#3b82f6"},children:s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:s.name,className:"w-full h-full object-cover"}):(s.name||"?").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.email})]}),d.includes(s.id)&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})]},s.id))})]}),e.jsxs("div",{className:"flex justify-end pt-2",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 mr-2",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!a.trim(),className:"px-4 py-2 bg-[#1e2126] hover:bg-[#2c3036] text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Discussion"})]})]})]})]})})},D={getChannels:async()=>{const{data:r,error:t}=await o.from("channels").select("*").eq("company_id",b());return t?(console.error("Error fetching channels:",t),[]):r||[]},createChannel:async(r,t)=>{const l={id:Date.now().toString(),name:r,type:"public",participants:t,company_id:b()},{data:a,error:n}=await o.from("channels").insert(l).select().single();if(n)throw n;return a},deleteChannel:async r=>{const{error:t}=await o.from("channels").delete().eq("id",r);if(t)throw t},getMessages:async r=>{const{data:t,error:l}=await o.from("discussion_messages").select("*").eq("channel_id",r).order("timestamp",{ascending:!0});return l?(console.error("Error fetching messages:",l),[]):(t||[]).map(a=>({...a,channelId:a.channel_id,senderId:a.sender_id,sender:a.sender_name}))},sendMessage:async(r,t,l="me")=>{let a=l;const{data:n}=await o.from("users").select("*").eq("id",a).single(),d=(n==null?void 0:n.name)||"Unknown",u=(n==null?void 0:n.avatar_url)||"",x={id:Date.now().toString(),content:t,sender_id:a,sender_name:d,avatar:u,channel_id:r,timestamp:new Date().toISOString(),company_id:b()},{data:c,error:h}=await o.from("discussion_messages").insert(x).select().single();if(h)throw h;return{...c,channelId:c.channel_id,senderId:c.sender_id,sender:c.sender_name}}};export{k as C,D as d};
