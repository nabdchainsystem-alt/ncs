import{c as se,r as I,Z as ae,Y as Se,j as e,L as Mt,$ as es,a6 as ts,at as ss,T as Ke,X as Oe,a1 as Ve,m as dt,a8 as xt,u as rs,N as ut,q as $e,n as gt,P as He,S as ns,aG as as,R as mt,h as is,k as ht,al as pt,ae as os,aa as ls,aH as yt,M as cs,Q as ft,aI as ds,E as xs,I as us,V as gs,W as it,aJ as ms,az as hs}from"./index-sqQsKImc.js";import{T as Ce}from"./index-Ca_DMGSD.js";import{b as ps,c as ys,L as bt,D as fs,P as bs,S as ws,C as vs}from"./DropdownCell-CSE_WS_c.js";import{D as js}from"./DatePicker-pXxBGZdI.js";import{C as wt}from"./copy-BQSRc9CV.js";import{r as Ns}from"./remindersService-Dlo5WC4R.js";import{g as Cs}from"./goalsService-XSbMoi0L.js";import{u as $s,S as Ss,v as Ds,a as zs}from"./sortable.esm-BXA-dmXh.js";import{C as Is,u as ks,a as ot,T as Ps,M as As,D as _s,g as Es,b as Ts,d as Fs}from"./core.esm-TRimKU_7.js";import{L as Vs}from"./list-Dm11EKlK.js";import{L as Os}from"./list-ordered-5Rzf6Kqc.js";import{F as vt}from"./flag-DM0neTDo.js";import{P as Gs,A as Ls}from"./phone-7-BcSGjI.js";import{S as jt}from"./star-hYvHy8aM.js";import{C as lt}from"./corner-down-right-Dl5DQQhO.js";import{T as Rs}from"./tag-Dqtpp501.js";import{P as Bs,A as Hs}from"./pin-DjGnB7tA.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M20 8h-5",key:"1vsyxs"}],["path",{d:"M15 10V6.5a2.5 2.5 0 0 1 5 0V10",key:"ag13bf"}],["path",{d:"M15 14h5l-5 6h5",key:"ur5jdg"}]],Ws=se("arrow-down-a-z",Us);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M3 19V5",key:"rwsyhb"}],["path",{d:"m13 6-6 6 6 6",key:"1yhaz7"}],["path",{d:"M7 12h14",key:"uoisry"}]],qs=se("arrow-left-to-line",Js);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M17 12H3",key:"8awo09"}],["path",{d:"m11 18 6-6-6-6",key:"8c2y43"}],["path",{d:"M21 5v14",key:"nzette"}]],Xs=se("arrow-right-to-line",Ys);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M15 4h5l-5 6h5",key:"8asdl1"}],["path",{d:"M15 20v-3.5a2.5 2.5 0 0 1 5 0V20",key:"r6l5cz"}],["path",{d:"M20 18h-5",key:"18j1r2"}]],Qs=se("arrow-up-z-a",Ks);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],Ms=se("heading-1",Zs);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],tr=se("heading-2",er);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],rr=se("heading-3",sr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=[["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17 10v3a1 1 0 0 0 1 1h3",key:"tj5zdr"}],["path",{d:"M21 10v8",key:"1kdml4"}],["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}]],ar=se("heading-4",nr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Nt=se("maximize-2",ir);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=[["path",{d:"M14 14a2 2 0 0 0 2-2V8h-2",key:"1r06pg"}],["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M8 14a2 2 0 0 0 2-2V8H8",key:"1jzu5j"}]],lr=se("message-square-quote",or);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]],ct=se("move-right",cr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],xr=se("quote",dr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],gr=se("toggle-left",ur);var k=(t=>(t.New="New",t.Pending="Pending",t.Working="Working on it",t.Stuck="Stuck",t.AlmostFinish="Almost Finish",t.Done="Done",t))(k||{}),K=(t=>(t.Normal="Normal",t.Low="Low",t.Medium="Medium",t.High="High",t.Urgent="Urgent",t))(K||{});const Qe={New:"bg-gradient-to-r from-[#A0A5B9] to-[#8D92A6] text-white shadow-sm",Pending:"bg-gradient-to-r from-[#FFD940] to-[#FFCC00] text-white shadow-sm","Working on it":"bg-gradient-to-r from-[#FFBE66] to-[#FFA533] hover:from-[#FFA533] hover:to-[#FF991F] text-white shadow-sm",Stuck:"bg-gradient-to-r from-[#FF7085] to-[#FF526B] hover:from-[#FF526B] hover:to-[#FF3352] text-white shadow-sm","Almost Finish":"bg-gradient-to-r from-[#C48AF0] to-[#B06CE0] text-white shadow-sm",Done:"bg-gradient-to-r from-[#33D995] to-[#00C875] hover:from-[#00C875] hover:to-[#00B067] text-white shadow-sm"},mr={New:"bg-gradient-to-r from-slate-700 to-slate-600 text-white shadow-sm border border-white/10",Pending:"bg-gradient-to-r from-yellow-700 to-yellow-600 text-white shadow-sm border border-white/10","Working on it":"bg-gradient-to-r from-orange-700 to-orange-600 text-white shadow-sm border border-white/10",Stuck:"bg-gradient-to-r from-red-700 to-red-600 text-white shadow-sm border border-white/10","Almost Finish":"bg-gradient-to-r from-purple-700 to-purple-600 text-white shadow-sm border border-white/10",Done:"bg-gradient-to-r from-emerald-700 to-emerald-600 text-white shadow-sm border border-white/10"},ke={Normal:"bg-gradient-to-r from-[#D9D9D9] to-[#C4C4C4] text-white shadow-sm",Low:"bg-gradient-to-r from-[#82B4FF] to-[#579BFC] text-white shadow-sm",Medium:"bg-gradient-to-r from-[#FFBE66] to-[#FFA533] text-white shadow-sm",High:"bg-gradient-to-r from-[#7048C4] to-[#552CB0] text-white shadow-sm",Urgent:"bg-gradient-to-r from-[#FF7085] to-[#FF526B] text-white shadow-sm"},hr={Normal:"bg-gradient-to-r from-slate-700 to-slate-600 text-white shadow-sm border border-white/10",Low:"bg-gradient-to-r from-blue-700 to-blue-600 text-white shadow-sm border border-white/10",Medium:"bg-gradient-to-r from-orange-700 to-orange-600 text-white shadow-sm border border-white/10",High:"bg-gradient-to-r from-purple-700 to-purple-600 text-white shadow-sm border border-white/10",Urgent:"bg-gradient-to-r from-red-700 to-red-600 text-white shadow-sm border border-white/10"},Be=["#3B82F6","#10B981","#F59E0B","#EC4899","#8B5CF6","#0EA5E9","#7C3AED"],Ue=[{id:"p1",name:"Max",initials:"MA",color:"bg-gradient-to-br from-blue-400 to-blue-600"},{id:"p2",name:"Hasan",initials:"HA",color:"bg-gradient-to-br from-emerald-400 to-emerald-600"},{id:"p3",name:"Sarah",initials:"SA",color:"bg-gradient-to-br from-purple-400 to-purple-600"},{id:"p4",name:"John",initials:"JO",color:"bg-gradient-to-br from-amber-400 to-amber-600"}],Fe={id:"board-1",name:"Task Board",groups:[{id:"group-1",title:"New Group",color:"#579bfc",columns:[{id:"col_name",title:"Item",type:"name",width:"300px"},{id:"col_person",title:"Owner",type:"person",width:"96px"},{id:"col_status",title:"Status",type:"status",width:"128px"},{id:"col_priority",title:"Priority",type:"priority",width:"128px"},{id:"col_date",title:"Due Date",type:"date",width:"110px"}],tasks:[]}]};Ce.OBJECT,Ce.ARRAY,Ce.OBJECT,Ce.STRING,Ce.STRING,Ce.INTEGER,Ce.STRING;const pr=async t=>(console.warn("Gemini API key is missing. AI features are disabled."),null),yr=async t=>"AI features are disabled (missing API key).",fr=t=>{const[a,d]=I.useState(()=>{try{if(typeof window<"u"){const y=localStorage.getItem(t);if(y){const g=JSON.parse(y);if(g.columns&&Array.isArray(g.columns)&&g.groups){const b=g.groups.map(f=>({...f,columns:f.columns||[...g.columns]}));return{...g,groups:b}}if(g.groups&&Array.isArray(g.groups)){const b=g.groups.map(f=>f.columns&&Array.isArray(f.columns)?f:{...f,columns:[{id:"col_name",title:"Item",type:"name",width:"300px"},{id:"col_person",title:"Owner",type:"person",width:"96px"},{id:"col_status",title:"Status",type:"status",width:"128px"},{id:"col_priority",title:"Priority",type:"priority",width:"128px"},{id:"col_date",title:"Due Date",type:"date",width:"110px"}]});return{...g,groups:b}}}}}catch(y){console.warn("Failed to load saved board",y)}return JSON.parse(JSON.stringify(Fe))}),[r,o]=I.useState(""),[P,$]=I.useState(!1),[j,D]=I.useState(null);I.useEffect(()=>{const y=()=>{try{if(typeof window<"u"){const f=localStorage.getItem(t);if(f){const c=JSON.parse(f);if(c.columns&&Array.isArray(c.columns)&&c.groups){const z=c.groups.map(E=>({...E,columns:E.columns||[...c.columns]}));d({...c,groups:z});return}if(c.groups&&Array.isArray(c.groups)){const z=c.groups.map(E=>E.columns&&Array.isArray(E.columns)?E:{...E,columns:[{id:"col_name",title:"Item",type:"name",width:"300px"},{id:"col_person",title:"Owner",type:"person",width:"96px"},{id:"col_status",title:"Status",type:"status",width:"128px"},{id:"col_priority",title:"Priority",type:"priority",width:"128px"},{id:"col_date",title:"Due Date",type:"date",width:"110px"}]});d({...c,groups:z});return}d(c)}else d(JSON.parse(JSON.stringify(Fe)))}}catch(f){console.warn("Failed to load saved board on key change",f),d(JSON.parse(JSON.stringify(Fe)))}};y();const g=f=>{f.key===t&&y()},b=f=>{var c;((c=f.detail)==null?void 0:c.key)===t&&y()};return window.addEventListener("storage",g),window.addEventListener("local-storage-update",b),()=>{window.removeEventListener("storage",g),window.removeEventListener("local-storage-update",b)}},[t]),I.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(a))}catch(y){console.warn("Failed to save board",y)}},[a,t]);const h=(y,g,b)=>{d(f=>({...f,groups:f.groups.map(c=>c.id!==y?c:{...c,tasks:c.tasks.map(z=>z.id===g?{...z,...b}:z)})}))},p=(y,g,b)=>{h(y,g,{selected:b})},O=(y,g)=>{d(b=>({...b,groups:b.groups.map(f=>y!=="all"&&f.id!==y?f:{...f,tasks:f.tasks.map(c=>({...c,selected:g}))})}))},u=(y,g,b,f)=>{d(c=>({...c,groups:c.groups.map(z=>z.id!==y?z:{...z,tasks:z.tasks.map(E=>E.id!==g?E:{...E,textValues:{...E.textValues,[b]:f}})})}))},_=(y,g,b)=>{const f={id:ae(),name:(g==null?void 0:g.trim())||"New Item",status:k.New,priority:K.Normal,dueDate:new Date().toISOString().split("T")[0],personId:null,textValues:{},selected:!1,...b};d(c=>({...c,groups:c.groups.map(z=>z.id===y?{...z,tasks:[...z.tasks,f]}:z)}))},N=(y,g)=>{d(b=>({...b,groups:b.groups.map(f=>f.id===y?{...f,tasks:f.tasks.filter(c=>c.id!==g)}:f)}))},m=()=>{const y={id:ae(),title:"New Group",color:Be[a.groups.length%Be.length],columns:[{id:"col_name",title:"Item",type:"name",width:"300px"},{id:"col_person",title:"Owner",type:"person",width:"96px"},{id:"col_status",title:"Status",type:"status",width:"128px"},{id:"col_priority",title:"Priority",type:"priority",width:"128px"},{id:"col_date",title:"Due Date",type:"date",width:"110px"}],tasks:[],isPinned:!1};d(g=>({...g,groups:[...g.groups,y]}))},L=y=>{d(g=>({...g,groups:g.groups.filter(b=>b.id!==y)}))},Q=(y,g)=>{d(b=>({...b,groups:b.groups.map(f=>f.id===y?{...f,title:g}:f)}))},ie=y=>{d(g=>({...g,groups:g.groups.map(b=>b.id===y?{...b,isPinned:!b.isPinned}:b)}))},U=(y,g="text",b="New Column",f,c,z)=>{const B={id:`col_${ae().slice(0,4)}`,title:b==="New Column"&&g==="connection"?"Page Connections":b,type:g,width:"140px",options:f,currency:c};d(Z=>({...Z,groups:Z.groups.map(S=>S.id===y?{...S,columns:[...S.columns,B]}:S)}))},R=(y,g,b)=>{d(f=>({...f,groups:f.groups.map(c=>c.id!==y?c:{...c,columns:c.columns.map(z=>z.id===g?{...z,title:b}:z)})}))},Y=(y,g,b)=>{d(f=>({...f,groups:f.groups.map(c=>c.id!==y?c:{...c,columns:c.columns.map(z=>z.id===g?{...z,...b}:z)})}))},W=(y,g,b)=>{d(f=>({...f,groups:f.groups.map(c=>c.id!==y?c:{...c,columns:c.columns.map(z=>z.id===g?{...z,width:`${b}px`}:z)})}))},oe=(y,g)=>{d(b=>({...b,groups:b.groups.map(f=>f.id!==y?f:{...f,columns:f.columns.filter(c=>c.id!==g)})}))},he=(y,g)=>{d(b=>({...b,groups:b.groups.map(f=>{if(f.id!==y)return f;const c=f.columns.findIndex(Z=>Z.id===g);if(c===-1)return f;const z=f.columns[c],E={...z,id:`col_${ae().slice(0,4)}`,title:`${z.title} (Copy)`},B=[...f.columns];return B.splice(c+1,0,E),{...f,columns:B}})}))},i=(y,g,b)=>{d(f=>{const c=f.groups.find(B=>B.id===y);if(!c)return f;const z=[...c.columns],[E]=z.splice(g,1);return z.splice(b,0,E),{...f,groups:f.groups.map(B=>B.id!==y?B:{...B,columns:z})}})};return{board:a,setBoard:d,aiPrompt:r,setAiPrompt:o,isAiLoading:P,aiAnalysis:j,setAiAnalysis:D,updateTask:h,toggleTaskSelection:p,toggleGroupSelection:O,updateTaskTextValue:u,addTask:_,deleteTask:N,addGroup:m,deleteGroup:L,updateGroupTitle:Q,toggleGroupPin:ie,addColumn:U,updateColumn:Y,updateColumnTitle:R,updateColumnWidth:W,deleteColumn:oe,duplicateColumn:he,moveColumn:i,reorderColumn:(y,g,b)=>{i(y,g,b)},moveTask:(y,g,b,f)=>{d(c=>{const z=c.groups.find(S=>S.id===g),E=c.groups.find(S=>S.id===b);if(!z||!E)return c;const B=z.tasks.findIndex(S=>S.id===y);if(B===-1)return c;const Z={...z.tasks[B]};return f&&(Z.status=f),g===b?{...c,groups:c.groups.map(S=>S.id!==g?S:{...S,tasks:S.tasks.map(ue=>ue.id===y?Z:ue)})}:{...c,groups:c.groups.map(S=>S.id===g?{...S,tasks:S.tasks.filter(ue=>ue.id!==y)}:S.id===b?{...S,tasks:[...S.tasks,Z]}:S)}})},handleGeneratePlan:async()=>{if(!r.trim())return;$(!0),D(null);const y=await pr();if(y){const g=new Date,b=y.tasks.map(c=>{const z=new Date(g);return z.setDate(g.getDate()+c.dueDateOffsetDays),{id:ae(),name:c.name,status:k.New,priority:c.priority||K.Medium,dueDate:z.toISOString().split("T")[0],personId:null,textValues:{}}}),f={id:ae(),title:y.groupName||"AI Generated Plan",color:Be[Math.floor(Math.random()*Be.length)],tasks:b,columns:[{id:"col_name",title:"Item",type:"name",width:"300px"},{id:"col_person",title:"Owner",type:"person",width:"96px"},{id:"col_status",title:"Status",type:"status",width:"128px"},{id:"col_priority",title:"Priority",type:"priority",width:"128px"},{id:"col_date",title:"Due Date",type:"date",width:"110px"}]};d(c=>({...c,groups:[f,...c.groups]})),o("")}$(!1)},handleAnalyzeBoard:async()=>{$(!0),a.groups.map(g=>`Group: ${g.title}. Tasks: ${g.tasks.map(b=>`${b.name} (${b.status})`).join(", ")}`).join(`
`);const y=await yr();D(y),$(!1)}}},br=({x:t,y:a,onClose:d,onAction:r,darkMode:o})=>{let j=t,D=a;typeof window<"u"&&(t+256>window.innerWidth&&(j=t-256),a+400>window.innerHeight&&(D=a-400));const h={top:D,left:j},p=u=>{r(u),d()},{ref:O}=Se({onCancel:d,initialActive:!0});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-transparent",onClick:d,onContextMenu:u=>{u.preventDefault(),d()}}),e.jsx("div",{ref:O,className:`fixed z-50 rounded-lg shadow-xl border w-64 py-2 animate-in fade-in zoom-in-95 duration-100 ${o?"bg-[#1a1d24] border-gray-700":"bg-white border-gray-200"}`,style:h,onClick:u=>u.stopPropagation(),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("button",{onClick:()=>p("sort_asc"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(Ws,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Sort ascending"})]}),e.jsxs("button",{onClick:()=>p("sort_desc"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(Qs,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Sort descending"})]}),e.jsxs("button",{onClick:()=>p("group"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(Mt,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Group by this field"})]}),e.jsx("div",{className:`h-px my-1 ${o?"bg-gray-700":"bg-gray-100"}`}),e.jsxs("button",{onClick:()=>p("rename"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(ps,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Edit field"})]}),e.jsxs("button",{onClick:()=>p("permissions"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(es,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Privacy and permissions"})]}),e.jsx("div",{className:`h-px my-1 ${o?"bg-gray-700":"bg-gray-100"}`}),e.jsxs("button",{onClick:()=>p("move_start"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(qs,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Move to start"})]}),e.jsxs("button",{onClick:()=>p("move_end"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(Xs,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Move to end"})]}),e.jsxs("button",{onClick:()=>p("automate"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(ts,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Automate"})]}),e.jsx("div",{className:`h-px my-1 ${o?"bg-gray-700":"bg-gray-100"}`}),e.jsxs("button",{onClick:()=>p("hide"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(ss,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Hide column"})]}),e.jsxs("button",{onClick:()=>p("duplicate"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(wt,{size:16,className:"text-gray-500"}),e.jsx("span",{children:"Duplicate"})]}),e.jsxs("button",{onClick:()=>p("delete"),className:`flex items-center px-4 py-2 text-sm gap-3 ${o?"hover:bg-white/5 text-red-400":"hover:bg-red-50 text-red-600"}`,children:[e.jsx(Ke,{size:16,className:"text-red-500"}),e.jsx("span",{children:"Delete field"})]})]})})]})},wr=({isOpen:t,onClose:a,group:d,darkMode:r})=>{const[o,P]=I.useState(new Set);if(!t)return null;const $=h=>{const p=new Set(o);p.has(h)?p.delete(h):p.add(h),P(p)},j=()=>{const h=d.tasks.filter(p=>o.has(p.id));h.length!==0&&(Ns.addReminder({title:d.title||"Untitled Group",listId:"inbox",priority:"medium",dueDate:void 0,tags:[],completed:!1,subtasks:h.map(p=>({id:ae(),title:p.textValues.col_name||p.name||"Untitled Task",completed:p.status==="Done"}))}),a(),P(new Set))},D=()=>{o.size===d.tasks.length?P(new Set):P(new Set(d.tasks.map(h=>h.id)))};return e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:`backdrop-blur-xl rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-in zoom-in-95 duration-300 border ring-1 ring-black/5 flex flex-col max-h-[85vh] ${r?"bg-[#1a1d24]/95 border-gray-700":"bg-white/95 border-white/20"}`,children:[e.jsxs("div",{className:`px-6 py-5 border-b flex items-center justify-between ${r?"border-gray-700 bg-gradient-to-r from-gray-800/50 to-[#1a1d24]":"border-gray-100 bg-gradient-to-r from-gray-50/50 to-white"}`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold tracking-tight ${r?"text-gray-100":"text-gray-900"}`,children:"Send to Reminders"}),e.jsxs("p",{className:`text-sm mt-0.5 ${r?"text-gray-400":"text-gray-500"}`,children:["Select tasks from ",e.jsx("span",{className:`font-semibold ${r?"text-gray-300":"text-gray-700"}`,children:d.title})]})]}),e.jsx("button",{onClick:a,className:`p-2 rounded-full transition-all duration-200 active:scale-95 ${r?"hover:bg-white/10 text-gray-400 hover:text-gray-200":"hover:bg-gray-100 text-gray-400 hover:text-gray-600"}`,children:e.jsx(Oe,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-0",children:d.tasks.length===0?e.jsxs("div",{className:`text-center py-16 flex flex-col items-center gap-3 ${r?"text-gray-500":"text-gray-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${r?"bg-gray-800":"bg-gray-50"}`,children:e.jsx(Ve,{size:24,className:`${r?"text-gray-600":"text-gray-300"}`})}),e.jsx("p",{className:"font-medium",children:"No tasks in this group"})]}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:`backdrop-blur-md sticky top-0 z-10 shadow-sm ${r?"bg-gray-800/80":"bg-gray-50/80"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3.5 border-b w-[50px] ${r?"border-gray-700/80":"border-gray-200/80"}`,children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:o.size===d.tasks.length&&d.tasks.length>0,onChange:D,className:`rounded-md focus:ring-indigo-500/20 transition-all cursor-pointer ${r?"bg-gray-700 border-gray-600 text-indigo-500":"border-gray-300 text-indigo-600"}`})})}),e.jsx("th",{className:`px-4 py-3.5 text-xs font-bold uppercase tracking-wider border-b ${r?"text-gray-400 border-gray-700/80":"text-gray-500 border-gray-200/80"}`,children:"Task Name"}),e.jsx("th",{className:`px-4 py-3.5 text-xs font-bold uppercase tracking-wider border-b text-center w-[120px] ${r?"text-gray-400 border-gray-700/80":"text-gray-500 border-gray-200/80"}`,children:"Priority"}),e.jsx("th",{className:`px-4 py-3.5 text-xs font-bold uppercase tracking-wider border-b w-[140px] ${r?"text-gray-400 border-gray-700/80":"text-gray-500 border-gray-200/80"}`,children:"Due Date"})]})}),e.jsx("tbody",{className:`divide-y ${r?"divide-gray-800":"divide-gray-100"}`,children:d.tasks.map(h=>{const p=o.has(h.id),O=h.textValues.col_name||h.name||"Untitled Task";return e.jsxs("tr",{onClick:()=>$(h.id),className:`cursor-pointer transition-all duration-200 group ${p?r?"bg-indigo-900/20":"bg-indigo-50/60":r?"hover:bg-white/5":"hover:bg-gray-50/80"}`,children:[e.jsx("td",{className:"px-6 py-3.5 w-[50px]",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:p,onChange:()=>$(h.id),onClick:u=>u.stopPropagation(),className:`rounded-md focus:ring-indigo-500/20 transition-all cursor-pointer ${r?"bg-gray-700 border-gray-600 text-indigo-500":"border-gray-300 text-indigo-600"}`})})}),e.jsx("td",{className:"px-4 py-3.5",children:e.jsx("span",{className:`text-sm font-medium truncate block max-w-[320px] transition-colors ${p?r?"text-indigo-300":"text-indigo-900":r?"text-gray-300 group-hover:text-white":"text-gray-700 group-hover:text-gray-900"}`,children:O})}),e.jsx("td",{className:"px-4 py-3.5 text-center w-[120px]",children:e.jsx("div",{className:"flex justify-center transform transition-transform group-hover:scale-105",children:e.jsx("span",{className:`text-[11px] px-2.5 py-1 rounded-full text-white font-semibold shadow-sm tracking-wide ${ke[h.priority]||"bg-gray-400"}`,children:h.priority})})}),e.jsx("td",{className:"px-4 py-3.5 w-[140px]",children:e.jsx("span",{className:`text-sm font-mono transition-colors ${h.dueDate?r?"text-gray-400":"text-gray-600":r?"text-gray-600":"text-gray-300"}`,children:h.dueDate||"-"})})]},h.id)})})]})}),e.jsxs("div",{className:`px-6 py-4 border-t backdrop-blur-sm flex justify-end gap-3 ${r?"bg-gray-800/50 border-gray-700":"bg-gray-50/50 border-gray-100"}`,children:[e.jsx("button",{onClick:a,className:`px-5 py-2.5 text-sm font-medium rounded-xl transition-all duration-200 active:scale-95 ${r?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-600 hover:text-gray-900 hover:bg-gray-200/50"}`,children:"Cancel"}),e.jsxs("button",{onClick:j,disabled:o.size===0,className:"px-6 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 active:scale-95 rounded-xl shadow-lg shadow-blue-500/25 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none flex items-center gap-2",children:[e.jsx(Ve,{size:16,strokeWidth:2.5}),e.jsx("span",{children:"Send Tasks"}),o.size>0&&e.jsx("span",{className:"bg-white/20 px-1.5 py-0.5 rounded text-xs font-bold ml-1",children:o.size})]})]})]})})},vr=({isOpen:t,onClose:a,group:d,darkMode:r})=>{const[o,P]=I.useState(new Set);if(!t)return null;const $=h=>{const p=new Set(o);p.has(h)?p.delete(h):p.add(h),P(p)},j=()=>{const h=d.tasks.filter(p=>o.has(p.id));h.length!==0&&(Cs.createGoal({title:d.title||"Untitled Goal",category:"Work",dueDate:new Date().toISOString().split("T")[0],progress:0,status:"on-track",priority:"Medium",impact:"Medium",subGoals:h.map(p=>({id:ae(),title:p.textValues.col_name||p.name||"Untitled Milestone",completed:p.status==="Done"}))}).catch(p=>console.error("Failed to create goal from tasks",p)),a(),P(new Set))},D=()=>{o.size===d.tasks.length?P(new Set):P(new Set(d.tasks.map(h=>h.id)))};return e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:`backdrop-blur-xl rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-in zoom-in-95 duration-300 border ring-1 ring-black/5 flex flex-col max-h-[85vh] ${r?"bg-[#1a1d24]/95 border-gray-700":"bg-white/95 border-white/20"}`,children:[e.jsxs("div",{className:`px-6 py-5 border-b flex items-center justify-between ${r?"border-gray-700 bg-gradient-to-r from-gray-800/50 to-[#1a1d24]":"border-gray-100 bg-gradient-to-r from-gray-50/50 to-white"}`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold tracking-tight ${r?"text-gray-100":"text-gray-900"}`,children:"Send to Goals"}),e.jsxs("p",{className:`text-sm mt-0.5 ${r?"text-gray-400":"text-gray-500"}`,children:["Select tasks from ",e.jsx("span",{className:`font-semibold ${r?"text-gray-300":"text-gray-700"}`,children:d.title})]})]}),e.jsx("button",{onClick:a,className:`p-2 rounded-full transition-all duration-200 active:scale-95 ${r?"hover:bg-white/10 text-gray-400 hover:text-gray-200":"hover:bg-gray-100 text-gray-400 hover:text-gray-600"}`,children:e.jsx(Oe,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-0",children:d.tasks.length===0?e.jsxs("div",{className:`text-center py-16 flex flex-col items-center gap-3 ${r?"text-gray-500":"text-gray-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${r?"bg-gray-800":"bg-gray-50"}`,children:e.jsx(Ve,{size:24,className:`${r?"text-gray-600":"text-gray-300"}`})}),e.jsx("p",{className:"font-medium",children:"No tasks in this group"})]}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:`backdrop-blur-md sticky top-0 z-10 shadow-sm ${r?"bg-gray-800/80":"bg-gray-50/80"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3.5 border-b w-[50px] ${r?"border-gray-700/80":"border-gray-200/80"}`,children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:o.size===d.tasks.length&&d.tasks.length>0,onChange:D,className:`rounded-md focus:ring-indigo-500/20 transition-all cursor-pointer ${r?"bg-gray-700 border-gray-600 text-indigo-500":"border-gray-300 text-indigo-600"}`})})}),e.jsx("th",{className:`px-4 py-3.5 text-xs font-bold uppercase tracking-wider border-b ${r?"text-gray-400 border-gray-700/80":"text-gray-500 border-gray-200/80"}`,children:"Task Name"}),e.jsx("th",{className:`px-4 py-3.5 text-xs font-bold uppercase tracking-wider border-b text-center w-[120px] ${r?"text-gray-400 border-gray-700/80":"text-gray-500 border-gray-200/80"}`,children:"Priority"}),e.jsx("th",{className:`px-4 py-3.5 text-xs font-bold uppercase tracking-wider border-b w-[140px] ${r?"text-gray-400 border-gray-700/80":"text-gray-500 border-gray-200/80"}`,children:"Due Date"})]})}),e.jsx("tbody",{className:`divide-y ${r?"divide-gray-800":"divide-gray-100"}`,children:d.tasks.map(h=>{const p=o.has(h.id),O=h.textValues.col_name||h.name||"Untitled Task";return e.jsxs("tr",{onClick:()=>$(h.id),className:`cursor-pointer transition-all duration-200 group ${p?r?"bg-indigo-900/20":"bg-indigo-50/60":r?"hover:bg-white/5":"hover:bg-gray-50/80"}`,children:[e.jsx("td",{className:"px-6 py-3.5 w-[50px]",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:p,onChange:()=>$(h.id),onClick:u=>u.stopPropagation(),className:`rounded-md focus:ring-indigo-500/20 transition-all cursor-pointer ${r?"bg-gray-700 border-gray-600 text-indigo-500":"border-gray-300 text-indigo-600"}`})})}),e.jsx("td",{className:"px-4 py-3.5",children:e.jsx("span",{className:`text-sm font-medium truncate block max-w-[320px] transition-colors ${p?r?"text-indigo-300":"text-indigo-900":r?"text-gray-300 group-hover:text-white":"text-gray-700 group-hover:text-gray-900"}`,children:O})}),e.jsx("td",{className:"px-4 py-3.5 text-center w-[120px]",children:e.jsx("div",{className:"flex justify-center transform transition-transform group-hover:scale-105",children:e.jsx("span",{className:`text-[11px] px-2.5 py-1 rounded-full text-white font-semibold shadow-sm tracking-wide ${ke[h.priority]||"bg-gray-400"}`,children:h.priority})})}),e.jsx("td",{className:"px-4 py-3.5 w-[140px]",children:e.jsx("span",{className:`text-sm font-mono transition-colors ${h.dueDate?r?"text-gray-400":"text-gray-600":r?"text-gray-600":"text-gray-300"}`,children:h.dueDate||"-"})})]},h.id)})})]})}),e.jsxs("div",{className:`px-6 py-4 border-t backdrop-blur-sm flex justify-end gap-3 ${r?"bg-gray-800/50 border-gray-700":"bg-gray-50/50 border-gray-100"}`,children:[e.jsx("button",{onClick:a,className:`px-5 py-2.5 text-sm font-medium rounded-xl transition-all duration-200 active:scale-95 ${r?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-600 hover:text-gray-900 hover:bg-gray-200/50"}`,children:"Cancel"}),e.jsxs("button",{onClick:j,disabled:o.size===0,className:"px-6 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 active:scale-95 rounded-xl shadow-lg shadow-blue-500/25 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none flex items-center gap-2",children:[e.jsx(dt,{size:16,strokeWidth:2.5}),e.jsx("span",{children:"Send to Goals"}),o.size>0&&e.jsx("span",{className:"bg-white/20 px-1.5 py-0.5 rounded text-xs font-bold ml-1",children:o.size})]})]})]})})},jr=({isOpen:t,onClose:a,group:d,darkMode:r})=>{const[o,P]=I.useState(new Set),$=xt.getCurrentUser(),j=$?`taskboard-${$.id}`:"taskboard-default",{showToast:D}=rs(),h=N=>{const m=new Set(o);m.has(N)?m.delete(N):m.add(N),P(m)},p=()=>{const N=d.tasks.filter(m=>o.has(m.id));if(N.length!==0)try{const m=localStorage.getItem(j);let L;m?(L=JSON.parse(m),L.groups||(L={...Fe,...L})):L=Fe;const Q={id:ae(),title:d.title||"Imported Group",color:d.color,columns:[...d.columns],tasks:N.map(U=>({...U,id:ae()})),isPinned:!1},ie={...L,groups:[Q,...L.groups||[]]};localStorage.setItem(j,JSON.stringify(ie)),D(`Successfully sent ${N.length} tasks to your Tasks Board`,"success"),a(),P(new Set)}catch(m){console.error("Failed to send tasks:",m),D("Failed to send tasks. Please try again.","error")}},O=()=>{o.size===d.tasks.length?P(new Set):P(new Set(d.tasks.map(N=>N.id)))},{ref:u,setIsActive:_}=Se({onConfirm:p,onCancel:a,initialActive:t});return I.useEffect(()=>{_(t)},[t,_]),t?e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{ref:u,className:`backdrop-blur-xl rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-in zoom-in-95 duration-300 border ring-1 ring-black/5 flex flex-col max-h-[85vh] ${r?"bg-[#1a1d24]/95 border-gray-700":"bg-white/95 border-white/20"}`,children:[e.jsxs("div",{className:`px-6 py-5 border-b flex items-center justify-between ${r?"border-gray-700 bg-gradient-to-r from-gray-800/50 to-[#1a1d24]":"border-gray-100 bg-gradient-to-r from-gray-50/50 to-white"}`,children:[e.jsxs("div",{children:[e.jsxs("h2",{className:`text-xl font-bold tracking-tight flex items-center gap-2 ${r?"text-gray-100":"text-gray-900"}`,children:[e.jsx(ut,{className:"text-blue-600",size:24}),"Send to Tasks Board"]}),e.jsxs("p",{className:`text-sm mt-0.5 ${r?"text-gray-400":"text-gray-500"}`,children:["Select tasks from ",e.jsx("span",{className:`font-semibold ${r?"text-gray-300":"text-gray-700"}`,children:d.title})," to copy to your personal Tasks."]})]}),e.jsx("button",{onClick:a,className:`p-2 rounded-full transition-all duration-200 active:scale-95 ${r?"hover:bg-white/10 text-gray-400 hover:text-gray-200":"hover:bg-gray-100 text-gray-400 hover:text-gray-600"}`,children:e.jsx(Oe,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-0",children:d.tasks.length===0?e.jsxs("div",{className:`text-center py-16 flex flex-col items-center gap-3 ${r?"text-gray-500":"text-gray-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${r?"bg-gray-800":"bg-gray-50"}`,children:e.jsx(Ve,{size:24,className:`${r?"text-gray-600":"text-gray-300"}`})}),e.jsx("p",{className:"font-medium",children:"No tasks in this group"})]}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:`backdrop-blur-md sticky top-0 z-10 shadow-sm ${r?"bg-gray-800/80":"bg-gray-50/80"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3.5 border-b w-[50px] ${r?"border-gray-700/80":"border-gray-200/80"}`,children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:o.size===d.tasks.length&&d.tasks.length>0,onChange:O,className:`rounded-md focus:ring-indigo-500/20 transition-all cursor-pointer ${r?"bg-gray-700 border-gray-600 text-indigo-500":"border-gray-300 text-indigo-600"}`})})}),e.jsx("th",{className:`px-4 py-3.5 text-xs font-bold uppercase tracking-wider border-b ${r?"text-gray-400 border-gray-700/80":"text-gray-500 border-gray-200/80"}`,children:"Task Name"}),e.jsx("th",{className:`px-4 py-3.5 text-xs font-bold uppercase tracking-wider border-b text-center w-[120px] ${r?"text-gray-400 border-gray-700/80":"text-gray-500 border-gray-200/80"}`,children:"Priority"}),e.jsx("th",{className:`px-4 py-3.5 text-xs font-bold uppercase tracking-wider border-b w-[140px] ${r?"text-gray-400 border-gray-700/80":"text-gray-500 border-gray-200/80"}`,children:"Due Date"})]})}),e.jsx("tbody",{className:`divide-y ${r?"divide-gray-800":"divide-gray-100"}`,children:d.tasks.map(N=>{const m=o.has(N.id),L=N.textValues.col_name||N.name||"Untitled Task";return e.jsxs("tr",{onClick:()=>h(N.id),className:`cursor-pointer transition-all duration-200 group ${m?r?"bg-indigo-900/20":"bg-indigo-50/60":r?"hover:bg-white/5":"hover:bg-gray-50/80"}`,children:[e.jsx("td",{className:"px-6 py-3.5 w-[50px]",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:m,onChange:()=>h(N.id),onClick:Q=>Q.stopPropagation(),className:`rounded-md focus:ring-indigo-500/20 transition-all cursor-pointer ${r?"bg-gray-700 border-gray-600 text-indigo-500":"border-gray-300 text-indigo-600"}`})})}),e.jsx("td",{className:"px-4 py-3.5",children:e.jsx("span",{className:`text-sm font-medium truncate block max-w-[320px] transition-colors ${m?r?"text-indigo-300":"text-indigo-900":r?"text-gray-300 group-hover:text-white":"text-gray-700 group-hover:text-gray-900"}`,children:L})}),e.jsx("td",{className:"px-4 py-3.5 text-center w-[120px]",children:e.jsx("div",{className:"flex justify-center transform transition-transform group-hover:scale-105",children:e.jsx("span",{className:`text-[11px] px-2.5 py-1 rounded-full text-white font-semibold shadow-sm tracking-wide ${ke[N.priority]||"bg-gray-400"}`,children:N.priority})})}),e.jsx("td",{className:"px-4 py-3.5 w-[140px]",children:e.jsx("span",{className:`text-sm font-mono transition-colors ${N.dueDate?r?"text-gray-400":"text-gray-600":r?"text-gray-600":"text-gray-300"}`,children:N.dueDate||"-"})})]},N.id)})})]})}),e.jsxs("div",{className:`px-6 py-4 border-t backdrop-blur-sm flex justify-end gap-3 ${r?"bg-gray-800/50 border-gray-700":"bg-gray-50/50 border-gray-100"}`,children:[e.jsx("button",{onClick:a,className:`px-5 py-2.5 text-sm font-medium rounded-xl transition-all duration-200 active:scale-95 ${r?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-600 hover:text-gray-900 hover:bg-gray-200/50"}`,children:"Cancel"}),e.jsxs("button",{onClick:p,disabled:o.size===0,className:"px-6 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 active:scale-95 rounded-xl shadow-lg shadow-blue-500/25 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none flex items-center gap-2",children:[e.jsx(Ve,{size:16,strokeWidth:2.5}),e.jsx("span",{children:"Send Tasks"}),o.size>0&&e.jsx("span",{className:"bg-white/20 px-1.5 py-0.5 rounded text-xs font-bold ml-1",children:o.size})]})]})]})}):null},Ct=({status:t,onChange:a,tabIndex:d,darkMode:r})=>{const[o,P]=I.useState({top:0,left:0,width:0}),{ref:$,isActive:j,setIsActive:D,startAction:h}=Se({onCancel:()=>D(!1)}),p=u=>{if(u.stopPropagation(),j){D(!1);return}const _=u.currentTarget.getBoundingClientRect(),N=250,L=window.innerHeight-_.bottom<N;P({top:L?_.top+window.scrollY-N-4:_.bottom+window.scrollY+4,left:_.left+window.scrollX,width:_.width}),h()},O=u=>r?mr[u]||"bg-gray-800 text-gray-400":Qe[u]||"bg-gray-100 text-gray-400";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative w-full h-full",children:e.jsxs("div",{onClick:p,onKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),p(u))},tabIndex:d,className:`w-full h-full flex items-center justify-center cursor-pointer transition-all duration-200 text-xs font-medium relative group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset rounded-sm ${O(t)}`,children:[e.jsx("div",{className:"absolute right-0 bottom-0 w-3 h-3 bg-black/10 opacity-0 group-hover:opacity-100 clip-triangle transition-opacity"}),e.jsx("span",{className:"truncate px-1",children:t||e.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-[10px] uppercase",children:"Set Status"})})]})}),j&&$e.createPortal(e.jsx("div",{ref:$,className:`fixed z-[10000] shadow-2xl rounded-lg border p-1.5 overflow-hidden animate-in fade-in zoom-in-95 duration-100 flex flex-col gap-1 ${r?"bg-[#1a1d24] border-gray-700":"bg-white border-gray-200"}`,style:{top:o.top+4,left:o.left-(160-o.width)/2,width:"160px"},onMouseDown:u=>u.stopPropagation(),children:Object.values(k).map(u=>e.jsx("div",{onClick:_=>{_.stopPropagation(),a(u),D(!1)},className:`px-3 py-2.5 text-xs cursor-pointer hover:brightness-95 rounded-sm text-center font-medium transition-all shadow-sm ${O(u)}`,children:u||"Empty"},u))}),document.body)]})},$t=({priority:t,onChange:a,tabIndex:d,darkMode:r})=>{const[o,P]=I.useState({top:0,left:0,width:0}),{ref:$,isActive:j,setIsActive:D,startAction:h}=Se({onCancel:()=>D(!1)}),p=u=>{if(u.stopPropagation(),j){D(!1);return}const _=u.currentTarget.getBoundingClientRect(),N=200,L=window.innerHeight-_.bottom<N;P({top:L?_.top+window.scrollY-N-4:_.bottom+window.scrollY+4,left:_.left+window.scrollX,width:_.width}),h()},O=u=>r?hr[u]||"bg-gray-800 text-gray-400":ke[u]||"bg-gray-100 text-gray-400";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative w-full h-full",children:e.jsxs("div",{onClick:p,onKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),p(u))},tabIndex:d,className:`w-full h-full flex items-center justify-center cursor-pointer transition-all duration-200 text-xs font-medium relative group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset rounded-sm ${O(t)}`,children:[e.jsx("div",{className:"absolute right-0 bottom-0 w-3 h-3 bg-black/10 opacity-0 group-hover:opacity-100 clip-triangle transition-opacity"}),e.jsx("span",{className:"truncate px-1",children:t||e.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-[10px] uppercase",children:"Set"})})]})}),j&&$e.createPortal(e.jsx("div",{ref:$,className:`fixed z-[10000] shadow-2xl rounded-lg border p-1.5 animate-in fade-in zoom-in-95 duration-100 flex flex-col gap-1 ${r?"bg-[#1a1d24] border-gray-700":"bg-white border-gray-200"}`,style:{top:o.top+4,left:o.left-(140-o.width)/2,width:"140px"},onMouseDown:u=>u.stopPropagation(),children:Object.values(K).map(u=>e.jsx("div",{onClick:_=>{_.stopPropagation(),a(u),D(!1)},className:`px-2 py-2 text-xs cursor-pointer hover:brightness-90 rounded-sm text-center font-medium transition-all shadow-sm ${O(u)}`,children:u||"Empty"},u))}),document.body)]})},St=({personId:t,onChange:a,tabIndex:d,darkMode:r})=>{const[o,P]=I.useState({top:0,left:0}),$=Ue.find(u=>u.id===t),{ref:j,isActive:D,setIsActive:h,startAction:p}=Se({onCancel:()=>h(!1)}),O=u=>{if(u.stopPropagation(),D){h(!1);return}const _=u.currentTarget.getBoundingClientRect(),N=250,L=window.innerHeight-_.bottom<N;P({top:L?_.top+window.scrollY-N-5:_.bottom+window.scrollY+5,left:_.left+window.scrollX-90}),p()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative w-full h-full flex justify-center items-center group",children:e.jsxs("div",{onClick:O,onKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),O(u))},tabIndex:d,className:"cursor-pointer hover:scale-110 transition-transform duration-200 active:scale-95 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full",children:[$?e.jsx("div",{className:"w-6 h-6 rounded-full text-white text-[9px] flex items-center justify-center font-bold ring-2 shadow-md "+$.color+(r?" ring-[#1a1d24]":" ring-white"),title:$.name,children:$.initials}):e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center border border-dashed transition-all shadow-sm ${r?"bg-gray-800 text-gray-500 border-gray-700 hover:border-gray-500 hover:bg-gray-700":"bg-gray-100 text-gray-400 hover:bg-gray-200 border-gray-300 hover:border-gray-400"}`,children:e.jsx(gt,{size:12,strokeWidth:2.5})}),!$&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 pointer-events-none",children:e.jsx("div",{className:"w-6 h-6 rounded-full bg-black/5 flex items-center justify-center backdrop-blur-[1px]",children:e.jsx(He,{size:12,className:"text-black/60",strokeWidth:3})})})]})}),D&&$e.createPortal(e.jsxs("div",{ref:j,className:`fixed z-[10000] shadow-2xl rounded-xl border p-2 animate-in fade-in zoom-in-95 duration-100 flex flex-col gap-1 min-w-[180px] ${r?"bg-[#1a1d24] border-gray-700":"bg-white border-gray-200"}`,style:{top:o.top,left:o.left},onMouseDown:u=>u.stopPropagation(),children:[e.jsx("div",{className:`text-xs font-semibold mb-1 px-2 uppercase tracking-wider py-1 ${r?"text-gray-500":"text-gray-400"}`,children:"Select Person"}),Ue.map(u=>e.jsxs("div",{onClick:_=>{_.stopPropagation(),a(u.id),h(!1)},className:`flex items-center gap-3 px-3 py-2 rounded-lg cursor-pointer transition-colors ${r?t===u.id?"bg-blue-500/20":"hover:bg-white/5":t===u.id?"bg-blue-50":"hover:bg-blue-50"}`,children:[e.jsx("div",{className:"w-6 h-6 rounded-full text-white text-[10px] flex items-center justify-center font-bold "+u.color,children:u.initials}),e.jsx("span",{className:`text-sm font-medium ${r?"text-gray-200":"text-gray-700"}`,children:u.name}),t===u.id&&e.jsx("span",{className:"ml-auto text-blue-500",children:"✓"})]},u.id)),e.jsx("div",{className:`border-t my-1 ${r?"border-gray-700":"border-gray-100"}`}),e.jsxs("div",{onClick:u=>{u.stopPropagation(),a(null),h(!1)},className:`px-3 py-2 text-sm rounded-lg cursor-pointer flex items-center gap-2 transition-colors ${r?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-500"}`,children:[e.jsx("span",{className:"w-4 h-4 flex items-center justify-center text-xs",children:"✕"}),"Clear Selection"]})]}),document.body)]})},Nr=[{id:"text",label:"Normal text",icon:e.jsx(ys,{size:18,className:"text-gray-500"})},{id:"h1",label:"Heading 1",icon:e.jsx(Ms,{size:18,className:"text-gray-500"})},{id:"h2",label:"Heading 2",icon:e.jsx(tr,{size:18,className:"text-gray-500"})},{id:"h3",label:"Heading 3",icon:e.jsx(rr,{size:18,className:"text-gray-500"})},{id:"h4",label:"Heading 4",icon:e.jsx(ar,{size:18,className:"text-gray-500"})},{id:"checklist",label:"Checklist",icon:e.jsx(ns,{size:18,className:"text-gray-500"})},{id:"bulletList",label:"Bulleted list",icon:e.jsx(Vs,{size:18,className:"text-gray-500"})},{id:"orderedList",label:"Numbered list",icon:e.jsx(Os,{size:18,className:"text-gray-500"})},{id:"toggle",label:"Toggle list",icon:e.jsx(gr,{size:18,className:"text-gray-500"})},{id:"banner",label:"Banners",icon:e.jsx(vt,{size:18,className:"text-gray-500"})},{id:"code",label:"Code block",icon:e.jsx(as,{size:18,className:"text-gray-500"})},{id:"quote",label:"Block quote",icon:e.jsx(xr,{size:18,className:"text-gray-500"})},{id:"pullQuote",label:"Pull quote",icon:e.jsx(lr,{size:18,className:"text-gray-500"})}],Cr=({search:t,onSelect:a,onClose:d,position:r,darkMode:o})=>{const[P,$]=I.useState(0),{ref:j}=Se({onCancel:d,initialActive:!0}),D=Nr.filter(h=>h.label.toLowerCase().includes(t.toLowerCase()));return I.useEffect(()=>{$(0)},[t]),I.useEffect(()=>{const h=p=>{p.defaultPrevented||(p.key==="ArrowDown"?(p.preventDefault(),$(O=>(O+1)%D.length)):p.key==="ArrowUp"?(p.preventDefault(),$(O=>(O-1+D.length)%D.length)):p.key==="Enter"&&(p.preventDefault(),D[P]&&a(D[P])))};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[D,P,a]),D.length===0?null:e.jsxs("div",{ref:j,className:`fixed z-[9999] rounded-lg shadow-xl border w-72 max-h-80 overflow-y-auto flex flex-col p-1 animate-in fade-in zoom-in-95 duration-100 ${o?"bg-[#1a1d24] border-gray-700":"bg-white border-gray-200"}`,style:{top:r.top,left:r.left},children:[e.jsx("div",{className:`px-2 py-1.5 text-xs font-semibold uppercase tracking-wider ${o?"text-gray-500":"text-gray-400"}`,children:"Basic blocks"}),D.map((h,p)=>e.jsxs("div",{className:`flex items-center gap-3 px-2 py-1.5 rounded-md cursor-pointer transition-colors ${p===P?o?"bg-white/10":"bg-gray-100":o?"hover:bg-white/5":"hover:bg-gray-50"}`,onClick:()=>a(h),onMouseEnter:()=>$(p),children:[e.jsx("div",{className:`w-10 h-10 rounded border flex items-center justify-center shadow-sm ${o?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:h.icon}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm font-medium ${o?"text-gray-200":"text-gray-700"}`,children:h.label}),h.description&&e.jsx("span",{className:"text-xs text-gray-400",children:h.description})]})]},h.id))]})},$r=({value:t,onChange:a,onClose:d,title:r="Edit Text",darkMode:o})=>{const[P,$]=I.useState(t),[j,D]=I.useState(!1),[h,p]=I.useState({top:0,left:0}),[O,u]=I.useState(""),_=I.useRef(null),{ref:N,setIsActive:m}=Se({onCancel:d,initialActive:!0});I.useEffect(()=>{m(!j)},[j,m]),I.useEffect(()=>{_.current&&(_.current.focus(),_.current.setSelectionRange(_.current.value.length,_.current.value.length))},[]);const L=U=>{var R;if(j){if(U.key==="ArrowUp"||U.key==="ArrowDown"||U.key==="Enter"){U.key==="Enter"&&U.preventDefault();return}if(U.key==="Escape"){D(!1);return}}if(U.key==="/"&&!j){const Y=(R=_.current)==null?void 0:R.getBoundingClientRect();Y&&(p({top:Y.top+40,left:Y.left+20}),D(!0),u(""))}},Q=U=>{const R=U.target.value;if($(R),a(R),j){const Y=R.lastIndexOf("/");Y===-1?D(!1):u(R.slice(Y+1))}},ie=U=>{var Y;let R="";switch(U.id){case"h1":R="# ";break;case"h2":R="## ";break;case"h3":R="### ";break;case"checklist":R="- [ ] ";break;case"bulletList":R="- ";break;case"orderedList":R="1. ";break;case"quote":R="> ";break;case"code":R="```\n\n```";break;default:R=""}if(R){const W=P.lastIndexOf("/"),oe=P.substring(0,W)+R+P.substring(W+1+O.length);$(oe),a(oe)}D(!1),(Y=_.current)==null||Y.focus()};return $e.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:[e.jsxs("div",{ref:N,className:`rounded-xl shadow-2xl w-[800px] h-[600px] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200 border ${o?"bg-[#1a1d24] border-gray-700":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:`flex items-center justify-between px-4 py-3 border-b ${o?"border-gray-700 bg-[#1a1d24]":"border-gray-100 bg-gray-50/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{size:16,className:`${o?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`text-sm font-semibold ${o?"text-gray-200":"text-gray-700"}`,children:r})]}),e.jsx("button",{onClick:d,className:`p-1.5 rounded-md transition-colors ${o?"hover:bg-white/5 text-gray-400 hover:text-gray-200":"hover:bg-gray-200 text-gray-400 hover:text-gray-600"}`,children:e.jsx(Oe,{size:18})})]}),e.jsxs("div",{className:`flex-1 relative ${o?"bg-[#1a1d24]":"bg-white"}`,children:[e.jsx("textarea",{ref:_,value:P,onChange:Q,onKeyDown:L,className:`w-full h-full p-6 resize-none focus:outline-none text-base leading-relaxed font-mono ${o?"bg-[#1a1d24] text-gray-200 placeholder-gray-600":"text-gray-800 placeholder-gray-300"}`,placeholder:"Write something... Type '/' for commands"}),e.jsx("div",{className:`absolute bottom-4 right-4 text-xs pointer-events-none ${o?"text-gray-600":"text-gray-400"}`,children:"Markdown supported • Type '/' for commands"})]})]}),j&&e.jsx("div",{className:"fixed inset-0 z-[10000] pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:e.jsx(Cr,{search:O,onSelect:ie,onClose:()=>D(!1),position:h,darkMode:o})})})]}),document.body)},Sr=({value:t,onChange:a,tabIndex:d,darkMode:r})=>{const[o,P]=I.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`w-full h-full relative group cursor-pointer transition-colors ${r?"hover:bg-white/5":"hover:bg-gray-50"}`,onClick:()=>P(!0),children:[e.jsx("div",{className:`w-full h-full px-2 py-1.5 text-sm whitespace-nowrap overflow-hidden text-ellipsis focus:outline-none focus:ring-2 focus:ring-blue-500 rounded ${r?"text-gray-300":"text-gray-700"}`,tabIndex:d,children:t||e.jsx("span",{className:`${r?"text-gray-600":"text-gray-400"} italic`,children:"Empty"})}),e.jsx("div",{className:`absolute right-2 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity ${r?"text-gray-500":"text-gray-400"}`,children:e.jsx(Nt,{size:12})})]}),o&&e.jsx($r,{value:t,onChange:a,onClose:()=>P(!1),darkMode:r})]})},Dr=({task:t,group:a,selectionColumnWidth:d,actionColumnWidth:r,expandedTaskIds:o,toggleTaskSelection:P,updateTask:$,updateTaskTextValue:j,toggleSubtask:D,setActiveDatePicker:h,handleContextMenu:p,deleteTask:O,handleAddSubtask:u,subtaskInput:_,setSubtaskInput:N,darkMode:m=!1,setActiveConnectionMenu:L})=>{var he;const{attributes:Q,listeners:ie,setNodeRef:U,transform:R,transition:Y,isDragging:W}=$s({id:t.id,data:{type:"TASK",task:t,group:a}}),oe={transform:Is.Translate.toString(R),transition:Y,opacity:W?0:1,zIndex:W?999:"auto",position:"relative",gridTemplateColumns:d+" "+a.columns.map(i=>i.width).join(" ")+" "+r};return e.jsxs(mt.Fragment,{children:[e.jsxs("div",{ref:U,style:oe,className:`grid gap-px group/row text-sm transition-colors relative ${W?"z-50 shadow-xl ring-2 ring-blue-500/20":""} ${m?"bg-[#1a1d24] hover:bg-white/5":"bg-white hover:bg-gray-50/50"}`,children:[e.jsxs("div",{className:`flex items-center justify-center py-1.5 border-r relative transition-colors sticky left-0 z-10 border-r-2 ${m?"bg-[#1a1d24] border-gray-800 border-r-gray-800 group-hover/row:bg-white/5":"bg-white border-gray-100 border-r-gray-200/50 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5",style:{backgroundColor:a.color}}),e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300",checked:!!t.selected,onChange:i=>P(a.id,t.id,i.target.checked),onClick:i=>i.stopPropagation(),onMouseDown:i=>i.stopPropagation()})]}),a.columns.map(i=>{var le;const re=i.type==="name";return e.jsxs("div",{className:`relative border-r flex items-center ${re?"justify-start pl-2 sticky left-[50px] z-10 border-r-2":"justify-center"} min-h-[32px] transition-colors ${m?"bg-[#1a1d24] border-gray-800 border-r-gray-800 group-hover/row:bg-white/5 text-gray-300":"bg-white border-gray-100 border-r-gray-200/50 group-hover/row:bg-[#f8f9fa]"}`,children:[re&&e.jsx("div",{className:"cursor-grab active:cursor-grabbing text-gray-300 mr-2 opacity-0 group-hover/row:opacity-100 hover:text-gray-500 p-1",...ie,...Q,style:{touchAction:"none"},children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"9",cy:"12",r:"1"}),e.jsx("circle",{cx:"9",cy:"5",r:"1"}),e.jsx("circle",{cx:"9",cy:"19",r:"1"}),e.jsx("circle",{cx:"15",cy:"12",r:"1"}),e.jsx("circle",{cx:"15",cy:"5",r:"1"}),e.jsx("circle",{cx:"15",cy:"19",r:"1"})]})}),i.type==="name"&&e.jsxs("div",{className:"flex items-center w-full gap-2",children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),D(t.id)},className:"p-0.5 hover:bg-gray-200 rounded text-gray-400 transition-colors",children:o.has(t.id)?e.jsx(is,{size:14}):e.jsx(ht,{size:14})}),e.jsx("input",{value:t.name,onChange:w=>$(a.id,t.id,{name:w.target.value}),className:`w-full px-2 py-1.5 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded font-medium truncate ${m?"text-gray-200":"text-gray-700"}`}),e.jsx("div",{className:"text-xs text-gray-400 mr-2",children:(le=t.subtasks)!=null&&le.length?`${t.subtasks.length} subtasks`:""})]}),i.type==="status"?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Ct,{status:i.id==="col_status"?t.status:t.textValues[i.id]||k.New,onChange:w=>{i.id==="col_status"?$(a.id,t.id,{status:w}):j(a.id,t.id,i.id,w)},tabIndex:0,darkMode:m})}):i.type==="priority"?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx($t,{priority:i.id==="col_priority"?t.priority:t.textValues[i.id]||K.Normal,onChange:w=>{i.id==="col_priority"?$(a.id,t.id,{priority:w}):j(a.id,t.id,i.id,w)},tabIndex:0,darkMode:m})}):i.type==="person"?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(St,{personId:i.id==="col_person"?t.personId:t.textValues[i.id]||null,onChange:w=>{i.id==="col_person"?$(a.id,t.id,{personId:w}):j(a.id,t.id,i.id,w||"")},tabIndex:0,darkMode:m})}):i.type==="date"?e.jsx("div",{className:"w-full h-full relative flex items-center justify-center",children:e.jsx("div",{className:`text-xs font-medium px-2 py-1 rounded transition-colors focus:ring-2 focus:ring-blue-500 focus:outline-none cursor-pointer ${m?"text-gray-300 hover:text-white hover:bg-white/10":"text-gray-500 hover:text-gray-800 hover:bg-gray-100"}`,onClick:w=>{w.stopPropagation();const V=w.currentTarget.getBoundingClientRect(),y=i.id==="col_date",g=y?t.dueDate||"":t.textValues[i.id]||"";h({taskId:t.id,colId:i.id,date:g,rect:V,onSelect:b=>{y?$(a.id,t.id,{dueDate:b}):j(a.id,t.id,i.id,b)}})},tabIndex:0,onKeyDown:w=>{if(w.key==="Enter"||w.key===" "){w.preventDefault();const V=w.currentTarget.getBoundingClientRect(),y=i.id==="col_date",g=y?t.dueDate||"":t.textValues[i.id]||"";h({taskId:t.id,colId:i.id,date:g,rect:V,onSelect:b=>{y?$(a.id,t.id,{dueDate:b}):j(a.id,t.id,i.id,b)}})}},children:(()=>{const V=i.id==="col_date"?t.dueDate:t.textValues[i.id];return V?new Date(V).toLocaleDateString(void 0,{month:"short",day:"numeric"}):e.jsx("span",{className:"text-gray-300",children:"Set Date"})})()})}):null,i.type==="checkbox"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:t.textValues[i.id]==="true",onChange:w=>{j(a.id,t.id,i.id,w.target.checked?"true":"false")},className:`w-4 h-4 rounded text-blue-600 focus:ring-blue-500 cursor-pointer ${m?"border-gray-600 bg-transparent":"border-gray-300"}`})}),i.type==="money"&&e.jsx("div",{className:"w-full h-full px-2 py-1.5 text-sm text-gray-700 flex items-center justify-end font-mono",children:t.textValues[i.id]?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`mr-1 ${m?"text-gray-500":"text-gray-400"}`,children:i.currency||"$"}),e.jsx("input",{type:"text",value:t.textValues[i.id],onChange:w=>{const V=w.target.value.replace(/[^0-9.]/g,"");j(a.id,t.id,i.id,V)},className:"bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-1 w-full text-right",placeholder:"0.00"})]}):e.jsx("input",{type:"text",onChange:w=>{const V=w.target.value.replace(/[^0-9.]/g,"");j(a.id,t.id,i.id,V)},className:`bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-1 w-full text-right ${m?"placeholder-gray-600 text-gray-300":"placeholder-gray-300 text-gray-700"}`,placeholder:i.currency||"$"})}),i.type==="website"&&e.jsxs("div",{className:"w-full h-full px-2 py-1.5 flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded ${m?"bg-indigo-500/20 text-indigo-400":"bg-indigo-50 text-indigo-500"}`,children:e.jsx(pt,{size:12})}),e.jsx("input",{type:"text",value:t.textValues[i.id]||"",onChange:w=>j(a.id,t.id,i.id,w.target.value),className:`w-full bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-1 text-sm hover:underline cursor-text truncate ${m?"text-blue-400":"text-blue-600"}`,placeholder:"www.example.com"})]}),i.type==="email"&&e.jsxs("div",{className:"w-full h-full px-2 py-1.5 flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded ${m?"bg-red-500/20 text-red-400":"bg-red-50 text-red-500"}`,children:e.jsx(os,{size:12})}),e.jsx("input",{type:"text",value:t.textValues[i.id]||"",onChange:w=>j(a.id,t.id,i.id,w.target.value),className:`w-full bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-1 text-sm truncate ${m?"text-gray-300":"text-gray-700"}`,placeholder:"email@example.com"})]}),i.type==="phone"&&e.jsxs("div",{className:"w-full h-full px-2 py-1.5 flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded ${m?"bg-orange-500/20 text-orange-400":"bg-orange-50 text-orange-500"}`,children:e.jsx(Gs,{size:12})}),e.jsx("input",{type:"text",value:t.textValues[i.id]||"",onChange:w=>j(a.id,t.id,i.id,w.target.value),className:`w-full bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-1 text-sm truncate ${m?"text-gray-300":"text-gray-700"}`,placeholder:"+1 234 567 890"})]}),i.type==="location"&&e.jsxs("div",{className:"w-full h-full px-2 py-1.5 flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded ${m?"bg-red-500/20 text-red-400":"bg-red-50 text-red-600"}`,children:e.jsx(ls,{size:12})}),e.jsx("input",{type:"text",value:t.textValues[i.id]||"",onChange:w=>j(a.id,t.id,i.id,w.target.value),className:`w-full bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-1 text-sm truncate ${m?"text-gray-300":"text-gray-700"}`,placeholder:"Add location"})]}),i.type==="rating"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center gap-0.5",children:[1,2,3,4,5].map(w=>e.jsx(jt,{size:14,className:`cursor-pointer transition-colors ${w<=(Number(t.textValues[i.id])||0)?"text-amber-400 fill-amber-400":m?"text-gray-600":"text-gray-300"}`,onClick:()=>j(a.id,t.id,i.id,w.toString())},w))}),i.type==="progress_manual"&&e.jsxs("div",{className:"w-full h-full px-2 py-1.5 flex items-center gap-2",children:[e.jsxs("div",{className:`flex-1 h-2 rounded-full overflow-hidden relative group/progress cursor-pointer ${m?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${Number(t.textValues[i.id])||0}%`}}),e.jsx("input",{type:"range",min:"0",max:"100",value:Number(t.textValues[i.id])||0,onChange:w=>j(a.id,t.id,i.id,w.target.value),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]}),e.jsxs("span",{className:`text-xs w-8 text-right ${m?"text-gray-400":"text-gray-500"}`,children:[Number(t.textValues[i.id])||0,"%"]})]}),i.type==="button"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("button",{className:"px-3 py-1 bg-blue-500 text-white text-xs font-medium rounded hover:bg-blue-600 transition-colors active:scale-95",onClick:()=>alert(`Action triggered for ${t.name}`),children:"Click Me"})}),i.type==="connection"&&e.jsx("div",{className:"w-full h-full p-1 flex items-center justify-center",children:e.jsxs("button",{onClick:w=>{w.stopPropagation();const V=w.currentTarget.getBoundingClientRect();let y;try{const g=t.textValues[i.id];g&&(y=JSON.parse(g))}catch{}L({groupId:a.id,taskId:t.id,colId:i.id,rect:V,config:y})},className:`w-full h-full text-xs font-semibold rounded transition-all flex items-center justify-center gap-1.5 px-2 group/btn ${(()=>{let w=!1;try{const V=t.textValues[i.id];V&&JSON.parse(V).targetPath&&(w=!0)}catch{}return w})()?"bg-blue-50 hover:bg-blue-100 text-blue-600 border border-blue-200":"bg-gray-50 hover:bg-gray-100 text-gray-500 border border-gray-200"}`,children:[e.jsx(bt,{size:12,className:"group-hover/btn:scale-110 transition-transform"}),e.jsx("span",{className:"truncate",children:(()=>{try{const w=t.textValues[i.id];if(w){const V=JSON.parse(w);if(V.targetName)return`Go to ${V.targetName}`}}catch{}return"Connect"})()})]})}),i.type==="text"&&e.jsx("input",{type:"text",value:t.textValues[i.id]||"",onChange:w=>j(a.id,t.id,i.id,w.target.value),className:`w-full h-full text-center px-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded ${m?"text-gray-300":"text-gray-600"}`,placeholder:"-",tabIndex:0}),i.type==="long_text"&&e.jsx("div",{className:"w-full h-full p-1",children:e.jsx(Sr,{value:t.textValues[i.id]||"",onChange:w=>j(a.id,t.id,i.id,w),tabIndex:0,darkMode:m})}),i.type==="dropdown"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(fs,{options:i.options,value:t.textValues[i.id],onChange:w=>j(a.id,t.id,i.id,w),tabIndex:0,darkMode:m})}),i.type==="number"&&e.jsx("input",{type:"text",value:t.textValues[i.id]||"",onChange:w=>{const V=w.target.value;/^[0-9.,]*$/.test(V)&&j(a.id,t.id,i.id,V)},onBlur:w=>{const V=w.target.value.replace(/,/g,"");if(V&&!isNaN(Number(V))){const y=Number(V).toLocaleString();j(a.id,t.id,i.id,y)}},className:"w-full h-full text-center px-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded text-gray-600 font-mono text-xs",placeholder:"0",tabIndex:0})]},i.id)}),e.jsx("div",{className:`flex items-center justify-center border-l opacity-0 group-hover/row:opacity-100 transition-opacity ${m?"border-gray-800 bg-[#0f1115]":"border-gray-100 bg-white"}`,children:e.jsx("button",{onClick:()=>O(a.id,t.id),className:"text-gray-300 hover:text-red-500 hover:bg-red-50 p-1.5 rounded transition-all",children:e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})})]}),o.has(t.id)&&e.jsxs("div",{className:"contents",children:[(he=t.subtasks)==null?void 0:he.map(i=>e.jsxs("div",{className:`grid gap-px group/subrow text-sm transition-colors relative ${m?"bg-[#1a1d24]/50 hover:bg-white/5":"bg-gray-50/30 hover:bg-gray-50"}`,style:{gridTemplateColumns:d+" "+a.columns.map(re=>re.width).join(" ")+" "+r},children:[e.jsxs("div",{className:`flex items-center justify-center py-1.5 border-r relative sticky left-0 z-10 border-r-2 ${m?"bg-[#1a1d24]/50 border-gray-800 border-r-gray-800":"bg-gray-50/30 border-gray-100 border-r-gray-200/50"}`,children:[e.jsx("div",{className:"w-4 h-4"})," "]}),a.columns.map(re=>{const le=re.type==="name";return e.jsxs("div",{className:`relative border-r flex items-center ${le?"justify-start pl-8 sticky left-[50px] z-10 border-r-2":"justify-center"} min-h-[32px] transition-colors ${m?"bg-[#1a1d24]/50 border-gray-800 border-r-gray-800 group-hover/subrow:bg-white/5 text-gray-400":"bg-gray-50/30 border-gray-100 border-r-gray-200/50 group-hover/subrow:bg-gray-100"}`,children:[le&&e.jsx(lt,{size:14,className:"text-gray-400 mr-2"}),le?e.jsx("input",{value:i.name,onChange:w=>{var y;const V=(y=t.subtasks)==null?void 0:y.map(g=>g.id===i.id?{...g,name:w.target.value}:g);$(a.id,t.id,{subtasks:V})},className:`w-full px-2 py-1.5 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded text-sm truncate ${m?"text-gray-300":"text-gray-600"}`}):e.jsx("div",{className:"text-xs text-gray-400 italic",children:"-"})]},`${i.id}-${re.id}`)}),e.jsx("div",{className:`border-l ${m?"bg-[#1a1d24]/50 border-gray-800":"bg-white border-gray-100"}`})]},i.id)),e.jsx("div",{className:`grid gap-px relative z-20 shadow-lg my-2 mx-4 rounded-lg border overflow-hidden animate-in slide-in-from-top-2 duration-200 ${m?"bg-[#1a1d24] border-gray-700":"bg-white border-gray-200"}`,style:{gridColumn:"1 / -1"},children:e.jsxs("div",{className:`flex items-center p-2 gap-3 ${m?"bg-[#1a1d24]":"bg-white"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 border-dashed animate-spin-slow ${m?"border-gray-600":"border-gray-300"}`}),e.jsx("input",{autoFocus:!0,value:_[t.id]||"",onChange:i=>N({..._,[t.id]:i.target.value}),onKeyDown:i=>{i.key==="Enter"&&u(a.id,t.id)},placeholder:"Task Name or type '/' for commands",className:`flex-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-2 bg-transparent ${m?"text-gray-200 placeholder-gray-500":"text-gray-700 placeholder-gray-400"}`}),e.jsxs("div",{className:`flex items-center gap-1 border-l pl-3 ${m?"border-gray-700":"border-gray-200"}`,children:[e.jsx("button",{className:`p-1.5 rounded transition-colors ${m?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,children:e.jsx(yt,{size:16})}),e.jsx("button",{className:`p-1.5 rounded transition-colors ${m?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,children:e.jsx(cs,{size:16})}),e.jsx("div",{className:`w-px h-4 mx-1 ${m?"bg-gray-700":"bg-gray-200"}`}),e.jsx("button",{className:`p-1.5 rounded transition-colors ${m?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,children:e.jsx(gt,{size:16})}),e.jsx("button",{className:`p-1.5 rounded transition-colors ${m?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,children:e.jsx(ft,{size:16})}),e.jsx("button",{className:`p-1.5 rounded transition-colors ${m?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,children:e.jsx(vt,{size:16})}),e.jsx("button",{className:`p-1.5 rounded transition-colors ${m?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,children:e.jsx(Rs,{size:16})}),e.jsx("button",{className:`p-1.5 rounded transition-colors ${m?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,children:e.jsx(ds,{size:16})}),e.jsx("div",{className:`w-px h-4 mx-1 ${m?"bg-gray-700":"bg-gray-200"}`}),e.jsx("button",{onClick:()=>D(t.id),className:`px-3 py-1.5 text-sm font-medium rounded border transition-colors ${m?"text-gray-400 hover:bg-white/5 border-gray-700":"text-gray-600 hover:bg-gray-100 border-gray-200"}`,children:"Cancel"}),e.jsxs("button",{onClick:()=>u(a.id,t.id),className:"px-3 py-1.5 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded shadow-sm transition-colors flex items-center gap-1",children:["Save ",e.jsx(lt,{size:12})]})]})]})})]})]})},Ie={[k.Done]:"#33D995",[k.Working]:"#FFBE66",[k.Stuck]:"#FF7085",[k.Pending]:"#FFD940",[k.AlmostFinish]:"#C48AF0",[k.New]:"#A0A5B9"},zr=t=>{if(!t)return k.New;const a=t.toLowerCase();return a.includes("done")||a.includes("complete")?k.Done:a.includes("work")||a.includes("progress")||a.includes("doing")?k.Working:a.includes("stuck")||a.includes("block")?k.Stuck:a.includes("pending")||a.includes("todo")||a.includes("to do")||a.includes("backlog")?k.Pending:a.includes("almost")||a.includes("review")?k.AlmostFinish:k.New},Ze=(t,a)=>{var o,P;const d=(o=t.columns.find($=>$.type==="status"))==null?void 0:o.id,r=a.status||(d?(P=a.textValues)==null?void 0:P[d]:void 0);return zr(r)},Ir=(t,a)=>{const d=(a??t.tasks).flatMap($=>[$,...$.subtasks||[]]);if(d.length===0)return{counts:{done:0,working:0,stuck:0,pending:0,almostFinish:0,new:0},weighted:0,total:0};const r=d.reduce(($,j)=>{const D=Ze(t,j);return $[D===k.Done?"done":D===k.Working?"working":D===k.Stuck?"stuck":D===k.Pending?"pending":D===k.AlmostFinish?"almostFinish":"new"]+=1,$},{done:0,working:0,stuck:0,pending:0,almostFinish:0,new:0}),o=d.length,P=(r.done*1+r.almostFinish*.75+r.working*.5+r.pending*.25+r.new*.1+r.stuck*0)/o*100;return{counts:r,weighted:P,total:o}},kr=mt.memo(({group:t,filteredTasks:a,progress:d,collapsedGroups:r,toggleGroupCollapse:o,updateGroupTitle:P,toggleGroupPin:$,setShowReminderModalGroupId:j,setShowGoalsModalGroupId:D,setShowTaskBoardModalGroupId:h,isMainBoard:p,handleDeleteGroupClick:O,allSelected:u,someSelected:_,toggleGroupSelection:N,selectionColumnWidth:m,actionColumnWidth:L,handleContextMenu:Q,handleColumnDragStart:ie,handleColumnDragOver:U,handleColumnDrop:R,updateColumnTitle:Y,activeColumnMenu:W,setActiveColumnMenu:oe,setResizingCol:he,expandedTaskIds:i,toggleTaskSelection:re,updateTask:le,handleDeleteTaskClick:w,updateTaskTextValue:V,toggleSubtask:y,setActiveDatePicker:g,setActiveConnectionMenu:b,handleAddSubtask:f,subtaskInput:c,setSubtaskInput:z,draftTasks:E,updateDraftTask:B,handleAddTask:Z,darkMode:S})=>{var ue;return e.jsxs("div",{id:`group-${t.id}`,className:`relative flex flex-col w-full mb-10 shadow-sm border rounded-xl overflow-hidden transition-colors ${S?"border-gray-800 bg-[#1a1d24]":"border-gray-200/60"}`,children:[e.jsxs("div",{className:`flex items-center px-4 py-3 relative w-full border-b transition-colors ${S?"bg-[#1a1d24] border-gray-800":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 pr-4",children:[e.jsx("div",{className:"cursor-pointer hover:bg-gray-100 p-1.5 rounded transition-colors group/menu relative",onClick:()=>o(t.id),children:e.jsx("svg",{className:`w-4 h-4 text-gray-400 group-hover/menu:text-blue-500 transition-transform ${r.has(t.id)?"-rotate-90":"rotate-0"}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})}),e.jsx("input",{value:t.title,onChange:n=>P(t.id,n.target.value),className:`text-xl font-bold bg-transparent border border-transparent rounded px-2 py-0.5 focus:outline-none focus:border-blue-500 w-full max-w-md transition-all ${S?"hover:border-gray-700 focus:bg-[#0f1115]":"hover:border-gray-300 focus:bg-white"}`,style:{color:t.color}}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsx("div",{className:"flex h-1.5 w-28 overflow-hidden rounded-full bg-gray-100",children:["new","pending","working","almostFinish","done","stuck"].map(n=>{const T=d.total===0?0:d.counts[n]/d.total*100;if(T<=0)return null;const A=n==="new"?Ie[k.New]:n==="pending"?Ie[k.Pending]:n==="working"?Ie[k.Working]:n==="almostFinish"?Ie[k.AlmostFinish]:n==="done"?Ie[k.Done]:Ie[k.Stuck];return e.jsx("div",{className:"h-full",style:{width:`${T}%`,backgroundColor:A}},n)})}),e.jsxs("span",{className:"text-xs text-gray-400 font-medium",children:[Math.round(d.weighted),"%"]})]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-1 px-2",children:[e.jsx("button",{onClick:()=>$(t.id),className:"p-2 transition-colors rounded-md "+(t.isPinned?"text-blue-500 bg-blue-50":"text-gray-300 hover:text-gray-500 hover:bg-gray-100"),title:t.isPinned?"Unpin Group":"Pin Group",children:e.jsx(Bs,{className:"w-4 h-4 "+(t.isPinned?"fill-current":"")})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),j(t.id)},className:"p-2 transition-colors rounded-md text-gray-300 hover:text-gray-500 hover:bg-gray-100",title:"Send to Reminders",children:e.jsx(ft,{className:"w-4 h-4"})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),D(t.id)},className:"p-2 transition-colors rounded-md text-gray-300 hover:text-gray-500 hover:bg-gray-100",title:"Send to Goals",children:e.jsx(dt,{className:"w-4 h-4"})}),!p&&e.jsx("button",{onClick:n=>{n.stopPropagation(),h(t.id)},className:"p-2 transition-colors rounded-md text-gray-300 hover:text-gray-500 hover:bg-gray-100",title:"Send to Tasks Board",children:e.jsx(ut,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>O(t.id),className:"text-gray-400 hover:text-red-500 p-2 transition-colors hover:bg-red-50 rounded-md",title:"Delete Group",children:e.jsx(Ke,{size:14})})]})]}),!r.has(t.id)&&e.jsxs("div",{className:"overflow-x-auto w-full [&::-webkit-scrollbar]:hidden",children:[e.jsx("div",{className:`sticky top-0 z-[1] min-w-full w-fit transition-colors ${S?"bg-[#1a1d24]":"bg-white"}`,style:{boxShadow:"0 2px 5px -2px rgba(0,0,0,0.05)"},children:e.jsxs("div",{className:`grid gap-px border-y text-xs font-semibold uppercase tracking-wide transition-colors ${S?"bg-gray-800 border-gray-800 text-gray-400":"bg-gray-200 border-gray-200 text-gray-500"}`,style:{gridTemplateColumns:m+" "+t.columns.map(n=>n.width).join(" ")+" "+L},children:[e.jsx("div",{className:`flex items-center justify-center sticky left-0 z-20 border-r-2 transition-colors ${S?"bg-[#1a1d24]/95 border-r-gray-800":"bg-gray-50/80 border-r-gray-200/50"}`,children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300",checked:u,ref:n=>{n&&(n.indeterminate=_&&!u)},onChange:n=>N(t.id,n.target.checked)})}),t.columns.map((n,T)=>e.jsx("div",{className:`relative group backdrop-blur-sm transition-colors ${n.type==="name"?`sticky left-[50px] z-20 border-r-2 ${S?"border-r-gray-800":"border-r-gray-200/50"}`:"cursor-grab active:cursor-grabbing"} ${S?"bg-[#1a1d24]/95 hover:bg-white/5":"bg-gray-50/80 hover:bg-gray-100"}`,onContextMenu:A=>Q(A,t.id,n.id),draggable:n.type!=="name",onDragStart:A=>ie(A,t.id,n.id,T),onDragOver:A=>U(A,T),onDrop:A=>R(A,t.id,T),children:e.jsxs("div",{className:"flex items-center justify-between h-full",children:[e.jsx("input",{value:n.title,onChange:A=>Y(t.id,n.id,A.target.value),className:`w-full h-full bg-transparent px-3 py-2 text-center text-[11px] focus:outline-none border-b-2 border-transparent focus:border-blue-500 ${S?"focus:bg-[#0f1115] focus:text-white text-gray-300":"focus:bg-white focus:text-gray-800"}`,style:{textAlign:n.type==="name"||n.type==="long_text"?"left":"center"}}),e.jsx("div",{className:"absolute right-1 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer p-1 hover:bg-gray-200 rounded",onClick:A=>{A.stopPropagation();const J=A.currentTarget.getBoundingClientRect();oe((W==null?void 0:W.groupId)===t.id?null:{groupId:t.id,rect:J})},children:e.jsx(xs,{size:14,className:"text-gray-400"})}),e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-400/50 z-30",onMouseDown:A=>{A.stopPropagation(),A.preventDefault();const J=parseInt(n.width.replace("px",""))||140;he({groupId:t.id,colId:n.id,startX:A.clientX,startWidth:J})},onClick:A=>A.stopPropagation()})]})},n.id)),e.jsx("div",{className:`flex items-center justify-center relative group ${S?"bg-[#1a1d24]/95":"bg-gray-50/80"}`,children:e.jsx("div",{className:"cursor-pointer w-6 h-6 rounded flex items-center justify-center transition-all duration-200 "+((W==null?void 0:W.groupId)===t.id?"bg-gray-200 text-gray-900":"text-gray-400 hover:text-gray-700 hover:bg-gray-200/50"),onClick:n=>{n.stopPropagation();const T=n.currentTarget.getBoundingClientRect();oe((W==null?void 0:W.groupId)===t.id?null:{groupId:t.id,rect:T})},title:"Add Column",children:e.jsx(He,{className:"w-4 h-4"})})})]})}),e.jsx("div",{className:`divide-y relative z-0 min-w-full w-fit ${S?"divide-gray-800":"divide-gray-100"}`,children:e.jsx(Ss,{items:a.map(n=>n.id),strategy:Ds,children:a.map(n=>e.jsx(Dr,{task:n,group:t,selectionColumnWidth:m,actionColumnWidth:L,expandedTaskIds:i,toggleTaskSelection:re,updateTask:le,deleteTask:()=>w(t.id,n.id),updateTaskTextValue:V,toggleSubtask:y,setActiveDatePicker:g,handleContextMenu:Q,handleAddSubtask:f,subtaskInput:c,setSubtaskInput:z,darkMode:S,setActiveConnectionMenu:b},n.id))})}),e.jsxs("div",{className:`grid gap-px border-t group/add-row transition-colors min-w-full w-fit ${S?"bg-[#1a1d24] border-gray-800 hover:bg-white/5":"bg-white border-gray-200 hover:bg-gray-50"}`,style:{gridTemplateColumns:m+" "+t.columns.map(n=>n.width).join(" ")+" "+L},children:[e.jsxs("div",{className:`flex items-center justify-center border-r sticky left-0 z-10 border-r-2 transition-colors relative ${S?"bg-[#1a1d24] border-gray-800 border-r-gray-800 group-hover/add-row:bg-white/5":"bg-white border-gray-100 border-r-gray-200/50 group-hover/add-row:bg-gray-50"}`,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5",style:{backgroundColor:t.color}}),e.jsx("div",{className:"w-4 h-4 rounded border border-gray-200 flex items-center justify-center text-gray-300",children:e.jsx(He,{size:10})})]}),e.jsx("div",{className:`flex items-center pl-2 py-2 border-r sticky left-[50px] z-10 border-r-2 transition-colors ${S?"bg-[#1a1d24] border-gray-800 border-r-gray-800 group-hover/add-row:bg-white/5":"bg-white border-gray-100 border-r-gray-200/50 group-hover/add-row:bg-gray-50"}`,children:e.jsx("input",{type:"text",placeholder:"+ Add task",value:((ue=E[t.id])==null?void 0:ue.name)||"",onChange:n=>B(t.id,{name:n.target.value}),className:`w-full bg-transparent text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-2 ${S?"placeholder-gray-600 text-gray-200":"placeholder-gray-400 text-gray-700"}`,onKeyDown:n=>{n.key==="Enter"&&Z(t.id)}})}),t.columns.slice(1).map(n=>{var T,A,J,X,ce,We,ge,De,be,we,M,me,Pe,Ge,Ae;return e.jsx("div",{className:`border-r min-h-[32px] flex items-center justify-center ${S?"bg-[#1a1d24] border-gray-800":"bg-white border-gray-100"}`,children:n.type==="status"?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Ct,{status:n.id==="col_status"?((T=E[t.id])==null?void 0:T.status)||k.New:((J=(A=E[t.id])==null?void 0:A.textValues)==null?void 0:J[n.id])||k.New,onChange:G=>{var H;n.id==="col_status"?B(t.id,{status:G}):B(t.id,{textValues:{...(H=E[t.id])==null?void 0:H.textValues,[n.id]:G}})},tabIndex:0,darkMode:S})}):n.type==="priority"?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx($t,{priority:n.id==="col_priority"?((X=E[t.id])==null?void 0:X.priority)||K.Normal:((We=(ce=E[t.id])==null?void 0:ce.textValues)==null?void 0:We[n.id])||K.Normal,onChange:G=>{var H;n.id==="col_priority"?B(t.id,{priority:G}):B(t.id,{textValues:{...(H=E[t.id])==null?void 0:H.textValues,[n.id]:G}})},tabIndex:0,darkMode:S})}):n.type==="person"?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(St,{personId:n.id==="col_person"?((ge=E[t.id])==null?void 0:ge.personId)||null:((be=(De=E[t.id])==null?void 0:De.textValues)==null?void 0:be[n.id])||null,onChange:G=>{var H;n.id==="col_person"?B(t.id,{personId:G}):B(t.id,{textValues:{...(H=E[t.id])==null?void 0:H.textValues,[n.id]:G||""}})},tabIndex:0,darkMode:S})}):n.type==="button"?e.jsx("div",{className:"w-full h-full p-1",children:e.jsx("button",{className:"w-full h-full bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium rounded transition-colors flex items-center justify-center",children:"Action"})}):n.type==="connection"?e.jsx("div",{className:"w-full h-full p-1 flex items-center justify-center",children:e.jsxs("button",{onClick:G=>{G.stopPropagation();const H=G.currentTarget.getBoundingClientRect();b({groupId:t.id,taskId:"DRAFT_TASK",colId:n.id,rect:H,config:n.config})},className:`w-full h-full text-xs font-semibold rounded transition-all flex items-center justify-center gap-1.5 px-2 group/btn ${(we=n.config)!=null&&we.targetPath?"bg-blue-50 hover:bg-blue-100 text-blue-600 border border-blue-200":"bg-gray-50 hover:bg-gray-100 text-gray-500 border border-gray-200"}`,children:[e.jsx(bt,{size:12,className:"group-hover/btn:scale-110 transition-transform"}),e.jsx("span",{className:"truncate",children:(M=n.config)!=null&&M.targetName?`Go to ${n.config.targetName}`:"Connect"})]})}):n.type==="date"?e.jsx("div",{className:"w-full h-full relative flex items-center justify-center",children:e.jsx("div",{className:`text-xs cursor-pointer font-medium px-2 py-1 rounded transition-colors focus:ring-2 focus:ring-blue-500 focus:outline-none ${S?"text-gray-400 hover:text-gray-200 hover:bg-white/10":"text-gray-500 hover:text-gray-800 hover:bg-gray-100"}`,onClick:G=>{var xe,pe,ve;G.stopPropagation();const H=G.currentTarget.getBoundingClientRect(),ee=n.id==="col_date",de=ee?((xe=E[t.id])==null?void 0:xe.dueDate)||"":((ve=(pe=E[t.id])==null?void 0:pe.textValues)==null?void 0:ve[n.id])||"";g({taskId:"draft-"+t.id,colId:n.id,date:de,rect:H,onSelect:ye=>{var je;ee?B(t.id,{dueDate:ye}):B(t.id,{textValues:{...(je=E[t.id])==null?void 0:je.textValues,[n.id]:ye}})}})},tabIndex:0,onKeyDown:G=>{var H,ee,de;if(G.key==="Enter"||G.key===" "){G.preventDefault();const xe=G.currentTarget.getBoundingClientRect(),pe=n.id==="col_date",ve=pe?((H=E[t.id])==null?void 0:H.dueDate)||"":((de=(ee=E[t.id])==null?void 0:ee.textValues)==null?void 0:de[n.id])||"";g({taskId:"draft-"+t.id,colId:n.id,date:ve,rect:xe,onSelect:ye=>{var je;pe?B(t.id,{dueDate:ye}):B(t.id,{textValues:{...(je=E[t.id])==null?void 0:je.textValues,[n.id]:ye}})}})}},children:(()=>{var ee,de,xe;const H=n.id==="col_date"?(ee=E[t.id])==null?void 0:ee.dueDate:(xe=(de=E[t.id])==null?void 0:de.textValues)==null?void 0:xe[n.id];return H?new Date(H).toLocaleDateString(void 0,{month:"short",day:"numeric"}):e.jsx("span",{className:"text-gray-300",children:"Set Date"})})()})}):n.type==="text"?e.jsx("input",{type:"text",value:((Pe=(me=E[t.id])==null?void 0:me.textValues)==null?void 0:Pe[n.id])||"",onChange:G=>{var H;return B(t.id,{textValues:{...(H=E[t.id])==null?void 0:H.textValues,[n.id]:G.target.value}})},className:"w-full h-full text-center px-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded text-gray-600",placeholder:"-",tabIndex:0,onKeyDown:G=>G.key==="Enter"&&Z(t.id)}):n.type==="number"?e.jsx("input",{type:"text",value:((Ae=(Ge=E[t.id])==null?void 0:Ge.textValues)==null?void 0:Ae[n.id])||"",onChange:G=>{var ee;const H=G.target.value;/^[0-9.,]*$/.test(H)&&B(t.id,{textValues:{...(ee=E[t.id])==null?void 0:ee.textValues,[n.id]:H}})},className:"w-full h-full text-center px-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded text-gray-600 font-mono text-xs",placeholder:"0",tabIndex:0,onKeyDown:G=>G.key==="Enter"&&Z(t.id)}):e.jsx("div",{className:"w-full h-full"})},n.id)}),e.jsx("div",{className:`transition-colors ${S?"bg-[#1a1d24] group-hover/add-row:bg-white/5":"bg-white group-hover/add-row:bg-gray-50"}`})]}),e.jsxs("div",{className:`grid gap-px border-t rounded-b-xl min-w-full w-fit ${S?"bg-[#1a1d24] border-gray-800":"bg-white border-gray-200"}`,style:{gridTemplateColumns:m+" "+t.columns.map(n=>n.width).join(" ")+" "+L},children:[e.jsx("div",{className:`flex items-center justify-center border-r sticky left-0 z-10 border-r-2 ${S?"bg-[#1a1d24] border-gray-800 border-r-gray-800":"bg-white border-gray-100 border-r-gray-200/50"}`}),e.jsx("div",{className:`flex items-center justify-center sticky left-[50px] z-10 border-t ${S?"bg-[#1a1d24] border-gray-800":"bg-white border-gray-200"}`,children:e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider"})}),t.columns.slice(1).map(n=>e.jsxs("div",{className:`border-r min-h-[32px] flex items-center justify-center px-2 ${S?"bg-[#1a1d24] border-gray-800":"bg-white border-gray-100"}`,children:[n.type==="status"&&e.jsx("div",{className:"w-full h-4 flex rounded-sm overflow-hidden",children:Object.values(k).map(T=>{const A=a.filter(X=>Ze(t,X)===T).length;if(A===0)return null;const J=A/Math.max(a.length,1)*100;return e.jsx("div",{style:{width:J+"%"},title:T+": "+A,className:Qe[T]+" h-full hover:opacity-80 transition-opacity"},T)})}),n.type==="priority"&&e.jsx("div",{className:"w-full h-4 flex rounded-sm overflow-hidden",children:Object.values(K).map(T=>{const A=t.tasks.filter(X=>(n.id==="col_priority"?X.priority:X.textValues[n.id])===T).length;if(A===0)return null;const J=A/t.tasks.length*100;return e.jsx("div",{style:{width:J+"%"},title:T+": "+A,className:ke[T]+" h-full hover:opacity-80 transition-opacity"},T)})}),n.type==="person"&&(()=>{const T=t.tasks.filter(A=>{const J=n.id==="col_owner"?A.personId:A.textValues[n.id];return J&&J.length>0}).length;return T===0?null:e.jsxs("div",{className:"flex flex-col items-center justify-center leading-none",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium",children:T}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"owners"})]})})(),n.type==="money"&&(()=>{const T=t.tasks.reduce((A,J)=>{var ce;const X=(ce=J.textValues[n.id])==null?void 0:ce.replace(/,/g,"");return A+(Number(X)||0)},0);return e.jsxs("div",{className:"flex flex-col items-center justify-center leading-none",children:[e.jsxs("span",{className:"text-xs text-gray-700 font-bold font-mono",children:[n.currency||"$"," ",T.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"sum"})]})})(),n.type==="checkbox"&&(()=>{const T=t.tasks.filter(A=>A.textValues[n.id]==="true").length;return T===0?null:e.jsxs("div",{className:"flex flex-col items-center justify-center leading-none",children:[e.jsx("span",{className:"text-xs text-gray-700 font-bold font-mono",children:T}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"checked"})]})})(),n.type==="number"&&(()=>{const T=t.tasks.reduce((A,J)=>{var ce;const X=(ce=J.textValues[n.id])==null?void 0:ce.replace(/,/g,"");return A+(Number(X)||0)},0);return e.jsxs("div",{className:"flex flex-col items-center justify-center leading-none",children:[e.jsx("span",{className:"text-xs text-gray-700 font-bold font-mono",children:T.toLocaleString()}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"sum"})]})})(),(n.type==="text"||n.type==="long_text"||n.type==="date"||n.type==="dropdown"||n.type==="name")&&(()=>{const T=t.tasks.filter(A=>{if(n.type==="name")return!0;const J=A.textValues[n.id];return J&&J.trim().length>0}).length;return T===0?null:e.jsxs("div",{className:"flex flex-col items-center justify-center leading-none",children:[e.jsx("span",{className:"text-xs text-gray-700 font-bold font-mono",children:T}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"count"})]})})()]},n.id)),e.jsx("div",{className:`${S?"bg-[#1a1d24]":"bg-white"}`})]})]})]})}),Qr=I.forwardRef(({storageKey:t="taskboard-state",tasks:a,onTaskUpdate:d,darkMode:r=!1,minimal:o=!1,showGroupHeader:P=!1,expandAllSignal:$,collapseAllSignal:j,searchQuery:D="",statusFilter:h="all",sortKey:p="none",transparent:O=!1,autoHeight:u=!1},_)=>{var rt;const{board:N,setBoard:m,aiAnalysis:L,setAiAnalysis:Q,updateTask:ie,toggleTaskSelection:U,toggleGroupSelection:R,updateTaskTextValue:Y,addTask:W,deleteTask:oe,addGroup:he,deleteGroup:i,updateGroupTitle:re,toggleGroupPin:le,addColumn:w,updateColumnTitle:V,deleteColumn:y,duplicateColumn:g,reorderColumn:b,updateColumnWidth:f}=fr(t),[c,z]=I.useState(null),{isImmersive:E,activePage:B,setActivePage:Z}=us(),S=(s,x)=>{z({type:"task",id:x,groupId:s})},ue=s=>{z({type:"group",groupId:s})},n=()=>{z({type:"selected"})},T=()=>{if(!c)return;const{type:s,id:x,groupId:l}=c;s==="task"&&x&&l?oe(l,x):s==="group"&&l?i(l):s==="selected"?Xt():s==="column"&&x&&l&&y(l,x),z(null)};I.useEffect(()=>{a&&a.length>0&&m(s=>{const x=[...s.groups];x.length===0&&x.push({id:"g1",title:"Tasks",color:"#3b82f6",tasks:[],columns:[],isPinned:!1});const l=x[0],v=a.map(C=>{let F=k.New;return C.status==="To do"?F=k.New:C.status==="In Progress"?F=k.Working:C.status==="Review"?F=k.AlmostFinish:C.status==="Complete"&&(F=k.Done),{id:C.id,name:C.title,status:F,priority:C.priority,personId:C.assigneeId||null,dueDate:C.dueDate?new Date(C.dueDate).toISOString():"",textValues:{},selected:!1}});return x[0]={...l,tasks:v},{...s,groups:x}})},[a,m]);const A=(s,x,l)=>{if(ie(s,x,l),d){const v={};l.name&&(v.title=l.name),l.status&&(l.status===k.New||l.status===k.Pending?v.status="To do":l.status===k.Working||l.status===k.Stuck?v.status="In Progress":l.status===k.AlmostFinish?v.status="Review":l.status===k.Done&&(v.status="Complete")),l.priority&&(v.priority=l.priority),l.personId!==void 0&&(v.assigneeId=l.personId||void 0),l.dueDate&&(v.dueDate=new Date(l.dueDate)),d(x,v)}},[J,X]=I.useState(!1),[ce,We]=I.useState(null),[ge,De]=I.useState(null),[be,we]=I.useState(null),[M,me]=I.useState(null),[Pe,Ge]=I.useState(new Set),[Ae,G]=I.useState({}),[H,ee]=I.useState(null),[de,xe]=I.useState(null),[pe,ve]=I.useState(null),ye=xt.getCurrentUser(),je=ye&&t===`taskboard-${ye.id}`,[_e,Je]=I.useState(null),[Ee,qe]=I.useState({}),[Pr,Ar]=I.useState(null),[Ye,Dt]=I.useState(null),zt=I.useRef(null),It=I.useRef(N.groups.length),[fe,Me]=I.useState(null),[kt,Xe]=I.useState(new Set);I.useEffect(()=>{const s=l=>{if(!fe)return;const v=l.clientX-fe.startX,C=Math.max(50,fe.startWidth+v);f(fe.groupId,fe.colId,C)},x=()=>{fe&&(Me(null),document.body.style.cursor="")};return fe&&(document.addEventListener("mousemove",s),document.addEventListener("mouseup",x),document.body.style.cursor="col-resize"),()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",x),document.body.style.cursor=""}},[fe,f]),I.useEffect(()=>{It.current=N.groups.length},[N.groups.length]);const Pt=s=>{const x=new Set(Pe);x.has(s)?x.delete(s):x.add(s),Ge(x)},At=(s,x)=>{var C;const l=(C=Ae[x])==null?void 0:C.trim();if(!l)return;const v={id:`subtask-${ae()}`,name:l,status:k.New,priority:K.Normal,dueDate:"",personId:null,textValues:{},selected:!1};m(F=>({...F,groups:F.groups.map(q=>q.id===s?{...q,tasks:q.tasks.map(te=>te.id===x?{...te,subtasks:[...te.subtasks||[],v]}:te)}:q)})),G(F=>({...F,[x]:""}))},_t=(s,x)=>{qe(l=>({...l,[s]:{...l[s],...x}}))},Et=s=>{const x=Ee[s]||{},l=x.name||"";l.trim()&&(W(s,l,x),qe(v=>{const C={...v};return delete C[s],C}))},Tt=s=>{if(Object.entries(Ee).filter(([,v])=>{var C;return(C=v==null?void 0:v.name)==null?void 0:C.trim()}).length===0)return N;const l={...N,groups:N.groups.map(v=>{var te;const C=Ee[v.id],F=(te=C==null?void 0:C.name)==null?void 0:te.trim();if(!C||!F)return v;const q={id:ae(),name:F,status:C.status||k.New,priority:C.priority||K.Normal,dueDate:C.dueDate||new Date().toISOString().split("T")[0],personId:C.personId??null,textValues:C.textValues||{},selected:!1};return{...v,tasks:[...v.tasks,q]}})};return s!=null&&s.skipPersist||m(l),qe({}),l};I.useImperativeHandle(_,()=>({exportBoardWithDrafts:Tt}),[N,Ee]);const Ft=(s,x,l)=>{s.preventDefault(),Je({x:s.clientX,y:s.clientY,groupId:x,colId:l})},Vt=(s,x,l)=>{if(s==="delete")y(x,l);else if(s==="duplicate")g(x,l);else if(s!=="move_left"){if(s!=="move_right"){if(s==="rename"){const v=prompt("Enter new column name:");v&&V(x,l,v)}}}Je(null)},Ot=ks(ot(As,{activationConstraint:{distance:5}}),ot(Ps,{activationConstraint:{delay:250,tolerance:5}})),Gt=s=>{const{active:x}=s;X(!0),Dt(x.id)},Lt=s=>{const{active:x,over:l}=s;if(!l){X(!1);return}const v=x.id,C=l.id;if(v===C){X(!1);return}m(F=>{const q=F.groups.find(ne=>ne.tasks.some(Ne=>Ne.id===v)),te=F.groups.find(ne=>ne.tasks.some(Ne=>Ne.id===C));if(!q||!te)return F;const nt=q.tasks.findIndex(ne=>ne.id===v),at=te.tasks.findIndex(ne=>ne.id===C);if(q.id===te.id){const ne=zs(q.tasks,nt,at),Ne=F.groups.map(ze=>ze.id===q.id?{...ze,tasks:ne}:ze);return{...F,groups:Ne}}else{const ne=[...q.tasks],[Ne]=ne.splice(nt,1),ze=[...te.tasks];ze.splice(at,0,Ne);const Zt=F.groups.map(Te=>Te.id===q.id?{...Te,tasks:ne}:Te.id===te.id?{...Te,tasks:ze}:Te);return{...F,groups:Zt}}}),X(!1)},Rt=(s,x,l,v)=>{if(v===0){s.preventDefault();return}s.dataTransfer.setData("application/json",JSON.stringify({type:"COLUMN",groupId:x,colId:l,index:v})),s.dataTransfer.effectAllowed="move"},Bt=(s,x)=>{s.preventDefault(),x===0?s.dataTransfer.dropEffect="none":s.dataTransfer.dropEffect="move"},Ht=(s,x,l)=>{s.preventDefault();const v=s.dataTransfer.getData("application/json");if(v)try{const{type:C,groupId:F,index:q}=JSON.parse(v);C==="COLUMN"&&F===x&&q!==l&&l!==0&&b(x,q,l)}catch{}},Le=D.trim().toLowerCase(),Ut=Le.length>0||h!=="all",Wt=s=>!Le||s.name.toLowerCase().includes(Le)?!0:Object.values(s.textValues||{}).some(x=>(x||"").toLowerCase().includes(Le)),Jt=(s,x)=>{if(h==="all")return!0;const l=Ze(x,s);return h==="done"?l===k.Done:h==="new"?l===k.New||l===k.Pending:l!==k.Done},qt=s=>{if(p==="none")return s;const x=[...s];if(p==="name")x.sort((l,v)=>l.name.localeCompare(v.name));else if(p==="dueAsc"||p==="dueDesc")x.sort((l,v)=>{const C=l.dueDate?new Date(l.dueDate).getTime():1/0,F=v.dueDate?new Date(v.dueDate).getTime():1/0;return p==="dueAsc"?C-F:F-C});else if(p==="priority"){const l={[K.Urgent]:1,[K.High]:2,[K.Medium]:3,[K.Normal]:4,[K.Low]:5};x.sort((v,C)=>(l[v.priority]||99)-(l[C.priority]||99))}return x},et="50px",tt="50px",Re=N.groups.flatMap(s=>s.tasks.filter(x=>x.selected).map(x=>({groupId:s.id,task:x}))).length,Yt=()=>{R("all",!1)},Xt=()=>{Re!==0&&m(s=>({...s,groups:s.groups.map(x=>({...x,tasks:x.tasks.filter(l=>!l.selected)}))}))},Kt=()=>{Re!==0&&m(s=>({...s,groups:s.groups.map(x=>{const l=x.tasks.filter(C=>C.selected);if(l.length===0)return x;const v=l.map(C=>({...C,id:crypto.randomUUID(),name:C.name+" (Copy)",selected:!0}));return{...x,tasks:[...x.tasks,...v]}})}))},Qt=s=>{Xe(x=>{const l=new Set(x);return l.has(s)?l.delete(s):l.add(s),l})};I.useEffect(()=>{$!==void 0&&Xe(new Set)},[$]);const st=I.useRef(j);return I.useEffect(()=>{j!==void 0&&j!==st.current&&(Xe(new Set(N.groups.map(s=>s.id))),st.current=j)},[j,N.groups]),e.jsxs(_s,{sensors:Ot,collisionDetection:Es,onDragStart:Gt,onDragEnd:Lt,children:[e.jsxs("div",{className:`flex w-full ${o||u?"h-full":"h-screen"} ${u?"":"overflow-hidden"} font-sans transition-colors ${O?"bg-transparent":r?"bg-[#0f1115] text-gray-200":"bg-white text-gray-800"}`,children:[e.jsxs("main",{className:`flex-1 flex flex-col ${o||u?"h-full":"h-screen"} ${u?"":"overflow-hidden"} relative transition-colors ${O?"bg-transparent":r?"bg-[#0f1115]":"bg-white"}`,children:[!o&&e.jsxs("header",{className:`h-16 flex items-center justify-between px-8 flex-shrink-0 transition-colors ${O?"bg-transparent":r?"bg-[#0f1115] border-b border-white/5":"bg-white"}`,children:[e.jsx("div",{children:e.jsx("h1",{className:`text-2xl font-bold tracking-tight ${r?"text-white":"text-gray-800"}`,children:N.name})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:s=>{const x=N.groups[0];x&&W(x.id)},className:"flex items-center gap-2 px-4 py-2 bg-clickup-purple text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-sm active:scale-95",children:[e.jsx(He,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Add Task"})]}),e.jsxs("button",{onClick:he,className:"flex items-center gap-2 px-4 py-2 bg-[#1e2126] text-white rounded-md hover:bg-[#2c3036] transition text-sm font-medium shadow-sm",children:[e.jsx(bs,{className:"w-4 h-4"})," New Group"]})]})]}),e.jsxs("div",{ref:zt,className:`flex-1 ${u?"":"overflow-y-auto overflow-x-hidden custom-scroll"} ${o?"p-0 pb-4":u?"":"p-6 pb-96"}`,children:[L&&e.jsxs("div",{className:"mb-8 p-6 bg-white border border-indigo-100 rounded-2xl shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400"}),e.jsxs("h3",{className:"text-indigo-900 font-bold text-lg mb-3 flex items-center gap-2",children:[e.jsx(ws,{className:"w-5 h-5 text-indigo-500"})," AI Assistant Insights"]}),e.jsx("p",{className:"text-gray-700 whitespace-pre-line text-sm leading-relaxed",children:L}),e.jsx("button",{onClick:()=>Q(null),className:"mt-4 text-xs font-semibold text-gray-400 hover:text-gray-600 uppercase tracking-wider",children:"Dismiss"})]}),e.jsx("div",{className:"space-y-8 w-full",children:[...N.groups].sort((s,x)=>(x.isPinned?1:0)-(s.isPinned?1:0)).map(s=>{const x=qt(s.tasks.filter(F=>Wt(F)&&Jt(F,s))),l=Ir(s,x),v=s.tasks.length>0&&s.tasks.every(F=>F.selected),C=s.tasks.some(F=>F.selected);return Ut&&x.length===0?null:e.jsx(kr,{group:s,filteredTasks:x,progress:l,collapsedGroups:kt,toggleGroupCollapse:Qt,updateGroupTitle:re,toggleGroupPin:le,setShowReminderModalGroupId:ee,setShowGoalsModalGroupId:xe,setShowTaskBoardModalGroupId:ve,isMainBoard:je,handleDeleteGroupClick:ue,allSelected:v,someSelected:C,toggleGroupSelection:R,selectionColumnWidth:et,actionColumnWidth:tt,handleContextMenu:Ft,handleColumnDragStart:Rt,handleColumnDragOver:Bt,handleColumnDrop:Ht,updateColumnTitle:V,activeColumnMenu:be,setActiveColumnMenu:we,setResizingCol:Me,expandedTaskIds:Pe,toggleTaskSelection:U,updateTask:A,handleDeleteTaskClick:S,updateTaskTextValue:Y,toggleSubtask:Pt,setActiveDatePicker:De,setActiveConnectionMenu:me,handleAddSubtask:At,subtaskInput:Ae,setSubtaskInput:G,draftTasks:Ee,updateDraftTask:_t,handleAddTask:Et,darkMode:r},s.id)})})]}),e.jsx(gs,{children:Re>0&&e.jsx(it.div,{className:"fixed bottom-16 md:bottom-20 left-0 right-0 px-4 z-50 pointer-events-none",initial:{opacity:0,y:16,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:16,scale:.98},transition:{duration:.18,ease:"easeOut"},children:e.jsx(it.div,{className:`mx-auto max-w-5xl shadow-2xl border rounded-2xl px-6 py-3 flex items-center gap-6 pointer-events-auto justify-center ${r?"bg-[#1a1d24] border-gray-800":"bg-white border-gray-200"}`,initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:.18,ease:"easeOut",delay:.02},children:e.jsx("div",{className:"flex items-center gap-5 text-sm text-gray-600 flex-wrap md:flex-nowrap justify-center w-full",children:e.jsxs("div",{className:"flex items-center gap-5 flex-wrap md:flex-nowrap justify-center",children:[e.jsxs("button",{className:"flex items-center gap-2 hover:text-gray-900 whitespace-nowrap text-gray-700",onClick:Kt,children:[e.jsx(wt,{size:18,className:"text-gray-700"})," ",e.jsx("span",{children:"Duplicate"})]}),e.jsxs("button",{className:"flex items-center gap-2 hover:text-gray-900 whitespace-nowrap text-gray-700",children:[e.jsx(ms,{size:18,className:"text-gray-700"})," ",e.jsx("span",{children:"Export"})]}),e.jsxs("button",{className:"flex items-center gap-2 hover:text-gray-900 whitespace-nowrap text-gray-700",children:[e.jsx(Hs,{size:18,className:"text-gray-700"})," ",e.jsx("span",{children:"Archive"})]}),e.jsxs("button",{className:"flex items-center gap-2 hover:text-gray-900 whitespace-nowrap text-gray-700",onClick:n,children:[e.jsx(Ke,{size:18,className:"text-gray-700"})," ",e.jsx("span",{children:"Delete"})]}),e.jsxs("button",{className:"flex items-center gap-2 text-gray-400 cursor-not-allowed whitespace-nowrap",disabled:!0,children:[e.jsx(ct,{size:18,className:"text-gray-400"})," ",e.jsx("span",{children:"Convert"})]}),e.jsxs("button",{className:"flex items-center gap-2 hover:text-gray-900 whitespace-nowrap text-gray-700",children:[e.jsx(ct,{size:18,className:"text-gray-700"})," ",e.jsx("span",{children:"Move to"})]}),e.jsxs("button",{className:"flex items-center gap-2 hover:text-gray-900 whitespace-nowrap text-gray-700",children:[e.jsx(jt,{size:18,className:"text-gray-700"})," ",e.jsx("span",{children:"Sidekick"})]}),e.jsxs("button",{className:"flex items-center gap-2 hover:text-gray-900 whitespace-nowrap text-gray-700",children:[e.jsx(yt,{size:18,className:"text-gray-700"})," ",e.jsx("span",{children:"Apps"})]}),e.jsxs("button",{className:"flex items-center gap-2 hover:text-gray-900 whitespace-nowrap text-gray-700",onClick:Yt,children:[e.jsx(Oe,{size:18,className:"text-gray-700"})," ",e.jsx("span",{children:"Clear"})]})]})})})})})]}),_e&&e.jsx(br,{x:_e.x,y:_e.y,onClose:()=>Je(null),onAction:s=>Vt(s,_e.groupId,_e.colId)}),ge&&$e.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[9998] bg-transparent",onClick:s=>{s.stopPropagation(),De(null)}}),e.jsx("div",{className:"fixed z-[10005]",style:{top:ge.rect.bottom+8,left:ge.rect.left+ge.rect.width/2,transform:"translateX(-50%)"},onClick:s=>s.stopPropagation(),children:e.jsx(js,{date:ge.date,onSelect:s=>{ge.onSelect(s)},onClose:()=>De(null)})})]}),document.body),be&&$e.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[9998] bg-transparent",onClick:s=>{s.stopPropagation(),we(null)}}),e.jsx("div",{className:"fixed top-[100px] bottom-0 right-0 z-[10005]",onClick:s=>s.stopPropagation(),children:e.jsx(vs,{onClose:()=>we(null),onSelect:(s,x,l,v,C)=>{be&&w(be.groupId,s,x,l,v,C),we(null)},darkMode:r})})]}),document.body),M&&$e.createPortal(e.jsx("div",{className:"fixed inset-0 z-[100] flex items-start justify-start",onClick:()=>me(null),children:e.jsx("div",{className:"absolute bg-white rounded-lg shadow-xl border border-gray-200 w-64 p-2 animate-in fade-in zoom-in-95 duration-100",style:{top:Math.min(M.rect.bottom+8,window.innerHeight-300),left:Math.max(8,Math.min(M.rect.left,window.innerWidth-270))},onClick:s=>s.stopPropagation(),children:(rt=M.config)!=null&&rt.targetPath?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase px-2 mb-2",children:"Connected Page"}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 text-blue-700 rounded-md",children:[e.jsx(pt,{size:16}),e.jsx("span",{className:"font-medium text-sm",children:M.config.targetName})]}),e.jsxs("button",{onClick:()=>{var s;(s=M.config)!=null&&s.targetPath&&Z(M.config.targetPath),me(null)},className:"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-md text-sm font-medium transition-colors",children:["Open Page ",e.jsx(Ls,{size:14})]}),e.jsx("div",{className:"h-px bg-gray-100 my-2"}),e.jsx("button",{onClick:()=>{me(s=>s?{...s,config:void 0}:null)},className:"w-full text-left px-2 py-1.5 text-xs text-gray-500 hover:text-gray-900 hover:bg-gray-50 rounded",children:"Change Connection..."})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2 px-2 border-b pb-2",children:e.jsx("h3",{className:"font-semibold text-gray-800 text-sm",children:"Select Page to Connect"})}),[{name:"Goals",path:"goals"},{name:"Reminders",path:"reminders"},{name:"Overview",path:"overview"},{name:"Tasks",path:"tasks"},{name:"Vault",path:"vault"},{name:"Teams",path:"teams"},{name:"Departments",path:"departments"},{name:"Private Rooms",path:"rooms"},{name:"Discussion",path:"discussion"}].map(s=>e.jsxs("button",{onClick:()=>{if(M.taskId==="DRAFT_TASK"){me(null);return}const x={targetPath:s.path,targetName:s.name};Y(M.groupId,M.taskId,M.colId,JSON.stringify(x)),me(null)},className:"w-full text-left px-2 py-1.5 rounded hover:bg-gray-50 flex items-center justify-between group transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.name}),e.jsx(ht,{size:14,className:"text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]},s.path))]})})}),document.body),H&&e.jsx(wr,{isOpen:!!H,onClose:()=>ee(null),group:N.groups.find(s=>s.id===H)}),de&&e.jsx(vr,{isOpen:!0,onClose:()=>xe(null),group:N.groups.find(s=>s.id===de)}),pe&&e.jsx(jr,{isOpen:!0,onClose:()=>ve(null),group:N.groups.find(s=>s.id===pe)}),e.jsx(hs,{isOpen:!!c,onClose:()=>z(null),onConfirm:T,title:(c==null?void 0:c.type)==="task"?"Delete Task":(c==null?void 0:c.type)==="group"?"Delete Group":(c==null?void 0:c.type)==="column"?"Delete Column":"Delete Selected Tasks",message:(c==null?void 0:c.type)==="task"?"Are you sure you want to delete this task? This action cannot be undone.":(c==null?void 0:c.type)==="group"?"Are you sure you want to delete this group and all its tasks? This action cannot be undone.":(c==null?void 0:c.type)==="column"?"Are you sure you want to delete this column? This action cannot be undone.":`Are you sure you want to delete ${Re} tasks? This action cannot be undone.`,confirmText:"Delete",variant:"danger"})]}),e.jsx(Ts,{dropAnimation:{sideEffects:Fs({styles:{active:{opacity:"1"}}})},children:Ye?(()=>{const s=N.groups.flatMap(l=>l.tasks).find(l=>l.id===Ye),x=N.groups.find(l=>l.tasks.some(v=>v.id===Ye));return!s||!x?null:e.jsxs("div",{className:`grid gap-px text-sm rounded cursor-grabbing shadow-2xl ring-2 ring-blue-500/20 z-50 transform scale-[1.01] ${r?"bg-[#1a1d24] border-gray-700":"bg-white border-gray-200"}`,style:{gridTemplateColumns:et+" "+x.columns.map(l=>l.width).join(" ")+" "+tt,width:"100%"},children:[e.jsxs("div",{className:`flex items-center justify-center py-1.5 border-r relative ${r?"border-gray-800":"border-gray-100"}`,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5",style:{backgroundColor:x.color}}),e.jsx("div",{className:"w-4 h-4 rounded border-gray-300"})]}),x.columns.map(l=>{var C,F;const v=l.type==="name";return e.jsxs("div",{className:`relative border-r flex items-center ${v?"justify-start pl-2":"justify-center"} min-h-[32px] overflow-hidden ${r?"border-gray-800":"border-gray-100"}`,children:[v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-gray-400 mr-2 p-1",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"9",cy:"12",r:"1"}),e.jsx("circle",{cx:"9",cy:"5",r:"1"}),e.jsx("circle",{cx:"9",cy:"19",r:"1"}),e.jsx("circle",{cx:"15",cy:"12",r:"1"}),e.jsx("circle",{cx:"15",cy:"5",r:"1"}),e.jsx("circle",{cx:"15",cy:"19",r:"1"})]})}),e.jsx("div",{className:`font-medium truncate ${r?"text-gray-200":"text-gray-700"}`,children:s.name})]}),l.type==="status"&&e.jsx("div",{className:"px-2 py-0.5 rounded text-white text-xs font-bold uppercase truncate",style:{backgroundColor:Qe[s.status]},children:s.status}),l.type==="priority"&&e.jsx("div",{className:"px-2 py-0.5 rounded text-white text-xs font-bold uppercase truncate",style:{backgroundColor:ke[s.priority]},children:s.priority}),l.type==="person"&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-200 flex items-center justify-center text-[10px] font-medium text-gray-600",children:((C=Ue.find(q=>q.id===s.personId))==null?void 0:C.name.charAt(0))||"?"}),e.jsx("span",{className:"text-xs truncate",children:(F=Ue.find(q=>q.id===s.personId))==null?void 0:F.name})]}),l.type==="date"&&e.jsx("div",{className:"text-xs text-gray-500 truncate",children:s.dueDate||"-"}),l.type==="text"&&e.jsx("div",{className:"text-xs text-gray-500 truncate px-2",children:s[l.id]||"-"})]},l.id)}),e.jsx("div",{className:"border-r border-transparent"})]})})():null})]})});export{qs as A,Fe as I,Nt as M,K as P,k as S,Qr as T,fr as u};
