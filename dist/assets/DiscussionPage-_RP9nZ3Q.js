import{c as N,r as d,j as e,X as M,H as p,a1 as D,P as $,T as P,O as E,a3 as O,N as I,a4 as _}from"./index-BpRJKc9c.js";import{U as v}from"./constants-3htZeBAr.js";import{P as A,C as L}from"./phone-BhicSecl.js";import{L as T}from"./list-BN9YoTp-.js";import{P as F}from"./paperclip-DfuKIxIM.js";import{S as R}from"./smile-CjvPSO5J.js";import{S as U}from"./send-D-g-rCoo.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],V=N("bold",H);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],q=N("italic",Y);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],J=N("link",B);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],G=N("mic",X),K=({isOpen:t,onClose:i,onCreate:c})=>{const[l,u]=d.useState(""),[x,m]=d.useState([]);if(!t)return null;const y=r=>{r.preventDefault(),l.trim()&&(c(l,x),u(""),m([]),i())},w=r=>{m(h=>h.includes(r)?h.filter(S=>S!==r):[...h,r])},j=Object.values(v).filter(r=>r.id!=="me");return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Start New Discussion"}),e.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(M,{size:20,className:"text-gray-500"})})]}),e.jsxs("form",{onSubmit:y,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discussion Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:l,onChange:r=>u(r.target.value),placeholder:"e.g. Project Alpha",className:"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add Participants"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-gray-100 rounded-lg p-2",children:j.map(r=>e.jsxs("div",{onClick:()=>w(r.id),className:`flex items-center p-2 rounded-md cursor-pointer transition-colors ${x.includes(r.id)?"bg-blue-50 border-blue-100":"hover:bg-gray-50"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold mr-3",style:{backgroundColor:r.color},children:r.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.name}),e.jsx("p",{className:"text-xs text-gray-500",children:r.email})]}),x.includes(r.id)&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})]},r.id))})]}),e.jsxs("div",{className:"flex justify-end pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 mr-2",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!l.trim(),className:"px-4 py-2 bg-[#1e2126] hover:bg-[#2c3036] text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Discussion"})]})]})]})})},f=D(),b={getChannels:async()=>{try{const t=await fetch(`${f}/channels`);if(!t.ok)throw new Error("Failed to fetch channels");return t.json()}catch(t){return console.error("Error fetching channels:",t),[]}},createChannel:async(t,i)=>{const c={id:Date.now().toString(),name:t,type:"public",participants:i};return(await fetch(`${f}/channels`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).json()},deleteChannel:async t=>{await fetch(`${f}/channels/${t}`,{method:"DELETE"})},getMessages:async t=>{try{const i=await fetch(`${f}/discussion_messages?channelId=${t}`);if(!i.ok)throw new Error("Failed to fetch messages");return i.json()}catch(i){return console.error("Error fetching messages:",i),[]}},sendMessage:async(t,i,c="me")=>{const l=Object.values(v).find(m=>m.id===c)||v.me,u={id:Date.now().toString(),sender:l.name,senderId:l.id,content:i,timestamp:new Date().toISOString(),avatar:l.avatar,channelId:t};return(await fetch(`${f}/discussion_messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).json()}},re=()=>{const[t,i]=d.useState(null),[c,l]=d.useState(""),[u,x]=d.useState(!1),[m,y]=d.useState([]),[w,j]=d.useState({});d.useEffect(()=>{r()},[]),d.useEffect(()=>{if(t){h(t);const s=setInterval(()=>h(t),3e3);return()=>clearInterval(s)}},[t]);const r=async()=>{const s=await b.getChannels();y(s)},h=async s=>{const a=await b.getMessages(s);j(n=>({...n,[s]:a}))},S=async(s,a)=>{const n=await b.createChannel(s,a);y(g=>[...g,n]),i(n.id)},C=async(s,a)=>{if(s.stopPropagation(),window.confirm("Are you sure you want to delete this discussion?"))try{await b.deleteChannel(a),y(n=>n.filter(g=>g.id!==a)),t===a&&i(null)}catch(n){console.error("Failed to delete channel:",n)}},z=async s=>{if(s.preventDefault(),!(!c.trim()||!t))try{const a={id:`temp-${Date.now()}`,sender:"You",senderId:"me",content:c,timestamp:new Date().toISOString(),channelId:t};j(n=>({...n,[t]:[...n[t]||[],a]})),l(""),await b.sendMessage(t,a.content),h(t)}catch(a){console.error("Failed to send message:",a)}},o=m.find(s=>s.id===t),k=t?w[t]||[]:[];return e.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[e.jsxs("div",{className:"w-64 bg-gray-50 border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"font-bold text-gray-800",children:"Discussions"}),e.jsx("button",{onClick:()=>x(!0),className:"p-1 hover:bg-gray-200 rounded-md text-gray-500 transition-colors",title:"New Discussion",children:e.jsx($,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 px-2",children:"Channels"}),m.length===0&&e.jsx("div",{className:"px-2 text-sm text-gray-400 italic",children:"No discussions yet. Start one!"}),m.map(s=>e.jsxs("button",{onClick:()=>i(s.id),className:`w-full flex items-center justify-between px-2 py-1.5 rounded-md text-sm transition-colors group ${t===s.id?"bg-gray-200 text-gray-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:[e.jsxs("div",{className:"flex items-center truncate",children:[e.jsx(p,{size:16,className:"mr-2 opacity-70 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.name})]}),e.jsx("div",{onClick:a=>C(a,s.id),className:"p-1 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded opacity-0 group-hover:opacity-100 transition-all",title:"Delete Discussion",children:e.jsx(P,{size:14})})]},s.id))]})})]}),e.jsx("div",{className:"flex-1 flex flex-col min-w-0 bg-white",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-14 border-b border-gray-200 flex items-center justify-between px-4 bg-white flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx(p,{size:20,className:"text-gray-400 mr-2 flex-shrink-0"}),e.jsx("h3",{className:"font-bold text-gray-800 truncate",children:o==null?void 0:o.name}),(o==null?void 0:o.participants)&&o.participants.length>0&&e.jsx("div",{className:"ml-4 flex items-center space-x-1 overflow-hidden",children:o.participants.map(s=>{const a=v[s];return a?e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-[10px] text-white font-bold ring-2 ring-white",style:{backgroundColor:a.color},title:a.name,children:a.avatar},s):null})})]}),e.jsxs("div",{className:"flex items-center space-x-3 text-gray-500 flex-shrink-0 ml-2",children:[e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded-md",children:e.jsx(E,{size:18})}),e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded-md",children:e.jsx(A,{size:18})}),e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded-md",children:e.jsx(O,{size:18})}),e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded-md",children:e.jsx(I,{size:18})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[k.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(p,{size:48,className:"mb-4 opacity-20"}),e.jsxs("p",{children:["Start the conversation in #",o==null?void 0:o.name,"!"]})]}),k.map((s,a)=>{const n=s.senderId==="me"||s.sender==="You",g=a===0||k[a-1].sender!==s.sender;return e.jsxs("div",{className:`flex ${n?"justify-end":"justify-start"} group`,children:[!n&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 text-xs font-bold mr-3 flex-shrink-0 mt-1",children:g?s.avatar:""}),e.jsxs("div",{className:`max-w-[70%] ${n?"items-end":"items-start"} flex flex-col`,children:[g&&e.jsxs("div",{className:"flex items-baseline mb-1",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-900 mr-2",children:s.sender}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:`px-4 py-2 rounded-lg text-sm shadow-sm ${n?"bg-gray-900 text-white rounded-tr-none":"bg-gray-100 text-gray-800 rounded-tl-none"}`,children:s.content})]}),n&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-800 text-xs font-bold ml-3 flex-shrink-0 mt-1",children:"You"})]},s.id)})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("form",{onSubmit:z,className:"relative rounded-xl border border-gray-300 shadow-sm transition-all bg-gray-50 focus-within:ring-0 focus-within:border-gray-400",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-2 border-b border-gray-200/50",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"Bold",children:e.jsx(V,{size:16})}),e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"Italic",children:e.jsx(q,{size:16})}),e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"Code",children:e.jsx(_,{size:16})}),e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"List",children:e.jsx(T,{size:16})}),e.jsx("div",{className:"w-px h-4 bg-gray-300 mx-1"}),e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"Add Link",children:e.jsx(J,{size:16})})]}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsxs("button",{type:"button",className:"flex items-center space-x-1 px-2 py-1 text-xs font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",children:[e.jsx(L,{size:14}),e.jsx("span",{children:"Integration"})]})})]}),e.jsx("input",{type:"text",value:c,onChange:s=>l(s.target.value),placeholder:`Message #${o==null?void 0:o.name}`,className:"w-full py-3 px-4 bg-transparent border-none focus:ring-0 outline-none text-sm min-h-[50px]"}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full transition-colors",title:"Attach File",children:e.jsx(F,{size:18})}),e.jsx("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full transition-colors",title:"Add Emoji",children:e.jsx(R,{size:18})}),e.jsx("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full transition-colors",title:"Record Voice",children:e.jsx(G,{size:18})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-xs text-gray-400 mr-2 hidden sm:block",children:[e.jsx("strong",{children:"Return"})," to send"]}),e.jsx("button",{type:"submit",disabled:!c.trim(),className:`p-2 rounded-lg transition-colors ${c.trim()?"bg-gray-900 text-white hover:bg-black shadow-md":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:e.jsx(U,{size:18})})]})]})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(p,{size:32,className:"text-gray-300"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No Discussion Selected"}),e.jsx("p",{className:"max-w-xs text-center text-sm",children:"Select a channel from the sidebar or start a new discussion to get chatting."}),e.jsx("button",{onClick:()=>x(!0),className:"mt-6 px-4 py-2 bg-[#1e2126] text-white rounded-md text-sm font-medium hover:bg-[#2c3036] transition-colors",children:"Start New Discussion"})]})}),e.jsx(K,{isOpen:u,onClose:()=>x(!1),onCreate:S})]})};export{re as default};
