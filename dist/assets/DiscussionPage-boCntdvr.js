import{c as w,r as x,j as e,X as P,H as j,$ as I,P as E,T as O,K as T,a4 as _,I as A,a5 as L,a2 as F}from"./index-DK7_M6Tf.js";import{U as N}from"./constants-DIz9rW5w.js";import{P as R,C as U}from"./phone-fE_mEW86.js";import{L as H}from"./list-Byk9ZAme.js";import{P as V}from"./paperclip-DIJeZ3ye.js";import{S as Y}from"./smile-BUPWOihf.js";import{S as q}from"./send-BNw3efxe.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],J=w("bold",B);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],X=w("italic",K);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Q=w("link",G);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Z=w("mic",W),ee=({isOpen:s,onClose:n,onCreate:c})=>{const[o,h]=x.useState(""),[m,d]=x.useState([]);if(!s)return null;const g=r=>{r.preventDefault(),o.trim()&&(c(o,m),h(""),d([]),n())},y=r=>{d(u=>u.includes(r)?u.filter(S=>S!==r):[...u,r])},f=Object.values(N).filter(r=>r.id!=="me");return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Start New Discussion"}),e.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(P,{size:20,className:"text-gray-500"})})]}),e.jsxs("form",{onSubmit:g,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discussion Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:o,onChange:r=>h(r.target.value),placeholder:"e.g. Project Alpha",className:"w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add Participants"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-gray-100 rounded-lg p-2",children:f.map(r=>e.jsxs("div",{onClick:()=>y(r.id),className:`flex items-center p-2 rounded-md cursor-pointer transition-colors ${m.includes(r.id)?"bg-blue-50 border-blue-100":"hover:bg-gray-50"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold mr-3",style:{backgroundColor:r.color},children:r.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.name}),e.jsx("p",{className:"text-xs text-gray-500",children:r.email})]}),m.includes(r.id)&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})]},r.id))})]}),e.jsxs("div",{className:"flex justify-end pt-2",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 mr-2",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"px-4 py-2 bg-[#1e2126] hover:bg-[#2c3036] text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Discussion"})]})]})]})})},b=I(),p={getChannels:async()=>{try{const s=await fetch(`${b}/channels`);if(!s.ok)throw new Error("Failed to fetch channels");return s.json()}catch(s){return console.error("Error fetching channels:",s),[]}},createChannel:async(s,n)=>{const c={id:Date.now().toString(),name:s,type:"public",participants:n};return(await fetch(`${b}/channels`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).json()},deleteChannel:async s=>{await fetch(`${b}/channels/${s}`,{method:"DELETE"})},getMessages:async s=>{try{const n=await fetch(`${b}/discussion_messages?channelId=${s}`);if(!n.ok)throw new Error("Failed to fetch messages");return n.json()}catch(n){return console.error("Error fetching messages:",n),[]}},sendMessage:async(s,n,c="me")=>{const o=Object.values(N).find(d=>d.id===c)||N.me,h={id:Date.now().toString(),sender:o.name,senderId:o.id,content:n,timestamp:new Date().toISOString(),avatar:o.avatar,channelId:s};return(await fetch(`${b}/discussion_messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})).json()}},oe=()=>{const[s,n]=x.useState(null),[c,o]=x.useState(""),[h,m]=x.useState(!1),[d,g]=x.useState(null),[y,f]=x.useState([]),[r,u]=x.useState({});x.useEffect(()=>{S()},[]),x.useEffect(()=>{if(s){C(s);const t=setInterval(()=>C(s),3e3);return()=>clearInterval(t)}},[s]);const S=async()=>{const t=await p.getChannels();f(t)},C=async t=>{const a=await p.getMessages(t);u(l=>({...l,[t]:a}))},D=async(t,a)=>{const l=await p.createChannel(t,a);f(v=>[...v,l]),n(l.id)},z=(t,a)=>{t.stopPropagation(),g(a)},M=async()=>{if(d){try{await p.deleteChannel(d),f(t=>t.filter(a=>a.id!==d)),s===d&&n(null)}catch(t){console.error("Failed to delete channel:",t)}g(null)}},$=async t=>{if(t.preventDefault(),!(!c.trim()||!s))try{const a={id:`temp-${Date.now()}`,sender:"You",senderId:"me",content:c,timestamp:new Date().toISOString(),channelId:s};u(l=>({...l,[s]:[...l[s]||[],a]})),o(""),await p.sendMessage(s,a.content),C(s)}catch(a){console.error("Failed to send message:",a)}},i=y.find(t=>t.id===s),k=s?r[s]||[]:[];return e.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[e.jsxs("div",{className:"w-64 bg-gray-50 border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"font-bold text-gray-800",children:"Discussions"}),e.jsx("button",{onClick:()=>m(!0),className:"p-1 hover:bg-gray-200 rounded-md text-gray-500 transition-colors",title:"New Discussion",children:e.jsx(E,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 px-2",children:"Channels"}),y.length===0&&e.jsx("div",{className:"px-2 text-sm text-gray-400 italic",children:"No discussions yet. Start one!"}),y.map(t=>e.jsxs("button",{onClick:()=>n(t.id),className:`w-full flex items-center justify-between px-2 py-1.5 rounded-md text-sm transition-colors group ${s===t.id?"bg-gray-200 text-gray-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:[e.jsxs("div",{className:"flex items-center truncate",children:[e.jsx(j,{size:16,className:"mr-2 opacity-70 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t.name})]}),e.jsx("div",{onClick:a=>z(a,t.id),className:"p-1 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded opacity-0 group-hover:opacity-100 transition-all",title:"Delete Discussion",children:e.jsx(O,{size:14})})]},t.id))]})})]}),e.jsx("div",{className:"flex-1 flex flex-col min-w-0 bg-white",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-14 border-b border-gray-200 flex items-center justify-between px-4 bg-white flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx(j,{size:20,className:"text-gray-400 mr-2 flex-shrink-0"}),e.jsx("h3",{className:"font-bold text-gray-800 truncate",children:i==null?void 0:i.name}),(i==null?void 0:i.participants)&&i.participants.length>0&&e.jsx("div",{className:"ml-4 flex items-center space-x-1 overflow-hidden",children:i.participants.map(t=>{const a=N[t];return a?e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-[10px] text-white font-bold ring-2 ring-white",style:{backgroundColor:a.color},title:a.name,children:a.avatar},t):null})})]}),e.jsxs("div",{className:"flex items-center space-x-3 text-gray-500 flex-shrink-0 ml-2",children:[e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded-md",children:e.jsx(T,{size:18})}),e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded-md",children:e.jsx(R,{size:18})}),e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded-md",children:e.jsx(_,{size:18})}),e.jsx("button",{className:"p-1.5 hover:bg-gray-100 rounded-md",children:e.jsx(A,{size:18})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[k.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(j,{size:48,className:"mb-4 opacity-20"}),e.jsxs("p",{children:["Start the conversation in #",i==null?void 0:i.name,"!"]})]}),k.map((t,a)=>{const l=t.senderId==="me"||t.sender==="You",v=a===0||k[a-1].sender!==t.sender;return e.jsxs("div",{className:`flex ${l?"justify-end":"justify-start"} group`,children:[!l&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 text-xs font-bold mr-3 flex-shrink-0 mt-1",children:v?t.avatar:""}),e.jsxs("div",{className:`max-w-[70%] ${l?"items-end":"items-start"} flex flex-col`,children:[v&&e.jsxs("div",{className:"flex items-baseline mb-1",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-900 mr-2",children:t.sender}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:`px-4 py-2 rounded-lg text-sm shadow-sm ${l?"bg-gray-900 text-white rounded-tr-none":"bg-gray-100 text-gray-800 rounded-tl-none"}`,children:t.content})]}),l&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-800 text-xs font-bold ml-3 flex-shrink-0 mt-1",children:"You"})]},t.id)})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("form",{onSubmit:$,className:"relative rounded-xl border border-gray-300 shadow-sm transition-all bg-gray-50 focus-within:ring-0 focus-within:border-gray-400",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-2 border-b border-gray-200/50",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"Bold",children:e.jsx(J,{size:16})}),e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"Italic",children:e.jsx(X,{size:16})}),e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"Code",children:e.jsx(L,{size:16})}),e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"List",children:e.jsx(H,{size:16})}),e.jsx("div",{className:"w-px h-4 bg-gray-300 mx-1"}),e.jsx("button",{type:"button",className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",title:"Add Link",children:e.jsx(Q,{size:16})})]}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsxs("button",{type:"button",className:"flex items-center space-x-1 px-2 py-1 text-xs font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-colors",children:[e.jsx(U,{size:14}),e.jsx("span",{children:"Integration"})]})})]}),e.jsx("input",{type:"text",value:c,onChange:t=>o(t.target.value),placeholder:`Message #${i==null?void 0:i.name}`,className:"w-full py-3 px-4 bg-transparent border-none focus:ring-0 outline-none text-sm min-h-[50px]"}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full transition-colors",title:"Attach File",children:e.jsx(V,{size:18})}),e.jsx("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full transition-colors",title:"Add Emoji",children:e.jsx(Y,{size:18})}),e.jsx("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full transition-colors",title:"Record Voice",children:e.jsx(Z,{size:18})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-xs text-gray-400 mr-2 hidden sm:block",children:[e.jsx("strong",{children:"Return"})," to send"]}),e.jsx("button",{type:"submit",disabled:!c.trim(),className:`p-2 rounded-lg transition-colors ${c.trim()?"bg-gray-900 text-white hover:bg-black shadow-md":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:e.jsx(q,{size:18})})]})]})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(j,{size:32,className:"text-gray-300"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No Discussion Selected"}),e.jsx("p",{className:"max-w-xs text-center text-sm",children:"Select a channel from the sidebar or start a new discussion to get chatting."}),e.jsx("button",{onClick:()=>m(!0),className:"mt-6 px-4 py-2 bg-[#1e2126] text-white rounded-md text-sm font-medium hover:bg-[#2c3036] transition-colors",children:"Start New Discussion"})]})}),e.jsx(ee,{isOpen:h,onClose:()=>m(!1),onCreate:D}),e.jsx(F,{isOpen:!!d,onClose:()=>g(null),onConfirm:M,title:"Delete Discussion",message:"Are you sure you want to delete this discussion? This action cannot be undone.",confirmText:"Delete",variant:"danger"})]})};export{oe as default};
